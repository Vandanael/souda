import{r as g,j as e}from"./vendor-react-BBAiCqIe.js";import{m as C,u as I}from"./index-DmALNL56.js";import{m as E}from"./vendor-motion-DPidUVdd.js";import"./vendor-other-D1HXEB8n.js";import"./vendor-zustand-CsJFGcav.js";const L=[{id:"gareth",name:"Gareth le Borgne",description:"Un vÃ©tÃ©ran avec une cicatrice sur l'Å“il. Il observe tout.",available:i=>i>=3,firstVisitDialogue:"gareth_intro",dialogues:{gareth_intro:[{text:"Gareth le Borgne. J'ai survÃ©cu Ã  trois guerres. Toi, tu vas survivre Ã  quoi ?",speaker:"npc",choices:[{text:"Des conseils ?",nextDialogueId:"gareth_advice",flag:"metGareth"},{text:"Juste observer.",nextDialogueId:"gareth_observe"}]}],gareth_advice:[{text:"Ã‰coute. Les combats, c'est 70% prÃ©paration, 30% chance. Ã‰quipe-toi bien.",speaker:"npc"},{text:"Et n'oublie pas : parfois, fuir, c'est survivre.",speaker:"npc"}],gareth_observe:[{text:"Bien. Observer, c'est apprendre.",speaker:"npc"}]}},{id:"margaux",name:"SÅ“ur Margaux",description:"Une religieuse qui aide les perdus. Elle a l'air fatiguÃ©e.",available:i=>i>=5,firstVisitDialogue:"margaux_intro",dialogues:{margaux_intro:[{text:"Tu as l'air perdu. Je peux t'aider, si tu veux.",speaker:"npc",choices:[{text:"Parler de la dette.",nextDialogueId:"margaux_debt",flag:"metMargaux"},{text:"Juste Ã©couter.",nextDialogueId:"margaux_listen"}]}],margaux_debt:[{text:"La dette... C'est un poids. Mais tu n'es pas seul.",speaker:"npc"},{text:"Certains disent qu'il y a des trÃ©sors dans les ruines au nord. Peut-Ãªtre une solution ?",speaker:"npc"}],margaux_listen:[{text:"Parfois, Ã©couter, c'est dÃ©jÃ  beaucoup.",speaker:"npc"}]}},{id:"colporteur",name:"Le Colporteur",description:"Un marchand itinÃ©rant avec un sac plein de curiositÃ©s.",available:()=>Math.random()<.3,firstVisitDialogue:"colporteur_intro",dialogues:{colporteur_intro:[{text:"Des objets rares, des nouvelles, des secrets... Tout se vend, tout s'achÃ¨te.",speaker:"npc",choices:[{text:"Quelles nouvelles ?",nextDialogueId:"colporteur_news",flag:"metColporteur"},{text:"Voir tes objets.",nextDialogueId:"colporteur_items"}]}],colporteur_news:[{text:"On dit qu'un convoi traverse la rÃ©gion bientÃ´t. Riche, mais bien gardÃ©.",speaker:"npc"},{text:"Et il y a des rumeurs sur un trÃ©sor dans les ruines du fort abandonnÃ©.",speaker:"npc"}],colporteur_items:[{text:"Je n'ai rien de spÃ©cial aujourd'hui. Reviens demain.",speaker:"npc"}]}},{id:"ivrogne",name:"L'Ivrogne",description:"Un homme qui boit depuis le matin. Il marmonne des choses incomprÃ©hensibles.",available:()=>!0,firstVisitDialogue:"ivrogne_intro",dialogues:{ivrogne_intro:[{text:"Mmmh... Tu sais... Les murs... Ils Ã©coutent...",speaker:"npc",choices:[{text:"Que veux-tu dire ?",nextDialogueId:"ivrogne_walls"},{text:"Ignorer.",nextDialogueId:"ivrogne_ignore"}]}],ivrogne_walls:[{text:"Les murs... Ils savent tout... Morten... Il Ã©coute...",speaker:"npc"},{text:"Fais attention... Fais attention...",speaker:"npc"}],ivrogne_ignore:[{text:"Mmmh... Tu verras... Tu verras...",speaker:"npc"}]}}];function P(i){const n=[],a=/\*\*([^*]+)\*\*/g,x=/__([^_]+)__/g,l=/\*([^*_]+)\*/g,p={};let c=0,u=i;return u=u.replace(a,(o,s)=>{const r=`__PLACEHOLDER_${c}__`;return p[r]={text:s,type:"name"},c++,r}),u=u.replace(x,(o,s)=>{const r=`__PLACEHOLDER_${c}__`;return p[r]={text:s,type:"danger"},c++,r}),u=u.replace(l,(o,s)=>{const r=`__PLACEHOLDER_${c}__`;return p[r]={text:s,type:"item"},c++,r}),u.split(/(\s+)/).forEach(o=>{if(o.trim()==="")n.push({text:o,type:"normal"});else if(o.startsWith("__PLACEHOLDER_")&&o.endsWith("__")){const s=p[o];s&&n.push(s)}else n.push({text:o,type:"normal"})}),n}function z(i){switch(i){case"name":return"#f4d03f";case"danger":return"#8B0000";case"item":return"#5dade2";default:return"#ffffff"}}function w({text:i,speed:n,onComplete:a,skipOnClick:x=!0,style:l}){const p=C(),c=n||(p?20:30),[u,v]=g.useState(""),[o,s]=g.useState(!1),r=g.useRef(null),h=g.useRef(0);g.useEffect(()=>{h.current=0,v(""),s(!1);const m=()=>{if(h.current>=i.length){s(!0),a&&a();return}h.current++;const f=i.substring(0,h.current);v(f),r.current=setTimeout(m,c)};return r.current=setTimeout(m,c),()=>{r.current&&clearTimeout(r.current)}},[i,c,a]);const j=()=>{x&&!o&&(r.current&&clearTimeout(r.current),v(i),s(!0),a&&a())},_=()=>{const m=P(u),f=[];let k=0;return m.forEach((y,T)=>{const S=z(y.type);T===m.length-1&&!o?(f.push(e.jsx("span",{style:{color:S},children:y.text},`word-${k++}`)),f.push(e.jsx(E.span,{animate:{opacity:[1,0,1]},transition:{duration:.8,repeat:1/0},style:{color:S,marginLeft:"2px"},children:"|"},`cursor-${k++}`))):f.push(e.jsx("span",{style:{color:S},children:y.text},`word-${k++}`))}),f};return e.jsx("div",{onClick:j,style:{cursor:x&&!o?"pointer":"default",lineHeight:"1.8",fontFamily:"serif",...l},children:_()})}function N(){const{day:i,gold:n,npcFlags:a,rumors:x,hasEatenToday:l,setNPCFlag:p,generateRumors:c,buyMeal:u,closeInventory:v}=I(),o=C(),[s,r]=g.useState(null),[h,j]=g.useState([]),[_,m]=g.useState(0),[f,k]=g.useState(!1);g.useEffect(()=>{const t=x.filter(d=>d.day===i);t.length===0&&c(),t.length>0&&!a.firstRumorSeen&&(k(!0),I.setState({npcFlags:{...a,firstRumorSeen:!0}}))},[i,x]);const y=L.filter(t=>t.available(i,a)),T=t=>{r(t);const d=(a[`met${t.id.charAt(0).toUpperCase()+t.id.slice(1)}`],t.firstVisitDialogue||"intro"),R=t.dialogues[d]||[];j(R),m(0),a[`met${t.id.charAt(0).toUpperCase()+t.id.slice(1)}`]||p(`met${t.id.charAt(0).toUpperCase()+t.id.slice(1)}`,!0)},S=t=>{if(t.flag&&p(t.flag,!0),t.action&&t.action(),t.nextDialogueId&&s){const d=s.dialogues[t.nextDialogueId]||[];j(d),m(0)}else r(null),j([]),m(0)},b=h[_],D=x.filter(t=>t.day===i);return e.jsxs(e.Fragment,{children:[f&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:e.jsxs("div",{style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",maxWidth:"500px",border:"2px solid #555"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"1rem",color:"#ddd"},children:"Les Rumeurs"}),e.jsx("p",{style:{color:"#aaa",marginBottom:"1.5rem",lineHeight:"1.6"},children:"Les rumeurs t'aident Ã  planifier tes explorations. Elles apparaissent avec une icÃ´ne sur les lieux de la carte."}),e.jsxs("div",{style:{color:"#aaa",lineHeight:"1.6",marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("strong",{style:{color:"#ddd"},children:"âš”ï¸ Combat"})," : Plus de combats dans ce lieu"]}),e.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("strong",{style:{color:"#ddd"},children:"ðŸ’° TrÃ©sor"})," : Plus de loot et items meilleurs"]}),e.jsxs("div",{style:{marginBottom:"0.75rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("strong",{style:{color:"#ddd"},children:"âš ï¸ Ã‰vÃ©nement"})," : Plus d'Ã©vÃ©nements narratifs"]}),e.jsxs("div",{style:{padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("strong",{style:{color:"#ddd"},children:"ðŸ“ Lieu"})," : Pointe un lieu Ã  explorer"]})]}),e.jsx("button",{onClick:()=>k(!1),style:{padding:"0.75rem 1.5rem",fontSize:"1rem",background:"#4a4",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold",width:"100%"},children:"Compris"})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem",flex:1,padding:"1rem",overflowY:"auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"1rem"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"0.5rem"},children:"TAVERNE DU PENDU"}),e.jsxs("div",{style:{fontSize:"1rem",color:"#aaa"},children:["Or : ",e.jsxs("span",{style:{color:"#ca8",fontWeight:"bold"},children:[n,"ðŸ’°"]})]})]}),e.jsx("div",{style:{background:"#2a2a2a",padding:"1rem",borderRadius:"8px",border:"2px solid #555"},children:e.jsx("div",{style:{fontSize:"0.9rem",color:"#aaa",fontStyle:"italic",lineHeight:"1.6"},children:`"La fumÃ©e de pipe, l'odeur de biÃ¨re rance, les murmures. Ici, on parle, on Ã©coute, on oublie."`})}),D.length>0&&e.jsxs("div",{style:{background:"#2a2a2a",padding:"1rem",borderRadius:"8px",border:"2px solid #555"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.75rem"},children:"RUMEURS"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:D.map(t=>{const d=t.hintType==="combat"?"âš”ï¸":t.hintType==="loot"?"ðŸ’°":t.hintType==="event"?"âš ï¸":t.hintType==="location"?"ðŸ“":"ðŸ’¬",R=t.hintType==="combat"?"Augmente les chances de combat":t.hintType==="loot"?"Augmente les chances de trÃ©sor":t.hintType==="event"?"Peut dÃ©clencher un Ã©vÃ©nement":t.hintType==="location"?"Cible un lieu spÃ©cifique":"";return e.jsx("div",{style:{padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#ccc",fontStyle:"italic",lineHeight:"1.6",border:"1px solid #333",position:"relative"},title:R,children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:d}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{children:['"',t.text,'"']}),R&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#888",marginTop:"0.25rem",fontStyle:"normal"},children:R})]})]})},t.id)})})]}),e.jsxs("div",{style:{background:"#2a2a2a",padding:"1rem",borderRadius:"8px",border:"2px solid #555"},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.75rem"},children:["PRÃ‰SENTS (",y.length,")"]}),y.length===0?e.jsx("div",{style:{color:"#888",fontStyle:"italic",textAlign:"center",padding:"1rem"},children:"La taverne est vide"}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:y.map(t=>e.jsxs("div",{onClick:()=>T(t),style:{padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",border:"1px solid #555",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:d=>{d.currentTarget.style.background="#222"},onMouseLeave:d=>{d.currentTarget.style.background="#1a1a1a"},children:[e.jsx("div",{style:{fontSize:"1rem",fontWeight:"bold",color:"#ddd",marginBottom:"0.25rem"},children:t.name}),e.jsx("div",{style:{fontSize:"0.85rem",color:"#888"},children:t.description})]},t.id))})]}),e.jsxs("div",{style:{background:"#2a2a2a",padding:"1rem",borderRadius:"8px",border:"2px solid #555"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.75rem"},children:"SERVICES"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("div",{style:{padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.95rem",color:"#ccc"},children:"Logement (2ðŸ’°/nuit)"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#888"},children:"DÃ©duit automatiquement au crÃ©puscule"})]})}),e.jsx("button",{onClick:()=>{u()},disabled:l||n<4,style:{padding:"0.75rem",background:l||n<4?"#1a1a1a":"#2a2a2a",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #555",cursor:l||n<4?"not-allowed":"pointer",opacity:l||n<4?.6:1,transition:"background 0.2s"},onMouseEnter:t=>{!l&&n>=4&&(t.currentTarget.style.background="#333")},onMouseLeave:t=>{!l&&n>=4&&(t.currentTarget.style.background="#2a2a2a")},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.95rem",color:l||n<4?"#888":"#ccc",textAlign:"left"},children:"Repas (4ðŸ’°)"}),e.jsx("div",{style:{fontSize:"0.8rem",color:l?"#ca8":n<4?"#666":"#888",textAlign:"left"},children:l?"âœ“ DÃ©jÃ  mangÃ© aujourd'hui":n<4?"Or insuffisant":"Restaure ton moral (+1 humanitÃ©)"})]})})]})]}),e.jsx("button",{onClick:v,style:{fontSize:"1rem",padding:"1rem",width:"100%"},children:"RETOUR"}),s&&b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:"2px solid #555",maxWidth:"500px",width:"90%",maxHeight:"80vh",overflowY:"auto"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"1rem",color:"#ca8"},children:s.name}),e.jsx(w,{text:b.text,speed:30,style:{fontSize:o?"1.05rem":"1rem",color:"#ddd",marginBottom:"1.5rem",fontStyle:b.speaker==="npc"?"italic":"normal"}}),b.choices&&b.choices.length>0?e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:b.choices.map((t,d)=>e.jsx("button",{onClick:()=>S(t),style:{padding:"0.75rem",textAlign:"left",fontSize:"0.95rem"},children:t.text},d))}):e.jsx("button",{onClick:()=>{_<h.length-1?m(_+1):(r(null),j([]),m(0))},style:{width:"100%",padding:"0.75rem",fontSize:"1rem"},children:_<h.length-1?"SUIVANT":"FERMER"})]})})]})]})}export{N as default};
