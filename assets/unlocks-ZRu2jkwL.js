import{g as l}from"./hallOfFame-0hgsfmQm.js";import{O as c}from"./index-C7rUvnqQ.js";async function m(o,r){const e={...r};o.daysLived&&(e.globalCounters.totalDaysSurvived+=o.daysLived),o.combatsFled&&(e.globalCounters.totalFlees+=o.combatsFled),o.totalGoldEarned&&(e.globalCounters.totalGoldEarned+=o.totalGoldEarned),o.endType==="victory"?e.globalCounters.victories+=1:e.globalCounters.defeats+=1;for(const t of c)e.origins.includes(t.id)||(t.id==="noble"?(await l()).some(i=>i.finalGold>200)&&!e.origins.includes("noble")&&e.origins.push("noble"):t.unlockCondition(e)&&(e.origins.includes(t.id)||e.origins.push(t.id)));return o.daysLived&&o.daysLived>=5&&(e.itemPoolAdditions.includes("heavy_weapons")||e.itemPoolAdditions.push("heavy_weapons")),o.daysLived&&o.daysLived>=10&&(e.itemPoolAdditions.includes("plate_armor")||e.itemPoolAdditions.push("plate_armor")),e.globalCounters.totalDaysSurvived>=20&&(e.itemPoolAdditions.includes("legendary_items")||e.itemPoolAdditions.push("legendary_items")),o.endTitle==="Le Seigneur"&&(e.itemPoolAdditions.includes("noble_set")||e.itemPoolAdditions.push("noble_set")),e}async function f(){return new Promise((o,r)=>{const e=indexedDB.open("souda_meta",4);e.onerror=()=>r(e.error),e.onsuccess=()=>{const i=e.result.transaction(["unlocks"],"readonly").objectStore("unlocks").get("state");i.onerror=()=>r(i.error),i.onsuccess=()=>{const a=i.result;o(a||{origins:["deserteur"],itemPoolAdditions:[],achievements:[],globalCounters:{totalLoots:0,totalMonasteries:0,totalDaysSurvived:0,totalFlees:0,totalGoldEarned:0,victories:0,defeats:0}})}},e.onupgradeneeded=t=>{const s=t.target.result;s.objectStoreNames.contains("metaProgression")||s.createObjectStore("metaProgression"),s.objectStoreNames.contains("tutorial")||s.createObjectStore("tutorial"),s.objectStoreNames.contains("unlocks")||s.createObjectStore("unlocks"),s.objectStoreNames.contains("hallOfFame")||s.createObjectStore("hallOfFame",{keyPath:"id"})}})}async function b(o){return new Promise((r,e)=>{const t=indexedDB.open("souda_meta",4);t.onerror=()=>e(t.error),t.onsuccess=()=>{const a=t.result.transaction(["unlocks"],"readwrite").objectStore("unlocks").put(o,"state");a.onerror=()=>e(a.error),a.onsuccess=()=>r()},t.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains("metaProgression")||n.createObjectStore("metaProgression"),n.objectStoreNames.contains("tutorial")||n.createObjectStore("tutorial"),n.objectStoreNames.contains("unlocks")||n.createObjectStore("unlocks"),n.objectStoreNames.contains("hallOfFame")||n.createObjectStore("hallOfFame",{keyPath:"id"})}})}export{m as c,f as l,b as s};
