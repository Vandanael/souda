import{j as e,r as x}from"./vendor-react-BBAiCqIe.js";import{u as N,h as I}from"./index-C7rUvnqQ.js";import{m as p}from"./vendor-motion-DPidUVdd.js";import"./vendor-other-D1HXEB8n.js";import"./vendor-zustand-CsJFGcav.js";function L({arc:n,characterName:a}){if(!n)return null;const s=n.trustLevel,h=n.storyStage,l=i=>i<=2?"#c44":i<=5?"#ca8":i<=7?"#4a8":"#2ecc71",g=i=>{switch(i){case"menaces":return"Menaces";case"negociations":return"NÃ©gociations";case"ultimatum":return"Ultimatum";case"consequences":return"ConsÃ©quences";default:return i}};return e.jsxs("div",{style:{background:"#1a1a1a",padding:"1rem",borderRadius:"6px",border:"1px solid #444",marginTop:"1rem"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"0.75rem",color:"#ca8",textAlign:"center"},children:["Relation avec ",a]}),e.jsxs("div",{style:{marginBottom:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem",fontSize:"0.8rem",color:"#aaa"},children:[e.jsx("span",{children:"Confiance"}),e.jsxs("span",{style:{color:l(s),fontWeight:"bold"},children:[s,"/10"]})]}),e.jsx("div",{style:{width:"100%",height:"12px",background:"#2a2a2a",borderRadius:"6px",overflow:"hidden",border:"1px solid #444"},children:e.jsx(p.div,{initial:{width:0},animate:{width:`${s/10*100}%`},transition:{duration:.5},style:{height:"100%",background:`linear-gradient(90deg, ${l(s)} 0%, ${l(s)}80 100%)`,borderRadius:"6px"}})})]}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#888",textAlign:"center",fontStyle:"italic"},children:["Stage : ",g(h)]})]})}function H(){const{debt:n,gold:a,repayDebt:s,closeInventory:h,setNPCFlag:l,npcFlags:g,day:i,getCharacterArc:k}=N(),[t,c]=x.useState(0),[f,b]=x.useState(!1),[S,v]=x.useState(!1),[w,R]=x.useState(0),{triggerShake:B}=I();x.useEffect(()=>{g.metMorten||l("metMorten",!0)},[g.metMorten,l]);const C=80,E=n-C,A=n,r=Math.min(a,n),O=()=>{t>0&&t<=r&&(s(t),R(t),b(!0),v(!0),B(2,400),setTimeout(()=>{b(!1),v(!1),c(0),R(0)},2e3))},o=k("morten"),d=(o==null?void 0:o.storyStage)||"menaces",z=(o==null?void 0:o.trustLevel)||0,T=(()=>{if(n===0)return{text:`"Tu as payÃ© ta dette. Tu es libre. Mais souviens-toi : je n'oublie jamais."`,tone:"respectful",color:"#4a8"};const{MORTEN_ARC_CONFIG:y}=require("../features/narrative/characterArcs"),j=y.dialogues[d]||[],W=i%j.length,D=j[W]||j[0]||`"Tu me dois de l'argent."`;let m="neutral",u="#ccc";return d==="menaces"?(m="threatening",u="#c44"):d==="negociations"?(m=z>=5?"surprised":"neutral",u=z>=5?"#ca8":"#ccc"):d==="ultimatum"?(m="threatening",u="#c44"):d==="consequences"&&(m="threatening",u="#8B0000"),{text:`"${D}"`,tone:m,color:u}})(),M=T.color;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,padding:"1rem",justifyContent:"center"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"1rem"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"0.5rem"},children:"Ã‰CHOPPE DE MORTEN"}),e.jsxs("div",{style:{fontSize:"1rem",color:"#aaa"},children:["Or : ",e.jsxs("span",{style:{color:"#ca8",fontWeight:"bold"},children:[a,"ðŸ’°"]})]})]}),e.jsxs("div",{style:{background:"#2a2a2a",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"1rem"},children:"DETTE"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1rem",fontSize:"0.95rem",color:"#ccc"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"Dette initiale :"}),e.jsxs("span",{children:[C,"ðŸ’°"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"IntÃ©rÃªts :"}),e.jsxs("span",{style:{color:"#c44"},children:["+",E,"ðŸ’°"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.1rem",fontWeight:"bold",marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #555"},children:[e.jsx("span",{children:"Total :"}),e.jsxs("span",{style:{color:"#c44"},children:[A,"ðŸ’°"]})]})]}),e.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#1a1a1a",borderRadius:"4px",border:`1px solid ${M}`,fontSize:"0.95rem",color:M,fontStyle:"italic",lineHeight:"1.6"},children:T.text}),e.jsx(L,{arc:o,characterName:"Morten"})]}),e.jsxs("div",{style:{background:"#2a2a2a",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555"},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"1rem"},children:"REMBOURSER"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem",fontSize:"0.9rem",color:"#aaa"},children:[e.jsx("span",{children:"Montant :"}),e.jsxs("span",{style:{color:"#ca8",fontWeight:"bold"},children:[t,"ðŸ’°"]})]}),e.jsx("input",{type:"range",min:"0",max:r,value:t,onChange:y=>c(parseInt(y.target.value)||0),style:{width:"100%",height:"8px",background:"#1a1a1a",borderRadius:"4px",outline:"none"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",color:"#666",marginTop:"0.25rem"},children:[e.jsx("span",{children:"0ðŸ’°"}),e.jsxs("span",{children:[r,"ðŸ’°"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:()=>c(Math.min(10,r)),style:{flex:1,fontSize:"0.85rem",padding:"0.5rem"},children:"10ðŸ’°"}),e.jsx("button",{onClick:()=>c(Math.min(25,r)),style:{flex:1,fontSize:"0.85rem",padding:"0.5rem"},children:"25ðŸ’°"}),e.jsx("button",{onClick:()=>c(Math.min(50,r)),style:{flex:1,fontSize:"0.85rem",padding:"0.5rem"},children:"50ðŸ’°"}),e.jsx("button",{onClick:()=>c(r),style:{flex:1,fontSize:"0.85rem",padding:"0.5rem"},children:"TOUT"})]}),e.jsxs("button",{onClick:O,disabled:t===0||t>r,style:{width:"100%",fontSize:"1.1rem",padding:"1rem",opacity:t>0&&t<=r?1:.5,cursor:t>0&&t<=r?"pointer":"not-allowed"},children:["REMBOURSER ",t,"ðŸ’°"]}),t>0&&!S&&e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#aaa",textAlign:"center"},children:["Nouvelle dette : ",e.jsxs("span",{style:{color:"#c44"},children:[n-t,"ðŸ’°"]})," | ","Or restant : ",e.jsxs("span",{style:{color:"#ca8"},children:[a-t,"ðŸ’°"]})]}),S&&e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{marginTop:"1rem",padding:"1rem",background:"#1a2a1a",borderRadius:"4px",border:"2px solid #4a4",fontSize:"1rem",textAlign:"center"},children:[e.jsx(p.div,{animate:f?{scale:[1,1.1,1],color:["#c44","#4a4","#c44"]}:{},transition:{duration:.5},style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#4a4"},children:"âœ“ Remboursement effectuÃ© !"}),e.jsxs("div",{style:{fontSize:"0.95rem",color:"#ccc"},children:["Nouvelle dette : ",e.jsxs(p.span,{animate:f?{scale:[1,1.2,1]}:{},style:{color:"#c44",fontWeight:"bold"},children:[n,"ðŸ’°"]}),f&&e.jsxs(p.span,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},style:{color:"#4a4",marginLeft:"0.5rem",fontWeight:"bold"},children:["-",w,"ðŸ’°"]})]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#aaa",marginTop:"0.25rem"},children:["Or restant : ",e.jsxs("span",{style:{color:"#ca8"},children:[a,"ðŸ’°"]})]})]})]}),e.jsx("button",{onClick:h,style:{fontSize:"1rem",padding:"1rem",width:"100%"},children:"RETOUR"})]})}export{H as default};
