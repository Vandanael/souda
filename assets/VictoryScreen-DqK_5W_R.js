import{r as e,j as t}from"./vendor-react-BBAiCqIe.js";import{u as D,a as G}from"./index-C7rUvnqQ.js";import{s as P}from"./hallOfFame-0hgsfmQm.js";import{d as b,E as R,M as A}from"./MetaProgressionDisplay-Bfglhm6t.js";import{l as M,c as F,s as I}from"./unlocks-ZRu2jkwL.js";import"./vendor-other-D1HXEB8n.js";import"./vendor-zustand-CsJFGcav.js";import"./vendor-motion-DPidUVdd.js";function B(){const n=D(),{calculateRunXP:d}=G(),[r,u]=e.useState(null),[i,p]=e.useState(null),[g,f]=e.useState(!1);return e.useEffect(()=>{const c=b(n);u(c),(async()=>{const{day:l,gold:a,reputation:y,inventory:S,combatsWon:h,combatsFled:k,combatsLost:v,narrativeCounters:s,triggeredEvents:E}=n,x=S.filter(o=>o.rarity==="legendary").map(o=>o.name),U=E.length,w=d(l,a,U);p(w),f(!0);const m={id:crypto.randomUUID(),timestamp:Date.now(),characterName:"Soudard",origin:n.selectedOrigin||"deserteur",daysLived:l,finalGold:a,finalDebt:0,finalReputation:y,endType:"victory",endTitle:c.title,legendaryItems:x,combatsWon:h,combatsFled:k,combatsLost:v,totalGoldEarned:a,counters:{cynisme:s.cynisme||0,humanite:s.humanite||0,pragmatisme:s.pragmatisme||0}};await P(m);const C=await M(),j=await F(m,C);await I(j)})()},[]),r?t.jsxs(t.Fragment,{children:[t.jsx(R,{ending:r}),g&&i!==null&&t.jsx(A,{xpGained:i,onAnimationComplete:()=>{}})]}):null}export{B as default};
