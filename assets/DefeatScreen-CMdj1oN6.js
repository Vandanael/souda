import{r as o,j as e}from"./vendor-react-BBAiCqIe.js";import{u as D,a as P}from"./index-DmALNL56.js";import{s as G}from"./hallOfFame-0hgsfmQm.js";import{d as T,M as z,E as A}from"./MetaProgressionDisplay-B38RdVSK.js";import{l as I,c as R,s as W}from"./unlocks-BfNjx6Sv.js";import"./vendor-other-D1HXEB8n.js";import"./vendor-zustand-CsJFGcav.js";import"./vendor-motion-DPidUVdd.js";function H(){const t=D(),{calculateRunXP:g}=P(),[c,p]=o.useState(null),[a,f]=o.useState(null),[l,d]=o.useState(!1);return o.useEffect(()=>{const n=T(t);p(n),(async()=>{const{day:m,debt:y,gold:s,reputation:h,inventory:x,combatsWon:v,combatsFled:S,combatsLost:b,narrativeCounters:r,triggeredEvents:j}=t,k=x.filter(i=>i.rarity==="legendary").map(i=>i.name),E=j.length,U=g(m,s,E);f(U),d(!0);const u={id:crypto.randomUUID(),timestamp:Date.now(),characterName:"Soudard",origin:t.selectedOrigin||"deserteur",daysLived:m,finalGold:s,finalDebt:y,finalReputation:h,endType:n.type==="defeat"?n.id==="mort_combat"?"death":"debt":"victory",endTitle:n.title,legendaryItems:k,combatsWon:v,combatsFled:S,combatsLost:b,totalGoldEarned:s,counters:{cynisme:r.cynisme||0,humanite:r.humanite||0,pragmatisme:r.pragmatisme||0}};await G(u);const w=await I(),C=await R(u,w);await W(C)})()},[]),c?e.jsxs(e.Fragment,{children:[l&&a!==null&&e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:10001,padding:"2rem",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1rem",color:"#ca8"},children:["Tu as survécu ",t.day," jour",t.day>1?"s":""]}),e.jsxs("div",{style:{fontSize:"1.2rem",marginBottom:"2rem",color:"#ddd"},children:["Tu as gagné ",e.jsxs("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:[a," XP"]})," !"]}),e.jsx("div",{style:{fontSize:"1rem",color:"#aaa",marginBottom:"2rem",fontStyle:"italic",maxWidth:"400px"},children:"Continue pour débloquer de nouveaux contenus et améliorer tes prochaines runs."}),e.jsx(z,{xpGained:a,onAnimationComplete:()=>{setTimeout(()=>{d(!1)},1e3)}})]}),!l&&e.jsx(A,{ending:c})]}):null}export{H as default};
