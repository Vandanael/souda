import{j as e,r as p}from"./vendor-react-BBAiCqIe.js";import{u as I,a as T,g as W}from"./index-DmALNL56.js";import{m as l,A as k}from"./vendor-motion-DPidUVdd.js";function X(t){const r=A(t);return r||P(t)}function A(t){const{day:r,debt:i,reputation:o,combatResult:n,currentEnemy:a}=t;return(n==null?void 0:n.outcome)==="defeat"?{id:"mort_combat",type:"defeat",title:"Mort au Combat",text:`${(a==null?void 0:a.name)||"Un ennemi"} a eu raison de vous. Votre cadavre sera pillÃ© comme vous avez pillÃ© tant d'autres. Terra Incognita n'a pas de pitiÃ© pour les faibles.`,ambiance:{backgroundColor:"#1a0000",textColor:"#ccc",titleColor:"#c44",particles:"ashes",musicId:"defeat"},variables:{enemyName:(a==null?void 0:a.name)||"Un ennemi"}}:r>=20&&i>0&&o<4?{id:"dette_sang",type:"defeat",title:"La Dette de Sang",text:"Les hommes de Morten vous trouvent Ã  l'aube. Pas de nÃ©gociation. Pas de pitiÃ©. Votre corps rejoint les autres dans la fosse derriÃ¨re l'Ã©choppe. La dette est payÃ©e.",ambiance:{backgroundColor:"#2a0000",textColor:"#ccc",titleColor:"#c44",particles:"ashes",musicId:"defeat"}}:r>=20&&i>0&&o>=4?{id:"fuite",type:"defeat",title:"La Fuite",text:"Votre rÃ©putation vous permet de fuir avant que Morten n'envoie ses hommes. Mais vous fuyez sans rien. Ã€ nouveau dÃ©serteur. Ã€ nouveau seul. La dette vous suivra.",ambiance:{backgroundColor:"#1a1a1a",textColor:"#aaa",titleColor:"#888",particles:"mist",musicId:"flee"}}:null}function P(t){const{gold:r,reputation:i,debt:o,narrativeCounters:n}=t;if(o>0)return M();const a=n.cynisme||0,u=n.humanite||0,d=n.pragmatisme||0;return u>=10?{id:"humanite",type:"victory",title:"La RÃ©demption",text:"Vous avez choisi l'humanitÃ©. MalgrÃ© les tÃ©nÃ¨bres, vous avez gardÃ© votre cÅ“ur. Les rÃ©fugiÃ©s que vous avez aidÃ©s parlent de vous comme d'un protecteur. SÅ“ur Margaux vous offre une place au monastÃ¨re. Vous avez rachetÃ© vos erreurs.",ambiance:{backgroundColor:"#1a2a1a",textColor:"#ddd",titleColor:"#fff",particles:"light",musicId:"victory"}}:a>=10?{id:"cynisme",type:"victory",title:"La Survie",text:"Vous avez survÃ©cu. Peu importe le prix. Vous avez fait ce qu'il fallait. Les autres peuvent juger, mais vous Ãªtes vivant. C'est tout ce qui compte. La dette est payÃ©e, mais votre Ã¢me aussi.",ambiance:{backgroundColor:"#2a1a1a",textColor:"#aaa",titleColor:"#c44",particles:"ashes",musicId:"defeat"}}:d>=10?{id:"pragmatisme",type:"victory",title:"L'EfficacitÃ©",text:"Vous avez gagnÃ©. Par la logique et l'efficacitÃ©. Vous avez calculÃ© chaque mouvement, chaque choix. La dette est payÃ©e. Vous Ãªtes libre. Et vous avez appris que dans ce monde, seule la logique compte.",ambiance:{backgroundColor:"#1a1a2a",textColor:"#aaa",titleColor:"#88a",particles:"mist",musicId:"victory"}}:[Math.abs(u-a),Math.abs(u-d),Math.abs(a-d)].every(g=>g<7)&&u>=3&&a>=3&&d>=3?{id:"equilibre",type:"victory",title:"L'Ã‰quilibre",text:"Vous avez trouvÃ© l'Ã©quilibre. Entre tout et rien. Entre le bien et le mal. Entre la logique et l'Ã©motion. Vous avez payÃ© votre dette. Vous Ãªtes libre. Et vous Ãªtes humain, dans toute votre complexitÃ©.",ambiance:{backgroundColor:"#1a1a1a",textColor:"#aaa",titleColor:"#888",particles:"none",musicId:"victory"}}:i===5&&r>=200&&u>a?{id:"seigneur",type:"victory",title:"Le Seigneur des Ruines",text:"Votre rÃ©putation vous prÃ©cÃ¨de. Les seigneurs locaux vous offrent terres et titre. De mercenaire, vous devenez noble. La dette n'Ã©tait que le premier chapitre.",ambiance:{backgroundColor:"#2a2a00",textColor:"#ddd",titleColor:"#ca8",particles:"gold",musicId:"victory"}}:r>=300?{id:"marchand",type:"victory",title:"Le Roi des Charognes",text:"L'or appelle l'or. Vous rachetez l'Ã©choppe de Morten, puis une autre, puis une autre. BientÃ´t, c'est vous qui prÃªtez aux dÃ©sespÃ©rÃ©s. Le cycle continue.",ambiance:{backgroundColor:"#2a1a00",textColor:"#ddd",titleColor:"#ca8",particles:"gold",musicId:"victory"}}:u>=10&&a<3?{id:"redempteur",type:"victory",title:"Le RÃ©dempteur",text:"Vous avez payÃ© votre dette, mais aussi celle de votre conscience. Les rÃ©fugiÃ©s que vous avez aidÃ©s parlent de vous comme d'un saint. SÅ“ur Margaux vous offre une place au monastÃ¨re.",ambiance:{backgroundColor:"#2a2a1a",textColor:"#ddd",titleColor:"#fff",particles:"light",musicId:"victory"}}:i<=2&&d>u&&d>a?{id:"fantome",type:"victory",title:"Le FantÃ´me",text:"Personne ne se souvient de vous. Vous payez Morten dans l'ombre et disparaissez avant l'aube. Quelque part, une nouvelle guerre commence. Vous y serez.",ambiance:{backgroundColor:"#1a1a1a",textColor:"#888",titleColor:"#666",particles:"mist",musicId:"flee"}}:M()}function M(){return{id:"survivant",type:"victory",title:"Le Survivant",text:"Vous avez survÃ©cu. C'est plus que la plupart peuvent dire. La route continue, sans gloire ni honte. Juste un autre jour.",ambiance:{backgroundColor:"#1a1a1a",textColor:"#aaa",titleColor:"#888",particles:"none",musicId:"victory"}}}function V(t,r){if(!r)return t;let i=t;return Object.entries(r).forEach(([o,n])=>{i=i.replace(new RegExp(`\\[${o}\\]`,"g"),n)}),i}function q({ambiance:t}){if(t.particles==="none"||!t.particles)return null;const r=20;return t.particles==="gold"?e.jsx(e.Fragment,{children:Array.from({length:r}).map((i,o)=>e.jsx(l.div,{initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:0,scale:0},animate:{y:window.innerHeight+100,opacity:[0,1,0],scale:[0,1,0],rotate:360},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"linear"},style:{position:"fixed",width:"8px",height:"8px",background:"#ca8",borderRadius:"50%",pointerEvents:"none",zIndex:1,boxShadow:"0 0 10px #ca8"}},o))}):t.particles==="ashes"?e.jsx(e.Fragment,{children:Array.from({length:r}).map((i,o)=>e.jsx(l.div,{initial:{x:Math.random()*window.innerWidth,y:-50,opacity:0,rotate:0},animate:{y:window.innerHeight+100,opacity:[0,.5,0],rotate:360},transition:{duration:4+Math.random()*3,repeat:1/0,delay:Math.random()*2,ease:"linear"},style:{position:"fixed",width:"6px",height:"6px",background:"#333",borderRadius:"50%",pointerEvents:"none",zIndex:1}},o))}):t.particles==="mist"?e.jsx(e.Fragment,{children:Array.from({length:10}).map((i,o)=>e.jsx(l.div,{initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:0},animate:{x:(Math.random()-.5)*200+Math.random()*window.innerWidth,y:(Math.random()-.5)*200+Math.random()*window.innerHeight,opacity:[0,.3,0]},transition:{duration:5+Math.random()*3,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"},style:{position:"fixed",width:"100px",height:"100px",background:"radial-gradient(circle, rgba(200,200,200,0.1) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none",zIndex:1}},o))}):t.particles==="light"?e.jsx(e.Fragment,{children:Array.from({length:15}).map((i,o)=>e.jsx(l.div,{initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:0,scale:0},animate:{opacity:[0,.6,0],scale:[0,1.5,0]},transition:{duration:2+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"},style:{position:"fixed",width:"20px",height:"20px",background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none",zIndex:1}},o))}):null}function F({runData:t,showTitle:r=!0,compact:i=!1}){const o=[...Object.values(t.equipment),...t.inventory].filter(a=>a&&a.rarity==="legendary").length,n=t.legendaryItemsFound??o;return e.jsxs("div",{style:{background:i?"transparent":"#2a2a2a",padding:i?"0":"1.5rem",borderRadius:"8px",border:i?"none":"2px solid #555",width:"100%"},children:[r&&!i&&e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"1rem",textAlign:"center"},children:"RÃ‰CAPITULATIF"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("span",{style:{color:"#aaa"},children:"Jours survÃ©cus :"}),e.jsxs("span",{style:{color:"#ddd",fontWeight:"bold"},children:[t.day,"/20"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("span",{style:{color:"#aaa"},children:"Or final :"}),e.jsxs("span",{style:{color:"#ca8",fontWeight:"bold"},children:[t.gold,"ðŸ’°"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px"},children:[e.jsx("span",{style:{color:"#aaa"},children:"RÃ©putation :"}),e.jsx("span",{style:{color:"#ddd",fontWeight:"bold"},children:"â­".repeat(t.reputation)})]}),n>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px",border:"1px solid #ca8"},children:[e.jsx("span",{style:{color:"#aaa"},children:"Items lÃ©gendaires :"}),e.jsx("span",{style:{color:"#ca8",fontWeight:"bold"},children:n})]}),(t.combatsWon!==void 0||t.combatsFled!==void 0||t.combatsLost!==void 0)&&e.jsxs("div",{style:{padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px",marginTop:"0.5rem"},children:[e.jsx("div",{style:{color:"#aaa",marginBottom:"0.5rem",fontSize:"0.9rem"},children:"Combats :"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",fontSize:"0.85rem"},children:[t.combatsWon!==void 0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#4a8"},children:"Victoires :"}),e.jsx("span",{style:{color:"#4a8"},children:t.combatsWon})]}),t.combatsFled!==void 0&&t.combatsFled>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#ca8"},children:"Fuit :"}),e.jsx("span",{style:{color:"#ca8"},children:t.combatsFled})]}),t.combatsLost!==void 0&&t.combatsLost>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#c44"},children:"DÃ©faites :"}),e.jsx("span",{style:{color:"#c44"},children:t.combatsLost})]})]})]})]})]})}function H({ending:t}){const{day:r,gold:i,reputation:o,equipment:n,inventory:a,combatsWon:u,combatsFled:d,combatsLost:b,legendaryItemsFound:j,resetGame:g}=I(),[v,w]=p.useState(!1),[m,L]=p.useState([]),[x,s]=p.useState(0);p.useEffect(()=>{const c=setTimeout(()=>w(!0),500),h=V(t.text,t.variables).split(". ").filter(z=>z.trim().length>0);return L(h),()=>clearTimeout(c)},[t]),p.useEffect(()=>{if(m.length!==0&&x<m.length){const c=setTimeout(()=>{s(x+1)},1500);return()=>clearTimeout(c)}},[x,m.length]);const f={day:r,gold:i,reputation:o,equipment:n,inventory:a,combatsWon:u,combatsFled:d,combatsLost:b,legendaryItemsFound:j};return e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:v?1:0},transition:{duration:1},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:t.ambiance.backgroundColor,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"2rem",overflowY:"auto",zIndex:1e4},children:[e.jsx(q,{ambiance:t.ambiance}),e.jsxs("div",{style:{position:"relative",zIndex:2,maxWidth:"600px",width:"100%",textAlign:"center"},children:[e.jsx(l.div,{initial:{opacity:0,y:-30},animate:{opacity:v?1:0,y:0},transition:{delay:.5,duration:.8},style:{fontSize:t.type==="victory"?"3rem":"2.5rem",fontWeight:"bold",marginBottom:"2rem",color:t.ambiance.titleColor,textShadow:"2px 2px 8px rgba(0,0,0,0.8)",lineHeight:"1.2"},children:t.title}),e.jsx(l.div,{style:{background:"rgba(0, 0, 0, 0.3)",padding:"2rem",borderRadius:"8px",border:`2px solid ${t.ambiance.textColor}40`,marginBottom:"2rem",minHeight:"200px"},children:e.jsx(k,{mode:"wait",children:m.slice(0,x).map((c,y)=>e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.5},style:{fontSize:"1.1rem",color:t.ambiance.textColor,lineHeight:"1.8",marginBottom:y<m.length-1?"1rem":"0",fontStyle:"italic",textAlign:"left"},children:[c.trim(),"."]},y))})}),e.jsx(l.div,{initial:{opacity:0},animate:{opacity:x>=m.length?1:0},transition:{delay:.5},style:{background:"rgba(0, 0, 0, 0.3)",padding:"1.5rem",borderRadius:"8px",border:`1px solid ${t.ambiance.textColor}40`,marginBottom:"2rem"},children:e.jsx(F,{runData:f,compact:!0})}),e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:x>=m.length?1:0},transition:{delay:.5},style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>{const{setPhase:c}=I.getState();c("hallOfFame")},style:{fontSize:"1.1rem",padding:"1rem 2rem",background:"#2a2a2a",border:"2px solid #555",minWidth:"150px",color:t.ambiance.textColor},children:"HALL OF FAME"}),e.jsx("button",{onClick:g,style:{fontSize:"1.1rem",padding:"1rem 2rem",background:t.type==="victory"?"#3a2a2a":"#2a1a1a",border:`2px solid ${t.ambiance.titleColor}80`,minWidth:"150px",color:t.ambiance.textColor},children:t.type==="victory"?"NOUVELLE PARTIE":"RÃ‰ESSAYER"})]})]})]})}function N({xpGained:t,onAnimationComplete:r}){const{globalXP:i,playerLevel:o,addXP:n}=T(),[a,u]=p.useState(i),[d,b]=p.useState(o),[j,g]=p.useState(!1),[v,w]=p.useState([]),[m,L]=p.useState(!1);p.useEffect(()=>{const s=i,f=i+t,c=2e3,y=Date.now(),h=()=>{const z=Date.now()-y,S=Math.min(1,z/c),E=1-Math.pow(1-S,3),R=Math.floor(s+(f-s)*E);if(u(R),S<1)requestAnimationFrame(h);else{if(!m){L(!0);const C=n(t);C.leveledUp&&C.newLevel&&(b(C.newLevel),g(!0),w(C.unlockedContent||[]))}r&&setTimeout(r,500)}};requestAnimationFrame(h)},[t,i,n,r,m]);const x=W(a,d);return e.jsxs("div",{style:{position:"fixed",bottom:"2rem",left:"50%",transform:"translateX(-50%)",zIndex:10001,width:"90%",maxWidth:"500px",background:"rgba(0, 0, 0, 0.9)",border:"2px solid #555",borderRadius:"8px",padding:"1.5rem"},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#fff",textAlign:"center"},children:["XP GagnÃ©e : +",t]}),e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",color:"#aaa",textAlign:"center"},children:["Niveau ",d]}),e.jsxs("div",{style:{width:"100%",height:"30px",background:"#2a2a2a",borderRadius:"4px",overflow:"hidden",border:"1px solid #555",position:"relative"},children:[e.jsx(l.div,{initial:{width:0},animate:{width:`${x.progress*100}%`},transition:{duration:2,ease:"easeOut"},style:{height:"100%",background:"linear-gradient(90deg, #4a9eff 0%, #2ecc71 100%)",borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx(l.div,{animate:{x:["-100%","200%"]},transition:{duration:2,repeat:1/0,ease:"linear"},style:{position:"absolute",top:0,left:0,width:"50%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}})}),e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.85rem",fontWeight:"bold",color:"#fff",textShadow:"1px 1px 2px rgba(0,0,0,0.8)",pointerEvents:"none"},children:[x.currentLevelXP," / ",x.nextLevelXP," XP"]})]}),e.jsx(k,{children:j&&e.jsxs(l.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8},transition:{duration:.5,type:"spring"},style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%)",border:"3px solid #f39c12",borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"90%",zIndex:10002,boxShadow:"0 10px 40px rgba(0,0,0,0.8)",textAlign:"center"},onClick:()=>g(!1),children:[e.jsx(l.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:.6,repeat:1/0,repeatType:"reverse"},style:{fontSize:"3rem",marginBottom:"1rem"},children:"ðŸŽ‰"}),e.jsxs("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f39c12",marginBottom:"1rem",textShadow:"0 0 10px rgba(243, 156, 18, 0.5)"},children:["NIVEAU ",d," ATTEINT !"]}),v.length>0&&e.jsxs("div",{style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid #555"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:"#2ecc71",marginBottom:"1rem"},children:"NOUVEAU CONTENU DÃ‰BLOQUÃ‰"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:v.map((s,f)=>{const c=s.startsWith("origin:"),y=s.startsWith("item:"),h=c?s.replace("origin:","").charAt(0).toUpperCase()+s.replace("origin:","").slice(1):y?s.replace("item:","").replace(/_/g," ").toUpperCase():s;return e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:f*.1},style:{background:"rgba(46, 204, 113, 0.2)",border:"1px solid #2ecc71",borderRadius:"6px",padding:"0.75rem",fontSize:"1rem",color:"#2ecc71"},children:c?`Origine : ${h}`:`Item : ${h}`},f)})})]}),e.jsx("button",{onClick:()=>g(!1),style:{marginTop:"1.5rem",padding:"0.75rem 2rem",fontSize:"1.1rem",fontWeight:"bold",background:"#f39c12",border:"none",borderRadius:"6px",color:"#000",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:s=>{s.currentTarget.style.background="#e67e22",s.currentTarget.style.transform="scale(1.05)"},onMouseLeave:s=>{s.currentTarget.style.background="#f39c12",s.currentTarget.style.transform="scale(1)"},children:"CONTINUER"})]})})]})}export{H as E,N as M,X as d};
