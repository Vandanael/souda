import{r as l,j as t}from"./vendor-react-BBAiCqIe.js";import{u as b,o as q,M as A}from"./index-DmALNL56.js";import{m as u,A as O}from"./vendor-motion-DPidUVdd.js";import B from"./InventoryScreen-CxiyAY70.js";import"./vendor-other-D1HXEB8n.js";import"./vendor-zustand-CsJFGcav.js";let g=[],y=null;function v(r){k(),document.querySelectorAll(r).forEach(e=>{e instanceof HTMLElement&&(e.classList.add("tutorial-highlight"),g.push(e))})}function k(){g.forEach(r=>{r.classList.remove("tutorial-highlight")}),g=[]}function T(r=[]){z();const o=document.createElement("div");o.className="tutorial-overlay",o.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9998;
    pointer-events: auto;
  `,o.addEventListener("click",e=>{const n=e.target,i=g.some(a=>a.contains(n)),p=r.some(a=>{const d=document.querySelectorAll(a);return Array.from(d).some(s=>s.contains(n))});!i&&!p&&(e.stopPropagation(),e.preventDefault())}),document.body.appendChild(o),y=o}function z(){y&&(y.remove(),y=null)}function f(){k(),z()}const D="souda_meta",j="tutorial";async function E(r){return new Promise(o=>{if(typeof indexedDB>"u"){o();return}const e=indexedDB.open(D,4);e.onerror=()=>{console.error("Erreur sauvegarde tutorial state"),o()},e.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains("metaProgression")||i.createObjectStore("metaProgression"),i.objectStoreNames.contains("tutorial")||i.createObjectStore("tutorial"),i.objectStoreNames.contains("unlocks")||i.createObjectStore("unlocks"),i.objectStoreNames.contains("hallOfFame")||i.createObjectStore("hallOfFame",{keyPath:"id"})},e.onsuccess=()=>{const n=e.result;if(!n.objectStoreNames.contains(j)){console.warn("Object store tutorial n'existe pas, impossible de sauvegarder"),o();return}try{const a=n.transaction([j],"readwrite").objectStore(j).put(r,"completed");a.onerror=()=>{console.error("Erreur Ã©criture tutorial state"),o()},a.onsuccess=()=>{o()}}catch(i){console.error("Erreur lors de l'accÃ¨s Ã  l'object store tutorial:",i),o()}}})}function w({onSkip:r,onStepChange:o}){const[e,n]=l.useState(0),[i,p]=l.useState(!1),[a,d]=l.useState(""),[s,S]=l.useState(0),m=[["La bataille est perdue.","Vos compagnons sont morts.","Vous fuyez dans la nuit..."],[],[],[]][e]||[],x=m[s]||"";return l.useEffect(()=>{if(e===0){d(""),S(0);const c=m.length*3e3+2e3,h=setTimeout(()=>{n(1),o&&o(1)},Math.max(2e4,c));return()=>clearTimeout(h)}},[e,m.length]),l.useEffect(()=>{if(e===0&&x)if(a.length<x.length){const c=setTimeout(()=>{d(x.slice(0,a.length+1))},50);return()=>clearTimeout(c)}else{const c=setTimeout(()=>{s<m.length-1&&(S(s+1),d(""))},2e3);return()=>clearTimeout(c)}},[e,x,a,s,m.length]),l.useEffect(()=>{if(e===1){f();const c=setTimeout(()=>{n(2),o&&o(2)},2e4);return()=>clearTimeout(c)}},[e,o]),e===0?t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#000",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e4,padding:"2rem",textAlign:"center"},children:t.jsx(O,{mode:"wait",children:m.map((c,h)=>h!==s?null:t.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},style:{fontSize:"1.5rem",color:"#ca8",lineHeight:"1.8",minHeight:"3rem"},children:[a,a.length===c.length&&t.jsx("span",{style:{opacity:1},children:"|"})]},h))})}):e===1?t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.9)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e4,padding:"2rem"},children:t.jsxs(u.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:"2px solid #555",maxWidth:"500px",width:"100%"},children:[t.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"1rem",color:"#ca8"},children:"Morten"}),t.jsxs("div",{style:{fontSize:"1rem",lineHeight:"1.6",marginBottom:"1.5rem",color:"#ddd"},children:['"Ah, un autre rat qui fuit le navire..."',t.jsx("br",{}),t.jsx("br",{}),`"Je peux te cacher. Mais rien n'est gratuit."`,t.jsx("br",{}),t.jsx("br",{}),`"Tu me dois 80 piÃ¨ces d'or. Tu as 20 jours."`]}),t.jsx(u.div,{initial:{scale:0},animate:{scale:1},transition:{delay:1,type:"spring"},style:{fontSize:"1.5rem",fontWeight:"bold",color:"#c44",marginBottom:"1rem",textAlign:"center"},children:"Dette : 80ðŸ’°"}),t.jsx("div",{style:{fontSize:"0.9rem",color:"#aaa",fontStyle:"italic",textAlign:"center"},children:"Chaque jour, les intÃ©rÃªts augmentent..."})]})}):e===2?t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4,pointerEvents:"none"},children:t.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{position:"absolute",bottom:"2rem",left:"50%",transform:"translateX(-50%)",background:"rgba(42, 42, 42, 0.95)",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555",maxWidth:"500px",width:"90%",pointerEvents:"auto"},children:[t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#ca8"},children:"Voici tout ce qu'il te reste."}),t.jsx("div",{style:{fontSize:"0.95rem",color:"#ddd",lineHeight:"1.6",marginBottom:"1rem"},children:"Ã‰quipe ton arme pour commencer."})]})}):e===3?t.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4,pointerEvents:"none"},children:t.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{position:"absolute",bottom:"2rem",left:"50%",transform:"translateX(-50%)",background:"rgba(42, 42, 42, 0.95)",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555",maxWidth:"500px",width:"90%",pointerEvents:"auto"},children:[t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#ca8"},children:"Explore les environs."}),t.jsx("div",{style:{fontSize:"0.95rem",color:"#ddd",lineHeight:"1.6"},children:"Trouve de quoi rembourser. Chaque objet a une valeur. Revends au marchÃ©."})]})}):null}function W(){const{setPhase:r,dailyLocations:o,equipment:e,currentEvent:n}=b(),[i,p]=l.useState(2);l.useEffect(()=>{if(i===2)r("inventory"),setTimeout(()=>{v("[data-tutorial-inventory]"),T(["[data-tutorial-inventory]","[data-tutorial-equip-button]"])},500);else if(i===3){if(o.length===0){const s=q(1);b.setState({dailyLocations:s,phase:"exploration",actionsRemaining:3})}else r("exploration");setTimeout(()=>{v('[data-tutorial-location="true"]'),T(['[data-tutorial-location="true"]','[data-tutorial-explore-button="true"]'])},500)}},[i,r,o.length]),l.useEffect(()=>{i===2&&e.weapon&&(f(),setTimeout(()=>{p(3)},2e3))},[i,e.weapon]),l.useEffect(()=>{i===3&&(n==="loot"||n==="combat")&&(f(),setTimeout(()=>{a()},2e3))},[i,n]);const a=async()=>{f(),await E(!0),r("aube")},d=async()=>{i<2||(f(),await E(!0),r("aube"))};return i===2?t.jsxs(t.Fragment,{children:[t.jsx(B,{}),t.jsx(w,{onSkip:d})]}):i===3?t.jsxs(t.Fragment,{children:[t.jsx(A,{locations:o,onExplore:s=>{b.getState().exploreLocation(s)},onEndDay:()=>{}}),t.jsx(w,{onSkip:d})]}):null}export{W as default};
