const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DefeatScreen-2aG-3zwD.js","assets/vendor-react-BBAiCqIe.js","assets/vendor-other-D1HXEB8n.js","assets/hallOfFame-0hgsfmQm.js","assets/MetaProgressionDisplay-CBNG99s7.js","assets/vendor-motion-DPidUVdd.js","assets/unlocks-CO68Gf6x.js","assets/vendor-zustand-CsJFGcav.js","assets/VictoryScreen-BRDlr9Ic.js","assets/InventoryScreen-C6RI0Ws8.js","assets/MarcheScreen-CdETMzYa.js","assets/MortenScreen-rAkYaTx8.js","assets/ForgeScreen-Dhuhzlg3.js","assets/TaverneScreen-DWZTCWj-.js","assets/EventScreen-CdVhPq9h.js","assets/OriginSelectScreen-C3D4pZX5.js","assets/HallOfFameScreen-ChANGEBc.js","assets/TutorialScreen-CqYH3S9x.js","assets/SettingsScreen-C6j_FQKe.js"])))=>i.map(i=>d[i]);
var Qe=Object.defineProperty;var Ke=(e,t,n)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var R=(e,t,n)=>Ke(e,typeof t!="symbol"?t+"":t,n);import{j as s,r as f,c as Ze,R as et}from"./vendor-react-BBAiCqIe.js";import{c as Ae,p as tt,a as nt}from"./vendor-zustand-CsJFGcav.js";import{A as z,m as S,u as Z}from"./vendor-motion-DPidUVdd.js";import"./vendor-other-D1HXEB8n.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const rt="modulepreload",st=function(e){return"/souda/"+e},he={},D=function(t,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=st(c),c in he)return;he[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":rt,d||(u.as="script"),u.crossOrigin="",u.href=c,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((h,v)=>{u.addEventListener("load",h),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})},it=[{id:"sword_chipped",name:"√âp√©e √âbr√©ch√©e",slot:"weapon",rarity:"common",stats:{atk:8,def:0,vit:0},durability:100,maxDurability:100,properties:[],value:10,description:"Ton √©p√©e de d√©part. Elle a vu des combats."},{id:"leather_armor",name:"Armure de Cuir",slot:"torso",rarity:"common",stats:{atk:0,def:6,vit:0},durability:100,maxDurability:100,properties:[],value:8,description:"Une armure us√©e mais solide."},{id:"sword_dented",name:"√âp√©e Dentel√©e",slot:"weapon",rarity:"uncommon",stats:{atk:12,def:0,vit:0},durability:100,maxDurability:100,properties:[],value:25,description:"Une √©p√©e qui a mordu dans la chair. Efficace."},{id:"helmet_rusty",name:"Casque Rouill√©",slot:"head",rarity:"common",stats:{atk:0,def:4,vit:0},durability:75,maxDurability:100,properties:["rusty"],value:12,description:"Rouill√© mais √ßa prot√®ge encore."},{id:"mail_shirt",name:"Chemise de Mailles",slot:"torso",rarity:"uncommon",stats:{atk:0,def:10,vit:-1},durability:100,maxDurability:100,properties:["heavy"],value:30,description:"Lourde mais r√©sistante. √áa ralentit un peu."},{id:"dagger_bloody",name:"Dague Ensanglant√©e",slot:"weapon",rarity:"rare",stats:{atk:10,def:0,vit:2},durability:100,maxDurability:100,properties:["bloody","light"],value:45,description:"L√©g√®re et rapide. Le sang s√©ch√© porte chance."},{id:"shield_wooden",name:"Bouclier de Bois",slot:"offhand",rarity:"common",stats:{atk:0,def:8,vit:0},durability:100,maxDurability:100,properties:[],value:15,description:"Un bouclier simple. Mieux que rien."},{id:"boots_worn",name:"Bottes Us√©es",slot:"legs",rarity:"common",stats:{atk:0,def:2,vit:3},durability:100,maxDurability:100,properties:["light"],value:10,description:"Us√©es mais confortables. Tu bouges mieux."}];function at(e){return{common:"Commun",uncommon:"Peu Commun",rare:"Rare",legendary:"L√©gendaire"}[e]}function ot(e){return{common:"#888",uncommon:"#aaa",rare:"#ddd",legendary:"#fff"}[e]}const lt={common:.6,uncommon:.3,rare:.09,legendary:.01},ct={common:.5,uncommon:.35,rare:.12,legendary:.03};function ut(e){return Math.min(4,Math.max(1,e))>=3?ct:lt}function dt(e,t){const n=Math.random();return n<e.common?"common":n<e.common+e.uncommon?"uncommon":n<e.common+e.uncommon+e.rare?"rare":"legendary"}const mt=["light","heavy","rusty","bloody","blessed","solid"];function pt(e,t){if(!(Math.random()<.3)||e.properties.length>=2)return e;const r=mt.filter(a=>!(a==="light"&&e.properties.includes("heavy")||a==="heavy"&&e.properties.includes("light")||e.properties.includes(a)));if(r.length===0)return e;const i=r[Math.floor(Math.random()*r.length)];return{...e,properties:[...e.properties,i]}}function ge(e,t){const n=Math.floor(Math.random()*21)+80;return Math.floor(e*n/100)}function W(e,t=it,n,r){let i=ut(e);if(r){i={common:i.common*.85,uncommon:i.uncommon*.95,rare:i.rare*1.5,legendary:i.legendary*1.5};const d=i.common+i.uncommon+i.rare+i.legendary;i.common=i.common/d,i.uncommon=i.uncommon/d,i.rare=i.rare/d,i.legendary=i.legendary/d}const a=dt(i),o=t.filter(d=>d.rarity===a);if(o.length===0){const d=["common","uncommon","rare","legendary"];for(const m of d){const u=t.filter(h=>h.rarity===m);if(u.length>0){const h=u[Math.floor(Math.random()*u.length)];return{...h,id:`${h.id}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,durability:ge(h.maxDurability),properties:[...h.properties]}}}throw new Error("Aucun item disponible dans le pool")}const l=o[Math.floor(Math.random()*o.length)];let c={...l,id:`${l.id}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,durability:ge(l.maxDurability),properties:[...l.properties]};return(a==="rare"||a==="legendary")&&(c=pt(c)),c}const ft=[{id:"sword_compromised",name:"√âp√©e Lourde de Guerre",slot:"weapon",rarity:"legendary",stats:{atk:20,def:0,vit:0},durability:100,maxDurability:100,properties:["bloody","heavy"],value:50,description:"Une √©p√©e de guerre massive. Elle frappe comme un marteau, mais sa lourdeur te fatigue rapidement.",cursed:!0,curseEffect:"R√©duit ta vitalit√© de 5 points (lourdeur)",curseDescription:"Cette √©p√©e est trop lourde pour √™tre mani√©e efficacement. Elle te fatigue rapidement.",hiddenMalus:{vit:-5}},{id:"armor_compromised",name:"Armure de Pillard",slot:"torso",rarity:"legendary",stats:{atk:0,def:25,vit:0},durability:100,maxDurability:100,properties:["heavy"],value:60,description:"Une armure de pillard, marqu√©e de symboles inf√¢mes. Elle te prot√®ge, mais les marchands te reconnaissent et te font payer plus cher.",cursed:!0,curseEffect:"R√©duit l'or gagn√© de 10% (r√©putation de pillard)",curseDescription:"Cette armure porte les marques d'un pillard notoire. Les marchands te reconnaissent et te font payer plus cher.",hiddenMalus:{}},{id:"amulet_compromised",name:"Amulette de D√©serteur",slot:"accessory",rarity:"rare",stats:{atk:0,def:0,vit:15},durability:100,maxDurability:100,properties:[],value:40,description:"Une amulette militaire vol√©e. Elle te rappelle ta mobilit√© pass√©e, mais trahit ton pass√© de d√©serteur.",cursed:!0,curseEffect:"R√©duit ta r√©putation de 1 (symbole de d√©serteur)",curseDescription:"Cette amulette porte les symboles d'un d√©serteur. Les gens te reconnaissent et te font moins confiance.",hiddenMalus:{}},{id:"boots_compromised",name:"Bottes Us√©es de Voyageur",slot:"legs",rarity:"rare",stats:{atk:0,def:5,vit:10},durability:100,maxDurability:100,properties:["light"],value:35,description:"Des bottes de voyageur us√©es mais l√©g√®res. Elles te font bouger vite, mais offrent peu de protection.",cursed:!0,curseEffect:"R√©duit ta d√©fense de 3 points (protection insuffisante)",curseDescription:"Ces bottes sont l√©g√®res mais us√©es. Elles offrent peu de protection aux pieds.",hiddenMalus:{def:-3}}],ye=ft;function xe(e,t){if(e.properties.includes("solid"))return e;const n=e.maxDurability*t/100,r=Math.max(0,e.durability-n);return{...e,durability:r}}function ze(e){const t=e.durability/e.maxDurability*100;return t===0?"broken":t<=25?"damaged":t<=50?"worn":"normal"}function ht(e){switch(e){case"normal":return 1;case"worn":return .8;case"damaged":return .5;case"broken":return 0}}function gt(e){const t=ze(e),n=ht(t);return{atk:Math.floor(e.stats.atk*n),def:Math.floor(e.stats.def*n),vit:Math.floor(e.stats.vit*n)}}function yt(e){return e.durability<=0}function xt(e){switch(e){case"normal":return"#4a8";case"worn":return"#ca8";case"damaged":return"#c84";case"broken":return"#c44"}}const vt={normal:"Normal",worn:"Ab√Æm√©",damaged:"Endommag√©",broken:"Cass√©"};function bt({item:e,showLabel:t=!0,size:n="medium"}){const r=ze(e),i=e.durability/e.maxDurability*100,a=xt(r),o=n==="small"?"4px":n==="large"?"8px":"6px",l=n==="small"?"0.7rem":n==="large"?"0.9rem":"0.75rem";return s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",width:"100%"},children:[t&&s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:l,color:"#888"},children:[s.jsx("span",{children:"Durabilit√©"}),s.jsxs("span",{style:{color:a,fontWeight:r==="broken"?"bold":"normal"},children:[vt[r]," (",Math.floor(i),"%)"]})]}),s.jsxs("div",{style:{width:"100%",height:o,background:"#1a1a1a",borderRadius:"3px",overflow:"hidden",position:"relative"},children:[s.jsx("div",{style:{width:`${i}%`,height:"100%",background:a,transition:"width 0.3s ease-out, background 0.3s",boxShadow:r==="broken"?"none":`0 0 4px ${a}40`}}),(r==="worn"||r==="damaged")&&s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:r==="damaged"?"repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 4px)":"repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(0,0,0,0.1) 4px, rgba(0,0,0,0.1) 8px)",pointerEvents:"none"}})]}),!t&&s.jsxs("div",{style:{fontSize:l,color:a,textAlign:"right",marginTop:"0.1rem"},children:[Math.floor(i),"%"]})]})}function ve(e,t=1){return{...e,explored:e.explored??!1,explorationCount:e.explorationCount??0,firstSeenDay:e.firstSeenDay??t}}const ee={village_fantome:{name:"Village Fant√¥me",description:"Des maisons vides. Des portes qui grincent. Tu sens que quelque chose te regarde.",riskRange:[1,2],richness:2,frequency:20,icon:"üèöÔ∏è"},champ_bataille:{name:"Champ de Bataille",description:"Des cadavres. Des armes bris√©es. L'odeur de la mort. Mais aussi des tr√©sors oubli√©s.",riskRange:[2,3],richness:3,frequency:15,icon:"‚öîÔ∏è"},ferme_abandonnee:{name:"Ferme Abandonn√©e",description:"Une ferme laiss√©e √† l'abandon. Peut-√™tre quelques outils encore utilisables.",riskRange:[1,2],richness:1,frequency:20,icon:"üöú"},monastere_pille:{name:"Monast√®re Pill√©",description:"Un lieu de pri√®re profan√©. Des reliques peuvent encore tra√Æner.",riskRange:[2,2],richness:4,frequency:10,icon:"‚õ™"},ruines_fort:{name:"Ruines de Fort",description:"Un ancien fort en ruine. Dangereux, mais riche en √©quipement militaire.",riskRange:[3,4],richness:4,frequency:10,icon:"üè∞"},foret:{name:"For√™t",description:"Une for√™t sombre. Des bruits √©tranges. Mais aussi des ressources naturelles.",riskRange:[2,2],richness:1,frequency:15,icon:"üå≤"},carriere:{name:"Carri√®re",description:"Une carri√®re abandonn√©e. Des outils de mineur peuvent encore servir.",riskRange:[2,3],richness:2,frequency:10,icon:"‚õèÔ∏è"},cache_tresor:{name:"Cache au Tr√©sor",description:"Un lieu secret r√©v√©l√© par la carte. Des richesses inestimables t'attendent, mais le danger est grand.",riskRange:[3,4],richness:5,frequency:0,icon:"üó∫Ô∏è"}},Tt={bandit:{id:"bandit",name:"Bandits",type:"bandit",atk:10,def:6,vit:4,lootGold:{min:5,max:15},description:"Des pillards sans foi ni loi."},deserter:{id:"deserter",name:"D√©serteurs",type:"deserter",atk:12,def:10,vit:5,lootGold:{min:8,max:20},description:"Comme toi, ils ont fui. Maintenant ils te voient comme une proie."},militia:{id:"militia",name:"Miliciens",type:"militia",atk:8,def:14,vit:3,lootGold:{min:3,max:12},description:"D√©fenseurs d'un village fant√¥me. Ils ne l√¢chent rien."},veteran_pillager:{id:"veteran_pillager",name:"Pillards V√©t√©rans",type:"veteran_pillager",atk:16,def:8,vit:6,lootGold:{min:15,max:35},description:"Quatre hivers de pillage. Ils sont dangereux."},wolf:{id:"wolf",name:"Loups",type:"wolf",atk:8,def:4,vit:10,lootGold:{min:2,max:8},description:"Une meute affam√©e. Ils attaquent en groupe."},squatter:{id:"squatter",name:"Squatteurs",type:"squatter",atk:6,def:4,vit:4,lootGold:{min:3,max:10},description:"Des civils d√©sesp√©r√©s. Nombreux mais faibles."}};function Oe(e){const t=Math.min(5,Math.max(1,e)),n=[];t===1?n.push("bandit","squatter"):t===2?n.push("bandit","deserter","militia","wolf"):t===3?n.push("deserter","militia","veteran_pillager"):t===4?n.push("deserter","veteran_pillager","militia"):n.push("veteran_pillager","deserter");const r=n[Math.floor(Math.random()*n.length)];return Tt[r]}function be(e,t,n){const r=e.atk*.5+e.def*.3+e.vit*.2;let i;return t?i=3.5+Math.random()*13:i=3+Math.random()*9,r+i}function St(e,t,n){const r=[],i=Object.values(t).filter(a=>a!==void 0);if(i.length===0)return r;if(e==="costly"){const a=i[Math.floor(Math.random()*i.length)],o=Math.floor(Math.random()*11)+10;r.push({itemId:a.id,amount:o})}else if(e==="flee"){const a=Math.random()<.5?1:2;[...i].sort(()=>Math.random()-.5).slice(0,a).forEach(l=>{r.push({itemId:l.id,amount:15})})}return r}function Be(e,t,n,r){const i=be(e,!0),a=be({atk:t.atk,def:t.def,vit:t.vit},!1),o=i/a;let l,c,d,m,u=!1;o>1.4?(l="crushing",c=`Tu √©cras√©s ${t.name}. Aucune r√©sistance.`,m=Math.floor(Math.random()*(t.lootGold.max-t.lootGold.min+1))+t.lootGold.min,u=!0):o>1?(l="victory",c=`Tu as vaincu ${t.name}.`,m=Math.floor(Math.random()*(t.lootGold.max-t.lootGold.min+1))+t.lootGold.min,u=!0):o>.7?(l="costly",c=`Victoire co√ªteuse contre ${t.name}. Tu es bless√©.`,m=Math.floor(Math.random()*(t.lootGold.max-t.lootGold.min+1))+t.lootGold.min,u=!0,o>=.7&&o<=1.1&&(e.def>t.atk?d=`Ta D√©fense (${e.def}) a bloqu√© leur attaque (${t.atk}).`:e.atk>t.def?d="Ton arme a fait la diff√©rence.":d="Sans ton √©quipement, tu serais mort.")):o>.4?(l="flee",c=`Tu as fui ${t.name}. Tu as perdu du mat√©riel.`,u=!1):(l="defeat",c=`Tu as √©t√© vaincu par ${t.name}.`,u=!1);const h=n?St(l,n):[];return{outcome:l,ratio:o,playerPower:i,enemyPower:a,durabilityLoss:h,lootEarned:u,gold:m,message:c,nearMissMessage:d}}function jt(e){const t=Math.min(5,Math.max(1,e));return{1:.1,2:.25,3:.45,4:.65,5:.85}[t]||.1}function Ct(e,t){const n=e.atk*.5+e.def*.3+e.vit*.2+10,r=t.atk*.5+t.def*.3+t.vit*.2+7.5,i=n/r;let a;return i>1.2||i<.6?a="high":i>.8&&i<1.2?a="medium":a="low",{ratio:i,confidence:a}}function wt(e){const t=Math.min(5,Math.max(1,e)),n={1:{atk:8,def:4,vit:4},2:{atk:10,def:7,vit:5},3:{atk:12,def:10,vit:5},4:{atk:14,def:11,vit:6},5:{atk:16,def:8,vit:6}};return n[t]||n[1]}function Et(e){return e>=1.4?95:e>=1?Math.round(75+(e-1)/.4*20):e>=.7?Math.round(50+(e-.7)/.3*25):e>=.4?Math.round(25+(e-.4)/.3*25):5}function Mt(e){let t=0,n=0,r=0,i=0,a=0;if(e>=1.4)t=Math.min(100,Math.round(60+(e-1.4)*20)),n=Math.max(0,100-t-5),r=5;else if(e>=1){const l=(e-1)/.4;t=Math.round(l*30),n=Math.round(50+(1-l)*20),r=Math.max(0,100-t-n-10),i=5,a=5}else if(e>=.7){const l=(e-.7)/.3;n=Math.round(l*20),r=Math.round(40+(1-l)*20),i=Math.round(20+(1-l)*10),a=Math.max(0,100-n-r-i)}else if(e>=.4){const l=(e-.4)/.3;r=Math.round(l*15),i=Math.round(50+(1-l)*20),a=Math.max(0,100-r-i)}else a=Math.min(100,Math.round(80+(.4-e)*20)),i=Math.max(0,100-a);const o=t+n+r+i+a;if(o!==100){const l=100/o;t=Math.round(t*l),n=Math.round(n*l),r=Math.round(r*l),i=Math.round(i*l),a=Math.round(a*l)}return{crushing:t,victory:n,costly:r,flee:i,defeat:a}}const te={economy:{dailyInterest:5,repairCostPerPoint:.25,goldMultiplier:1.25}},kt={loot:.4,combat:.3,choice:.2,empty:.1};function It(e,t){const n=Math.min(1,(t-1)*.1);return Math.min(4,Math.floor(e+n))}function Rt(e,t,n){const r=[];Object.entries(ee).forEach(([l,c])=>{const d=Math.floor(c.frequency/5);for(let m=0;m<d;m++)r.push(l)});const i=[],a=[...r];for(let l=0;l<5;l++){a.length===0&&a.push(...r);const c=Math.floor(Math.random()*a.length),d=a[c];i.push(d),a.splice(c,1)}return i.map((l,c)=>{const d=ee[l],[m,u]=d.riskRange,h=Math.floor(Math.random()*(u-m+1))+m,v=It(h,e);return{id:`location_${e}_${c}_${Date.now()}`,type:l,name:d.name,description:d.description,risk:v,richness:d.richness,explored:!1,explorationCount:0,firstSeenDay:e}})}function Lt(e,t,n){let r={...kt};if(e&&t){const a=e.filter(o=>o.targetLocationId===t||o.hintType==="loot"&&!o.targetLocationId||o.hintType==="combat"&&!o.targetLocationId||o.hintType==="event"&&!o.targetLocationId);for(const o of a)o.hintType==="loot"&&(o.targetLocationId===t||!o.targetLocationId)?(r.loot=.6,r.combat=.2,r.choice=.15,r.empty=.05):o.hintType==="combat"&&(o.targetLocationId===t||!o.targetLocationId)?(r.loot=.3,r.combat=.5,r.choice=.15,r.empty=.05):o.hintType==="event"&&(o.targetLocationId===t||!o.targetLocationId)&&(r.loot=.2,r.combat=.2,r.choice=.5,r.empty=.1)}const i=Math.random();return i<r.loot?"loot":i<r.loot+r.combat?"combat":i<r.loot+r.combat+r.choice?"choice":"empty"}function qt(e,t,n,r,i){const a=e.explored&&(e.explorationCount??0)>0,o=Lt(r,e.id),l={event:o,location:e};switch(o){case"combat":{const c=Oe(e.risk),d=Be(t,c,n);l.enemyId=c.id,l.combatResult=d;break}case"loot":{const c=r==null?void 0:r.some(u=>u.hintType==="loot"&&u.targetLocationId===e.id||u.hintType==="loot"&&!u.targetLocationId),d=W(e.risk,void 0,i,c),m=a?.5:.7;if(Math.random()<m)l.item=d,a&&(l.specialMessage="Tu as d√©j√† explor√© ce lieu. Moins de d√©couvertes.");else{const u=Math.floor(Math.random()*(e.richness*30-e.richness*10+1))+e.richness*10,h=a?.5:te.economy.goldMultiplier,v=Math.floor(u*h);l.gold=v,a&&(l.specialMessage="Tu as d√©j√† explor√© ce lieu. Moins de d√©couvertes.")}break}case"choice":{l.choiceId=`choice_${e.type}`,l.choiceText=`Tu arrives √† ${e.name}. Que fais-tu ?`,l.choices=[{id:"explore_careful",text:"Explorer prudemment",consequence:"Tu trouves quelque chose, mais tu perds du temps."},{id:"explore_fast",text:"Fouiller rapidement",consequence:"Tu trouves moins, mais tu es plus rapide."},{id:"leave",text:"Partir",consequence:"Tu quittes le lieu sans rien."}];break}case"empty":{l.atmosphereText=`${e.description} Rien d'int√©ressant ici.`;break}}return l}class Dt{constructor(){R(this,"daySummary",{itemsFound:0,combatsWon:0,combatsFled:0,goldEarned:0,goldSpent:0,events:[]})}advancePhase(t,n){switch(t){case"aube":return"exploration";case"exploration":return n.actionsRemaining===0?"crepuscule":"exploration";case"crepuscule":const r=this.checkEndConditions(n);return r==="victory"?"victory":r==="defeat"?"defeat":"aube";default:return t}}advanceDay(t,n){const r=t+1;let i=te.economy.dailyInterest;r>=15&&n>150&&(i=3);const a=n+i;return{day:r,debt:a,actionsRemaining:3}}checkEndConditions(t){const n=t.day||1,r=t.debt||0;return n>=20?r<=0?"victory":"defeat":t.phase==="defeat"?"defeat":null}generateEveningEvent(t){if(Math.random()<.3){const n=["Un marchand passe par le camp. Il propose des √©quipements.","Tu entends des rumeurs sur un tr√©sor cach√© dans les ruines.","Un groupe de voyageurs partage des nouvelles du royaume.","La nuit est calme. Trop calme.","Des lumi√®res dans la for√™t. Quelqu'un d'autre explore.","Un message est accroch√© √† un arbre. Une offre de travail.","Le vent apporte l'odeur de la guerre. Pas loin.","Des traces de pas. R√©centes. Tu n'es pas seul ici."];return n[Math.floor(Math.random()*n.length)]}return null}resetDaySummary(){this.daySummary={itemsFound:0,combatsWon:0,combatsFled:0,goldEarned:0,goldSpent:0,events:[]}}addToDaySummary(t){this.daySummary={...this.daySummary,...t}}getDaySummary(){return{...this.daySummary}}}const _t="souda_save",Pt=1,O="gameState";function ne(){return typeof indexedDB>"u"?Promise.reject(new Error("IndexedDB not available")):new Promise((e,t)=>{const n=indexedDB.open(_t,Pt);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains(O)||i.createObjectStore(O,{keyPath:"id"})}})}function We(e){const t={},n=["phase","day","debt","gold","reputation","playerStats","inventory","equipment","currentEnemy","combatResult","lootedItem","currentEvent","eventResult","dailyLocations","persistentLocations","actionsRemaining","marketStock","marketStockDay","forgeStock","forgeStockDay","npcFlags","rumors","hasEatenToday","narrativeCounters","triggeredEvents","eventCooldowns","recentMonologues","selectedOrigin","audioSettings","combatsWon","combatsFled","combatsLost","legendaryItemsFound","characterArcs"];for(const r of n)r in e&&typeof e[r]!="function"&&(t[r]=e[r]);return t}async function k(e){try{const r=(await ne()).transaction([O],"readwrite").objectStore(O),i=We(e);await new Promise((a,o)=>{const l=r.put({id:"current",...i,savedAt:Date.now()});l.onsuccess=()=>a(),l.onerror=()=>o(l.error)})}catch(t){console.error("Erreur lors de la sauvegarde:",t)}}async function Ue(){try{const n=(await ne()).transaction([O],"readonly").objectStore(O);return new Promise((r,i)=>{const a=n.get("current");a.onsuccess=()=>{const o=a.result;if(o){const{id:l,savedAt:c,...d}=o;r(d)}else r(null)},a.onerror=()=>i(a.error)})}catch(e){return console.error("Erreur lors du chargement:",e),null}}async function _(e){try{const r=(await ne()).transaction([O],"readwrite").objectStore(O),i=We(e);await new Promise((a,o)=>{const l=r.put({id:"current",...i,savedAt:Date.now(),day:e.day||1});l.onsuccess=()=>{a()},l.onerror=()=>{console.warn("‚ö†Ô∏è Erreur auto-save (non-bloquante):",l.error),a()}})}catch(t){console.warn("‚ö†Ô∏è Erreur auto-save (non-bloquante):",t)}}async function At(){try{const n=(await ne()).transaction([O],"readonly").objectStore(O);return new Promise(r=>{const i=n.get("current");i.onsuccess=()=>{const a=i.result;a&&a.day&&a.phase?r({day:a.day,phase:a.phase}):r(null)},i.onerror=()=>{console.warn("Erreur lecture save info:",i.error),r(null)}})}catch(e){return console.warn("Erreur getSaveInfo:",e),null}}const zt={1:.6,2:.8,3:1,4:1.1,5:1.2},Ot={1:1.4,2:1.2,3:1,4:.9,5:.8},Fe={common:1,uncommon:1.5,rare:2.5,legendary:5};function Bt(e,t,n){const r=e.value,i=Fe[e.rarity],a=zt[t];let o=1;return n&&(n.humanite||0)>=8&&(o=1.1),Math.floor(r*i*a*o)}function Wt(e,t,n){const r=e.value,i=Fe[e.rarity],a=Ot[t];let o=1;return n&&(n.cynisme||0)>=8&&(o=.85),Math.floor(r*1.5*i*a*o)}function Ut(e,t){const n=e.maxDurability-e.durability,r=e.rarity==="common"?1:e.rarity==="uncommon"?1.5:e.rarity==="rare"?2.5:5;let i=1;t&&(t.pragmatisme||0)>=8&&(i=.85);const a=n*te.economy.repairCostPerPoint*r*i;return Math.ceil(a)}function Ft(e){return{...e,durability:e.maxDurability}}function or(e,t){return e<25?t>=4?"Encore un peu et c'√©tait bon pour la ferraille... Mais je vais arranger √ßa.":"Encore un peu et c'√©tait bon pour la ferraille...":e<50?t>=4?"√áa a v√©cu, mais c'est r√©parable. Je m'en occupe.":"√áa a v√©cu, mais c'est r√©parable.":e<75?t>=4?"Pas mal us√©, mais rien de grave. Je peux arranger √ßa.":"Pas mal us√©, mais rien de grave.":t>=4?"Presque neuf, pourquoi venir me voir ? Mais bon, je peux le polir un peu.":"Presque neuf, pourquoi venir me voir ?"}function lr(e){return e?"Reviens quand tu veux. J'ai toujours mes outils.":"Bertram, forgeron. Je r√©pare, je forge, je vends. Que veux-tu ?"}function cr(e){return e<=1?"Tu as l'air d'avoir des ennuis. Moi, je fais mon travail, c'est tout.":e<=2?"Tu commences √† te faire conna√Ætre. Continue comme √ßa.":e>=4?"Tu as une bonne r√©putation ici. Je peux te faire un petit prix.":"Besoin de quelque chose ?"}const Te=[{text:"On dit qu'un convoi traverse la r√©gion bient√¥t. Riche, mais bien gard√©.",hintType:"combat"},{text:"Il y a des rumeurs sur un tr√©sor dans les ruines du fort abandonn√©.",hintType:"loot"},{text:"Des voyageurs parlent d'un groupe de bandits dans les bois.",hintType:"combat"},{text:"Un marchand a perdu sa cargaison pr√®s du village fant√¥me.",hintType:"loot"},{text:"On raconte qu'un ancien guerrier a cach√© son √©quipement dans les ruines.",hintType:"loot"},{text:"Des lumi√®res √©tranges ont √©t√© vues dans la for√™t la nuit derni√®re.",hintType:"event"},{text:"Un groupe de pillards r√¥de dans la r√©gion. Ils sont bien √©quip√©s.",hintType:"combat"},{text:"Il y a une cache d'armes dans l'ancien monast√®re.",hintType:"loot"},{text:"Des cr√©atures r√¥dent dans les champs de bataille abandonn√©s.",hintType:"combat"},{text:"Un tr√©sor a √©t√© enterr√© pr√®s de la carri√®re. Personne ne l'a encore trouv√©.",hintType:"loot"}];function Se(e,t,n){const r=t.filter(c=>c.day===e);if(r.length>0)return r;const i=Math.floor(Math.random()*2)+1,a=[],o=new Set,l=t.length;for(let c=0;c<i;c++){let d;do d=Math.floor(Math.random()*Te.length);while(o.has(d));o.add(d);const m=Te[d],h=`rumor_${`${e}_${l+c}_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}`;let v,p;if(n&&n.length>0&&m.hintType==="location"){const g=n[Math.floor(Math.random()*n.length)];v=g.id,p=g.type}else if(n&&n.length>0&&(m.hintType==="loot"||m.hintType==="combat")){const g=n.filter(b=>!0);if(g.length>0){const b=g[Math.floor(Math.random()*g.length)];v=b.id,p=b.type}}a.push({id:h,text:m.text,day:e,hintType:m.hintType||"event",targetLocationId:v,targetLocationType:p})}return a}const re={stages:[{stage:"menaces",dayRange:[1,5],conditions:e=>e>=1&&e<=5},{stage:"negociations",dayRange:[6,10],conditions:(e,t)=>e>=6&&e<=10&&t<60},{stage:"ultimatum",dayRange:[11,20],conditions:(e,t)=>e>=11&&t>=40},{stage:"consequences",dayRange:[16,20],conditions:(e,t)=>e>=16&&t>0}]};function se(e,t,n,r,i){for(let a=e.stages.length-1;a>=0;a--){const o=e.stages[a],l=o.conditions||(()=>!0);if(t>=o.dayRange[0]&&t<=o.dayRange[1]&&l(t,n,r,i))return o.stage}return e.stages[0].stage}function je(e,t,n){let r=e;switch(t){case"repay":const i=n?Math.min(2,Math.floor(n/20)):1;r=Math.min(10,e+i);break;case"ignore":r=Math.max(0,e-1);break;case"negotiate":r=Math.min(10,e+1);break}return r}function Ce(e,t){return{characterId:e,trustLevel:5,storyStage:"menaces",flags:{},lastInteractionDay:t}}const V=[{id:"convoi",title:"La Rumeur du Convoi",description:"Un marchand mentionne un convoi de ravitaillement mal prot√©g√© qui traverse la r√©gion. Une opportunit√©... ou un pi√®ge ?",triggerCondition:e=>e.day>=4&&e.day<=6&&!e.npcFlags.convoiDone,oneTime:!0,choices:[{id:"embuscade",text:"Tendre une embuscade",consequences:{gold:Math.floor(Math.random()*21)+30,reputation:-1,counters:{cynisme:1},flags:{convoiDone:!0},narrative:"Tu as tendu une embuscade au convoi. L'or est dans ta poche, mais tu as laiss√© des traces. Ta r√©putation en prend un coup."}},{id:"ignorer",text:"Ignorer",consequences:{counters:{humanite:1},narrative:"Tu laisses passer le convoi. Parfois, la meilleure action est de ne rien faire."}},{id:"prevenir",text:"Pr√©venir les gardes",consequences:{reputation:1,counters:{humanite:1},flags:{convoiDone:!0},narrative:"Tu as pr√©venu les gardes. Ils t'en sont reconnaissants. Ta r√©putation s'am√©liore l√©g√®rement."}}]},{id:"collecteurs",title:"Les Collecteurs",description:'Deux hommes de Morten vous trouvent √† la taverne. Leurs regards sont froids. "Il est temps de r√©gler tes comptes."',triggerCondition:e=>e.day>=12&&e.debt>100&&!e.npcFlags.collecteursPaid,oneTime:!1,choices:[{id:"payer",text:"Payer 20üí∞ imm√©diatement",requirements:{gold:20},consequences:{gold:-20,flags:{collecteursPaid:!0},narrative:"Tu leur donnes l'or. Ils partent, mais tu sais qu'ils reviendront."}},{id:"negocier",text:"N√©gocier un d√©lai",requirements:{reputation:3},consequences:{gold:-5,debt:-10,counters:{pragmatisme:1},narrative:"Tu n√©gocies un d√©lai. Ta r√©putation t'a sauv√©, mais la dette reste."}},{id:"resister",text:"R√©sister",consequences:{durabilityLoss:20,debt:-30,counters:{cynisme:1},narrative:"Tu as r√©sist√©. C'√©tait dur, mais tu as gagn√©. La dette diminue, mais tu es marqu√©."}}]},{id:"peste",title:"La Peste",description:"La maladie se r√©pand dans la r√©gion. Les villages se ferment. Les morts s'accumulent. Que fais-tu ?",triggerCondition:e=>e.day>=10&&Math.random()<.15&&!e.npcFlags.pesteActive,oneTime:!1,choices:[{id:"eviter",text:"√âviter les villages",consequences:{actionsRemaining:-1,flags:{pesteActive:!0},narrative:"Tu √©vites les villages. Moins de lieux √† explorer, mais tu restes en vie."}},{id:"masque",text:"Porter un masque (10üí∞)",requirements:{gold:10},consequences:{gold:-10,flags:{pesteActive:!0},narrative:"Tu portes un masque. C'est une protection, mais rien n'est s√ªr."}},{id:"aider",text:"Aider les malades",requirements:{gold:5},consequences:{gold:-5,reputation:1,counters:{humanite:4},flags:{pesteActive:!0},narrative:"Tu aides les malades. C'est risqu√©, mais tu as fait le bon choix. Ta r√©putation grandit."}}]},{id:"marchand",title:"Le Marchand Myst√©rieux",description:`Un homme encapuchonn√© vous aborde dans une ruelle. "J'ai des objets... particuliers. Int√©ress√© ?"`,triggerCondition:e=>e.day>=7&&e.day<=15&&!e.npcFlags.marchandMet&&Math.random()<.1,oneTime:!0,choices:[{id:"objet_compromis",text:"Acheter l'objet compromis (30üí∞)",requirements:{gold:30},consequences:{gold:-30,items:["cursed_item"],counters:{cynisme:1},flags:{marchandMet:!0},narrative:"Tu ach√®tes l'objet. Il a l'air puissant, mais quelque chose ne va pas. Des marques suspectes, un poids inhabituel... Tu sens qu'il y a un prix √† payer."}},{id:"carte",text:"Acheter la carte (20üí∞)",requirements:{gold:20},consequences:{gold:-20,flags:{carteRevelee:!0,marchandMet:!0},narrative:"Tu ach√®tes la carte. Elle r√©v√®le un lieu riche que tu n'avais pas encore explor√©."}},{id:"decliner",text:"D√©cliner poliment",consequences:{counters:{pragmatisme:1},flags:{marchandMet:!0},narrative:"Tu d√©clines. Mieux vaut ne pas s'embarrasser d'affaires douteuses."}},{id:"denoncer",text:"Le d√©noncer",consequences:{reputation:1,counters:{cynisme:1},flags:{marchandMet:!0},narrative:"Tu le d√©nonces aux autorit√©s. Il dispara√Æt dans la nuit. Ta r√©putation s'am√©liore, mais tu as peut-√™tre fait une erreur."}}]},{id:"refugies",title:"Rencontre avec des R√©fugi√©s",description:"Une famille de r√©fugi√©s vous supplie de l'aide. Ils ont faim, ils ont froid. Que fais-tu ?",triggerCondition:e=>(e.narrativeCounters._refugiesCount||0)>=5?!1:Math.random()<.15,oneTime:!1,choices:[{id:"donner_or",text:"Donner 8üí∞",requirements:{gold:8},consequences:{gold:-8,counters:{humanite:4,_refugiesCount:1},narrative:"Tu leur donnes de l'or. Leurs yeux s'illuminent. Tu as fait une bonne action."}},{id:"partager",text:"Partager de la nourriture",consequences:{actionsRemaining:-1,counters:{humanite:2,_refugiesCount:1},narrative:"Tu partages ta nourriture. C'est peu, mais c'est mieux que rien."}},{id:"ignorer",text:"Les ignorer",consequences:{counters:{cynisme:1},narrative:"Tu les ignores. Tu as tes propres probl√®mes. Mais √ßa te p√®se."}},{id:"voler",text:"Les voler",consequences:{gold:Math.floor(Math.random()*11)+5,reputation:-1,counters:{cynisme:2,_refugiesCount:1},narrative:"Tu les voles. L'or est dans ta poche, mais tu as perdu quelque chose d'autre."}}]}];class Nt{constructor(){R(this,"COOLDOWN_DAYS",3)}checkEvents(t,n){const r=this.getEventsForPhase(n);if(r.length===0)return null;const i=r.filter(c=>{var d;if(c.oneTime&&t.triggeredEvents.includes(c.id))return!1;if(!c.oneTime){const m=(d=t.eventCooldowns)==null?void 0:d[c.id];if(m!==void 0&&t.day-m<this.COOLDOWN_DAYS)return!1}return c.triggerCondition(t)});if(i.length===0)return null;const a=i.filter(c=>c.oneTime),o=a.length>0?a:i,l=o[Math.floor(Math.random()*o.length)];return l&&!V.find(c=>c.id===l.id)?(console.error("√âv√©nement s√©lectionn√© non trouv√© dans EVENT_POOL:",l.id),null):l}markEventTriggered(t,n,r){const i=V.find(l=>l.id===t);if(!i)return{triggeredEvents:r.triggeredEvents,eventCooldowns:r.eventCooldowns||{}};let a=[...r.triggeredEvents],o={...r.eventCooldowns||{}};return i.oneTime&&!a.includes(t)&&a.push(t),i.oneTime||(o[t]=n),{triggeredEvents:a,eventCooldowns:o}}getEventsForPhase(t){switch(t){case"aube":return V.filter(n=>n.id==="convoi"||n.id==="marchand");case"exploration":return V.filter(n=>n.id==="refugies");case"crepuscule":return V.filter(n=>n.id==="collecteurs"||n.id==="peste");case"taverne":return V.filter(n=>n.id==="marchand"||n.id==="collecteurs");default:return[]}}}const U=new Nt;function F(e){let t=0,n=0,r=0;return Object.values(e).forEach(i=>{if(!i)return;const a=gt(i);let o=1;switch(i.rarity){case"uncommon":o=1.15;break;case"rare":o=1.3;break;case"legendary":o=1.5;break}let l=0,c=0,d=0;i.properties.forEach(m=>{switch(m){case"light":l+=1;break;case"heavy":l-=1,c+=2;break;case"rusty":d-=Math.floor(a.atk*.1);break}}),t+=Math.floor(a.atk*o)+d,n+=Math.floor(a.def*o)+c,r+=Math.floor(a.vit*o)+l,i.cursed&&i.hiddenMalus&&(t+=i.hiddenMalus.atk||0,n+=i.hiddenMalus.def||0,r+=i.hiddenMalus.vit||0)}),t=Math.max(2,t+2),n=Math.max(1,n+1),r=Math.max(3,r+2),{atk:t,def:n,vit:r}}function $t(e){let t="";e.atk>=15?t="Je me sens assez fort pour les faire.":e.atk>=10?t="Mon arme devrait suffire.":e.atk>=6?t="Je peux tenir, mais √ßa sera serr√©.":t="Je ne suis pas s√ªr de gagner.";let n="";e.def>=15?n="Bien prot√©g√©. Ils auront du mal √† me toucher.":e.def>=10?n="Mon armure devrait tenir.":e.def>=6?n="Je ne suis pas bien couvert.":n="Presque √† d√©couvert. Dangereux.";let r="";return e.vit>=8?r="L√©ger. Je peux esquiver facilement.":e.vit>=6?r="Je bouge normalement.":e.vit>=4?r="Un peu lourd. Je bouge lentement.":r="Tr√®s lourd. Difficile de fuir.",{attack:t,defense:n,speed:r}}const N=class N{constructor(){R(this,"audioContext",null);R(this,"soundCache",new Map);R(this,"musicSource",null);R(this,"musicGain",null);R(this,"currentMusic",null);R(this,"settings",{volume:.7,musicEnabled:!0,sfxEnabled:!0,muted:!1});R(this,"initialized",!1);this.loadSettings()}static getInstance(){return N.instance||(N.instance=new N),N.instance}async init(){if(!this.initialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.initialized=!0}catch(t){console.warn("Audio context initialization failed:",t)}}async loadSound(t){if(this.soundCache.has(t))return this.soundCache.get(t);if(!this.audioContext&&(await this.init(),!this.audioContext))return null;try{const n=await fetch(`/assets/audio/${t}.mp3`);if(!n.ok)return null;const r=await n.arrayBuffer(),i=await this.audioContext.decodeAudioData(r);return this.soundCache.set(t,i),i}catch{return null}}async loadMusic(t){if(!this.audioContext&&(await this.init(),!this.audioContext))return null;try{const n=await fetch(`/assets/audio/${t}.mp3`);if(!n.ok)return null;const r=await n.arrayBuffer();return await this.audioContext.decodeAudioData(r)}catch{return null}}async playSound(t,n=1){if(this.settings.muted||!this.settings.sfxEnabled||!this.audioContext&&(await this.init(),!this.audioContext))return;const r=await this.loadSound(t);if(!(!r||!this.audioContext))try{const i=this.audioContext.createBufferSource(),a=this.audioContext.createGain();i.buffer=r,a.gain.value=n*this.settings.volume,i.connect(a),a.connect(this.audioContext.destination),i.start(0)}catch(i){console.warn(`Failed to play sound ${t}:`,i)}}async playMusic(t,n=0){if(this.settings.muted||!this.settings.musicEnabled||!this.audioContext&&(await this.init(),!this.audioContext))return;this.stopMusic(0);const r=await this.loadMusic(t);if(!(!r||!this.audioContext))try{const i=this.audioContext.createBufferSource(),a=this.audioContext.createGain();i.buffer=r,i.loop=!0,a.gain.value=0,a.gain.linearRampToValueAtTime(this.settings.volume,this.audioContext.currentTime+n/1e3),i.connect(a),a.connect(this.audioContext.destination),i.start(0),this.musicSource=i,this.musicGain=a,this.currentMusic=t}catch(i){console.warn(`Failed to play music ${t}:`,i)}}stopMusic(t=0){if(!this.musicSource||!this.musicGain||!this.audioContext)return;const n=t/1e3;this.musicGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+n),setTimeout(()=>{var r;try{(r=this.musicSource)==null||r.stop()}catch{}this.musicSource=null,this.musicGain=null,this.currentMusic=null},t)}async crossfadeMusic(t,n=1e3){this.settings.muted||!this.settings.musicEnabled||(this.stopMusic(n/2),setTimeout(async()=>{await this.playMusic(t,n/2)},n/2))}setVolume(t){this.settings.volume=Math.max(0,Math.min(1,t)),this.saveSettings(),this.musicGain&&this.audioContext&&(this.musicGain.gain.value=this.settings.volume)}mute(){this.settings.muted=!0,this.stopMusic(0),this.saveSettings()}unmute(){this.settings.muted=!1,this.saveSettings()}setMusicEnabled(t){this.settings.musicEnabled=t,this.saveSettings(),t?this.currentMusic&&this.playMusic(this.currentMusic,500):this.stopMusic(0)}setSfxEnabled(t){this.settings.sfxEnabled=t,this.saveSettings()}loadSettings(){try{const t=localStorage.getItem("audioSettings");t&&(this.settings={...this.settings,...JSON.parse(t)})}catch(t){console.warn("Failed to load audio settings:",t)}}saveSettings(){try{localStorage.setItem("audioSettings",JSON.stringify(this.settings))}catch(t){console.warn("Failed to save audio settings:",t)}}getSettings(){return{...this.settings}}};R(N,"instance",null);let oe=N;const j=oe.getInstance(),Gt=[{id:"deserteur",name:"D√©serteur",description:"Tu as fui la guerre. Tu connais la survie, mais tu as des dettes.",unlockCondition:()=>!0,requiredLevel:1,bonuses:{},maluses:{}},{id:"veteran",name:"V√©t√©ran",description:"Tu as surv√©cu √† une guerre. Tu connais le combat, mais tu as perdu ta fortune.",unlockCondition:e=>e.globalCounters.victories>=1,requiredLevel:2,bonuses:{stats:{def:2}},maluses:{gold:-10}},{id:"pillard",name:"Pillard",description:"Tu as pill√© et vol√©. Tu es rapide, mais ta r√©putation te pr√©c√®de.",unlockCondition:e=>e.globalCounters.totalLoots>=50,requiredLevel:5,bonuses:{stats:{vit:1}},maluses:{reputation:2}},{id:"moine",name:"Ancien Moine",description:"Tu as quitt√© le monast√®re. Tu connais les b√©n√©dictions, mais le cynisme te ronge.",unlockCondition:e=>e.globalCounters.totalMonasteries>=5,requiredLevel:8,bonuses:{},maluses:{}},{id:"noble",name:"Noble D√©chu",description:"Tu as perdu ta fortune. Tu as de l'or de d√©part, mais une dette plus lourde.",unlockCondition:()=>!1,requiredLevel:12,bonuses:{gold:20},maluses:{debt:20}},{id:"survivant",name:"Survivant",description:"Tu as fui de nombreux combats. Tu sais survivre, mais tu es moins combatif.",unlockCondition:e=>e.globalCounters.totalFlees>=3,requiredLevel:15,bonuses:{},maluses:{stats:{atk:-1}}}];function ur(e,t){return t.origins.includes(e)}function Vt(e){return Gt.find(t=>t.id===e)}const le={weapon:{id:"sword_chipped",name:"√âp√©e √âbr√©ch√©e",slot:"weapon",rarity:"common",stats:{atk:8,def:0,vit:0},durability:100,maxDurability:100,properties:[],value:10,description:"Ton √©p√©e de d√©part. Elle a vu des combats."},torso:{id:"leather_armor",name:"Armure de Cuir",slot:"torso",rarity:"common",stats:{atk:0,def:6,vit:0},durability:100,maxDurability:100,properties:[],value:8,description:"Une armure us√©e mais solide."},legs:{id:"boots_worn",name:"Bottes Us√©es",slot:"legs",rarity:"common",stats:{atk:0,def:2,vit:3},durability:100,maxDurability:100,properties:["light"],value:10,description:"Us√©es mais confortables. Tu bouges mieux."}},ie={day:1,phase:"start",debt:80,gold:0,reputation:3,marketStock:[],marketStockDay:0,equipment:le,inventory:[],playerStats:F(le),actionsRemaining:3,dailyLocations:[],currentEvent:"none",eventResult:null,combatResult:null,lootedItem:null,currentEnemy:null,explorationResult:null,combatsWon:0,combatsFled:0,combatsLost:0,legendaryItemsFound:0,forgeStock:null,forgeStockDay:0,npcFlags:{},rumors:[],hasEatenToday:!1,persistentLocations:[],narrativeCounters:{},triggeredEvents:[],eventCooldowns:{},recentMonologues:[],selectedOrigin:"deserteur",characterArcs:{}},y=Ae((e,t)=>({...ie,setPhase:n=>{console.log("üü¢ setPhase appel√© avec:",n);const r=t();if(n==="taverne"){const a=U.checkEvents(r,"taverne");if(a){const{triggeredEvents:o,eventCooldowns:l}=U.markEventTriggered(a.id,r.day,r);e({phase:"narrative",currentEvent:"choice",eventResult:{type:"narrative",eventId:a.id},triggeredEvents:o,eventCooldowns:l}),k(t());return}}e({phase:n}),console.log("üü¢ Phase mise √† jour dans le store:",t().phase),k(t()).catch(a=>{console.error("Erreur sauvegarde apr√®s setPhase:",a)}),["narrative","defeat","victory"].includes(n)&&_(t()).catch(()=>{})},startNewGame:n=>{const r=Vt(n);let i={...le},o={...ie,phase:"aube",selectedOrigin:n,equipment:i,inventory:[],playerStats:F(i)};if(r&&(r.bonuses.gold&&(o.gold+=r.bonuses.gold),r.maluses.gold&&(o.gold=Math.max(0,o.gold+r.maluses.gold)),r.maluses.debt&&(o.debt+=r.maluses.debt),r.bonuses.reputation&&(o.reputation=Math.min(5,Math.max(1,o.reputation+r.bonuses.reputation))),r.maluses.reputation&&(o.reputation=Math.min(5,Math.max(1,o.reputation-r.maluses.reputation))),r.bonuses.stats||r.maluses.stats)){const c={...o.equipment};Object.entries(c).forEach(([d,m])=>{if(m){const u={...m.stats};r.bonuses.stats&&(u.atk=(u.atk||0)+(r.bonuses.stats.atk||0),u.def=(u.def||0)+(r.bonuses.stats.def||0),u.vit=(u.vit||0)+(r.bonuses.stats.vit||0)),r.maluses.stats&&(u.atk=Math.max(0,(u.atk||0)+(r.maluses.stats.atk||0)),u.def=Math.max(0,(u.def||0)+(r.maluses.stats.def||0)),u.vit=Math.max(0,(u.vit||0)+(r.maluses.stats.vit||0))),c[d]={...m,stats:u}}}),o.equipment=c,o.playerStats=F(c)}o.characterArcs={morten:Ce("morten",o.day)};const l=o.characterArcs.morten;l.storyStage=se(re,o.day,o.debt,l.trustLevel,l.flags),e(o),k(o)},startDay:()=>{const n=t();if(n.gold===0&&n.actionsRemaining===0&&!n.hasEatenToday&&n.day>1){e({hasEatenToday:!1,actionsRemaining:1}),console.log("‚ö†Ô∏è M√©canisme de secours activ√© : 1 action gratuite (mendicit√©)");return}!n.hasEatenToday&&n.day>1?e({hasEatenToday:!1,actionsRemaining:Math.max(1,n.actionsRemaining-2)}):e({hasEatenToday:!1});const r=U.checkEvents(n,"aube");if(r){const{triggeredEvents:i,eventCooldowns:a}=U.markEventTriggered(r.id,n.day,n);e({phase:"narrative",currentEvent:"choice",eventResult:{type:"narrative",eventId:r.id},triggeredEvents:i,eventCooldowns:a}),k(t());return}e({phase:"aube"}),_(t()).catch(()=>{})},goToExploration:()=>{const n=t();let r;const i=n.persistentLocations.map(l=>ve(l,n.day)),a=i.filter(l=>!l.explored);if(a.length>=5)r=[...a.slice(0,5)],e({persistentLocations:i});else{const l=Rt(n.day,void 0,n.persistentLocations);[...i,...l];const c=i.filter(d=>!d.explored);c.length>=5?r=c.slice(0,5):r=[...c,...l.slice(0,5-c.length)],e({persistentLocations:i})}if(n.npcFlags.carteRevelee&&!r.some(l=>l.type==="cache_tresor")){const l=ee.cache_tresor,c={id:`cache_tresor_${n.day}_${Date.now()}`,type:"cache_tresor",name:l.name,description:l.description,risk:4,richness:5,explored:!1,explorationCount:0,firstSeenDay:n.day},d=Math.floor(Math.random()*r.length);r[d]=c}const o=Se(n.day,n.rumors,r.map(l=>({id:l.id,type:l.type})));e({phase:"exploration",actionsRemaining:3,dailyLocations:r,rumors:[...n.rumors.filter(l=>l.day>=n.day-3),...o]})},exploreLocation:n=>{const r=t();if(r.actionsRemaining<=0||r.phase!=="exploration")return;const i=U.checkEvents(r,"exploration");if(i){const{triggeredEvents:u,eventCooldowns:h}=U.markEventTriggered(i.id,r.day,r);e({phase:"narrative",currentEvent:"choice",eventResult:{type:"narrative",eventId:i.id},triggeredEvents:u,eventCooldowns:h}),k(t());return}const a=r.rumors.filter(u=>u.day>=r.day-2&&(u.targetLocationId===n.id||!u.targetLocationId)),o=qt(n,r.playerStats,r.equipment,a),l=ve(n,r.day),c={...l,explored:!0,explorationCount:(l.explorationCount||0)+1},d=r.dailyLocations.map(u=>u.id===n.id?c:u),m=r.persistentLocations.map(u=>u.id===n.id?c:u);if(e({dailyLocations:d,persistentLocations:m}),o.event==="combat"){const u=o.combatResult,h=Oe(n.risk);if(u.outcome==="defeat"){e({actionsRemaining:r.actionsRemaining-1,currentEvent:"combat",eventResult:{type:"combat",enemy:h.name,enemyDescription:h.description,outcome:u.outcome},combatResult:u,currentEnemy:h,explorationResult:o});return}if(u.gold){const T=Object.values(r.equipment).filter(Boolean).some(C=>C.cursed&&C.id==="armor_compromised")?Math.floor(u.gold*.9):u.gold;e({gold:r.gold+T})}if(u.durabilityLoss.length>0){const b={...r.equipment};u.durabilityLoss.forEach(T=>{let C,E;if(Object.entries(b).forEach(([w,L])=>{(L==null?void 0:L.id)===T.itemId&&(C=L,E=w)}),C&&E){const w=xe(C,T.amount);yt(w)?delete b[E]:b[E]=w}});const x=F(b);e({equipment:b,playerStats:x})}if(u.lootEarned&&Math.random()<.3){const b=W(n.risk);o.item=b}let v=r.combatsWon,p=r.combatsFled;u.outcome==="flee"?p=r.combatsFled+1:(u.outcome==="victory"||u.outcome==="crushing"||u.outcome==="costly")&&(v=r.combatsWon+1);let g=r.legendaryItemsFound;o.item&&o.item.rarity==="legendary"&&(g=r.legendaryItemsFound+1),e({actionsRemaining:r.actionsRemaining-1,currentEvent:"combat",eventResult:{type:"combat",enemy:h.name,enemyDescription:h.description,outcome:u.outcome},combatResult:u,currentEnemy:h,explorationResult:o,lootedItem:o.item||null,combatsWon:v,combatsFled:p,legendaryItemsFound:g})}else if(o.event==="loot"){e({actionsRemaining:r.actionsRemaining-1,currentEvent:"loot",eventResult:{type:"loot",item:o.item,gold:o.gold,message:o.specialMessage?`${o.specialMessage} ${o.item?`Tu trouves ${o.item.name}.`:`Tu trouves ${o.gold} pi√®ces d'or.`}`:o.item?`Tu trouves ${o.item.name}.`:`Tu trouves ${o.gold} pi√®ces d'or.`},lootedItem:o.item||null,explorationResult:o});const h=Object.values(r.equipment).filter(Boolean).some(g=>g.cursed&&g.id==="armor_cursed");let v=r.gold;if(o.gold){const g=h?Math.floor(o.gold*.9):o.gold;v=r.gold+g}let p=r.legendaryItemsFound;o.item&&o.item.rarity==="legendary"&&(p=r.legendaryItemsFound+1),e({gold:v,legendaryItemsFound:p})}else o.event==="empty"?e({actionsRemaining:r.actionsRemaining-1,currentEvent:"empty",eventResult:{type:"empty",message:o.atmosphereText},explorationResult:o}):o.event==="choice"&&e({actionsRemaining:r.actionsRemaining-1,currentEvent:"choice",eventResult:{type:"choice",choiceId:o.choiceId,choiceText:o.choiceText,choices:o.choices},explorationResult:o})},finishEvent:()=>{var i;const n=t();if(((i=n.combatResult)==null?void 0:i.outcome)==="defeat"){e({phase:"defeat",combatsLost:n.combatsLost+1}),k(t());return}const r=n.phase==="narrative"?"aube":n.phase;e({phase:r,currentEvent:"none",eventResult:null,combatResult:null}),_(t()).catch(()=>{})},endDay:()=>{const n=t(),r=new Dt,i=U.checkEvents(n,"crepuscule");if(i){const{triggeredEvents:v,eventCooldowns:p}=U.markEventTriggered(i.id,n.day,n);e({phase:"narrative",currentEvent:"choice",eventResult:{type:"narrative",eventId:i.id},triggeredEvents:v,eventCooldowns:p}),k(t());return}const a=2;let o=n.gold,l=n.debt;n.gold>=a?o=n.gold-a:l=n.debt+a;const{day:c,debt:d,actionsRemaining:m}=r.advanceDay(n.day,l),u=r.checkEndConditions({day:c,debt:d,gold:n.gold,phase:n.phase});if(u==="victory"){e({phase:"victory"}),k(t());return}else if(u==="defeat"){e({phase:"defeat"}),k(t());return}let h={...n.narrativeCounters};if(c===20){const v=h.humanite||0,p=h.cynisme||0,g=h.pragmatisme||0;v>=9&&v<10?h.humanite=10:p>=9&&p<10?h.cynisme=10:g>=9&&g<10&&(h.pragmatisme=10)}e({day:c,debt:d,gold:o,actionsRemaining:m,phase:"aube",narrativeCounters:h}),k(t())},handleDefeat:()=>{e({phase:"defeat"})},resetGame:()=>{e({...ie,phase:"start"})},addItemToInventory:n=>{const r=t();return r.inventory.length>=10?!1:(e({inventory:[...r.inventory,n]}),!0)},equipItem:n=>{const r=t(),i={...r.equipment};if(Object.values(i).some(d=>(d==null?void 0:d.id)===n.id))return;let o=null;if(i[n.slot]&&(o=i[n.slot]),o&&r.inventory.length>=10){console.warn("Inventaire plein, impossible d'√©quiper sans perdre l'ancien item");return}i[n.slot]=n;let l=r.inventory.filter(d=>d.id!==n.id);o&&(l=[...l,o]);const c=F(i);e({equipment:i,inventory:l,playerStats:c}),k(t())},unequipItem:n=>{const r=t();if(!r.equipment[n])return;const i=r.equipment[n];if(r.inventory.length>=10)return;const a={...r.equipment};delete a[n];const o=F(a);e({equipment:a,inventory:[...r.inventory,i],playerStats:o})},openInventory:()=>{e({phase:"inventory"})},closeInventory:()=>{t().currentEvent==="none"?e({phase:"aube"}):e({phase:"exploration"})},sellItem:n=>{const r=t();if(r.inventory.findIndex(l=>l.id===n.id)===-1){console.warn("Item non trouv√© dans l'inventaire");return}const a=Bt(n,r.reputation,r.narrativeCounters),o=r.inventory.filter(l=>l.id!==n.id);e({inventory:o,gold:r.gold+a}),_(t()).catch(()=>{})},buyItem:n=>{const r=t(),i=Wt(n,r.reputation,r.narrativeCounters);if(r.gold<i)return console.warn("Or insuffisant"),!1;if(r.inventory.length>=10)return console.warn("Inventaire plein"),!1;const a=r.marketStock.filter(o=>o.id!==n.id);return e({gold:r.gold-i,marketStock:a,inventory:[...r.inventory,n]}),j.playSound("coins_loss",.7).catch(()=>{}),_(t()).catch(()=>{}),!0},repayDebt:n=>{const r=t();if(r.gold<n)return console.warn("Or insuffisant"),!1;const i=Math.min(n,r.debt),a={...r.characterArcs};if(a.morten){const o=je(a.morten.trustLevel,"repay",i);a.morten.trustLevel=o,a.morten.lastInteractionDay=r.day,a.morten.storyStage=se(re,r.day,r.debt-i,o,a.morten.flags)}return e({gold:r.gold-i,debt:r.debt-i,characterArcs:a}),j.playSound("coins_loss",.7).catch(()=>{}),_(t()).catch(()=>{}),!0},buyMeal:()=>{const n=t(),r=4;return n.gold<r?(console.warn("Or insuffisant pour le repas"),!1):n.hasEatenToday?(console.warn("D√©j√† mang√© aujourd'hui"),!1):(e(i=>({gold:i.gold-r,hasEatenToday:!0,narrativeCounters:{...i.narrativeCounters,humanite:(i.narrativeCounters.humanite||0)+1}})),k(t()),!0)},generateMarketStock:()=>{const n=t();if(n.marketStockDay===n.day&&n.marketStock.length>0)return;const r=Math.floor(Math.random()*3)+3,i=[];for(let a=0;a<r;a++){const o=Math.min(4,Math.floor(n.day/5)+1),l=W(o);i.push(l)}e({marketStock:i,marketStockDay:n.day})},repairItem:n=>{const r=t(),i=Ut(n,r.narrativeCounters);if(r.gold<i)return console.warn("Or insuffisant pour r√©parer"),!1;if(n.durability>=n.maxDurability)return console.warn("Item d√©j√† √† 100%"),!1;const a=Ft(n);let o={...r.equipment},l=[...r.inventory],c=!1;if(Object.entries(o).forEach(([m,u])=>{(u==null?void 0:u.id)===n.id&&(o[m]=a,c=!0)}),!c){const m=l.findIndex(u=>u.id===n.id);m>-1&&(l[m]=a,c=!0)}if(!c)return console.warn("Item non trouv√©"),!1;let d=r.playerStats;return Object.values(o).some(m=>(m==null?void 0:m.id)===n.id)&&(d=F(o)),e({gold:r.gold-i,equipment:o,inventory:l,playerStats:d}),k(t()),!0},buyForgeItem:n=>{const r=t(),i=n.value*2;return r.gold<i?(console.warn("Or insuffisant"),!1):r.inventory.length>=10?(console.warn("Inventaire plein"),!1):(e({gold:r.gold-i,forgeStock:null,inventory:[...r.inventory,n]}),k(t()),!0)},generateForgeStock:()=>{const n=t();if(!(n.forgeStockDay===n.day&&n.forgeStock!==null))if(Math.random()<.2){const r=Math.min(4,Math.floor(n.day/3)+2),i=W(r);if(i.rarity!=="rare"&&i.rarity!=="legendary")for(let a=0;a<5;a++){const o=W(r);if(o.rarity==="rare"||o.rarity==="legendary"){e({forgeStock:o,forgeStockDay:n.day});return}}else e({forgeStock:i,forgeStockDay:n.day})}else e({forgeStock:null,forgeStockDay:n.day})},setNPCFlag:(n,r)=>{e(i=>({npcFlags:{...i.npcFlags,[n]:r}})),k(t())},generateRumors:()=>{const n=t(),r=n.dailyLocations.length>0?n.dailyLocations:n.persistentLocations.filter(c=>!c.explored),i=Se(n.day,n.rumors,r.map(c=>({id:c.id,type:c.type}))),a=n.rumors.filter(c=>c.day>=n.day-3),o=new Set(a.map(c=>c.id)),l=i.filter(c=>!o.has(c.id));e({rumors:[...a,...l]})},triggerNarrativeEvent:n=>{e({phase:"narrative",currentEvent:"choice",eventResult:{type:"narrative",eventId:n}}),k(t())},applyEventConsequence:n=>{let i={...t()};if(n.gold){const l=Object.values(i.equipment).filter(Boolean).some(c=>c.cursed&&c.id==="armor_cursed")&&n.gold>0?Math.floor(n.gold*.9):n.gold;i.gold=Math.max(0,i.gold+l)}if(n.reputation){const o=Object.values(i.equipment).filter(Boolean).some(m=>m.cursed&&m.id==="amulet_compromised");let l=n.reputation;o&&l>0&&(l=Math.max(0,l-1));const c=i.narrativeCounters.humanite||0,d=i.narrativeCounters.cynisme||0;c>=15&&l>=0&&(l+=1),d>=15&&l>0&&(l=Math.max(0,l-1)),i.reputation=Math.max(1,Math.min(5,i.reputation+l))}if(n.debt&&(i.debt=Math.max(0,i.debt+n.debt)),n.actionsRemaining&&(i.actionsRemaining=Math.max(0,i.actionsRemaining+n.actionsRemaining)),n.items&&n.items.forEach(a=>{let o;if(a==="cursed_item"){const l=ye[Math.floor(Math.random()*ye.length)];o={...l,id:`${l.id}_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,durability:l.maxDurability}}else o=W(4);i.inventory.length<10&&i.inventory.push(o)}),n.durabilityLoss){const a=Object.values(i.equipment).filter(Boolean);if(a.length>0){const o=a[Math.floor(Math.random()*a.length)],l=xe(o,n.durabilityLoss);Object.entries(i.equipment).forEach(([c,d])=>{(d==null?void 0:d.id)===o.id&&(i.equipment[c]=l)}),i.playerStats=F(i.equipment)}}n.flags&&(i.npcFlags={...i.npcFlags,...n.flags}),n.counters&&Object.entries(n.counters).forEach(([a,o])=>{i.narrativeCounters[a]=(i.narrativeCounters[a]||0)+o}),e(i),_(t()).catch(()=>{})},incrementCounter:(n,r)=>{const a=t().narrativeCounters[n]||0,o=a+r;if(e(l=>({narrativeCounters:{...l.narrativeCounters,[n]:o}})),a<8&&o>=8||a<12&&o>=12){const l=o>=12?12:8;if(console.log(`üéØ ${n==="humanite"?"Humanit√©":n==="cynisme"?"Cynisme":n==="pragmatisme"?"Pragmatisme":n} atteint ${l}! Bonus activ√©.`),l===8)n==="humanite"?console.log("üíö Bonus : +10% prix de vente au march√©"):n==="cynisme"?console.log("üíî Bonus : -15% prix d'achat au march√©"):n==="pragmatisme"&&console.log("üíô Bonus : -15% co√ªt de r√©paration √† la forge");else if(l===12){const d=n==="humanite"?"La R√©demption":n==="cynisme"?"La Survie":n==="pragmatisme"?"L'Efficacit√©":"";d&&console.log(`üèÜ Fin disponible : ${d}`)}}k(t())},initCharacterArc:n=>{const r=t();if(r.characterArcs[n])return;const i=Ce(n,r.day);e({characterArcs:{...r.characterArcs,[n]:i}}),k(t())},updateCharacterArc:(n,r)=>{const i=t(),a=i.characterArcs[n];if(!a){console.warn(`Arc narratif non trouv√© pour ${n}`);return}const o={...a,...r};e({characterArcs:{...i.characterArcs,[n]:o}}),k(t())},getCharacterArc:n=>t().characterArcs[n]||null,updateCharacterTrust:(n,r,i)=>{const a=t(),o=a.characterArcs[n];if(!o){console.warn(`Arc narratif non trouv√© pour ${n}`);return}const l=je(o.trustLevel,r,i),c={...o,trustLevel:l,lastInteractionDay:a.day};n==="morten"&&(c.storyStage=se(re,a.day,a.debt,l,c.flags)),e({characterArcs:{...a.characterArcs,[n]:c}}),k(t())}}));function Ht(){const e=y(t=>t.phase);f.useEffect(()=>{const t=j.getSettings();if(!(t.muted||!t.musicEnabled)){switch(e){case"aube":case"marche":case"morten":case"forge":case"taverne":case"inventory":j.playMusic("ambient_camp",1e3);break;case"exploration":j.playMusic("ambient_explore",1e3);break;case"crepuscule":j.playMusic("ambient_camp",1e3);break;case"start":case"origin":case"tutorial":case"defeat":case"victory":case"hallOfFame":case"settings":j.stopMusic(500);break}return()=>{}}},[e])}function H(e=768){const[t,n]=f.useState(()=>typeof window>"u"?!1:window.innerWidth<e);return f.useEffect(()=>{const r=()=>{n(window.innerWidth<e)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[e]),t}function Ne(){const[e,t]=f.useState(()=>{if(typeof window>"u")return!1;const n=window.innerWidth<400,r="ontouchstart"in window||navigator.maxTouchPoints>0,i=navigator.hardwareConcurrency<4,a=navigator.deviceMemory?navigator.deviceMemory<4:!1;return n&&r||i||a});return f.useEffect(()=>{(()=>{const r=performance.now();performance.now()-r>1&&t(!0)})()},[]),e}function Jt({children:e,phase:t}){const n=H(),r=Ne(),i=n||r,a=["marche","morten","forge","taverne","inventory","settings"].includes(t);return i?s.jsx("div",{style:{width:"100%",flex:1,display:"flex",flexDirection:"column"},children:e}):s.jsx(z,{mode:"wait",children:s.jsx(S.div,{initial:a?{opacity:0,x:20}:{opacity:0},animate:a?{opacity:1,x:0}:{opacity:1},exit:a?{opacity:0,x:-20}:{opacity:0},transition:{duration:.2,ease:"easeOut"},style:{width:"100%",flex:1,display:"flex",flexDirection:"column"},children:e},t)})}async function Xt(){if(typeof indexedDB>"u"){console.warn("IndexedDB not available");return}const e=["souda_save","souda_meta","hallOfFame"];for(const t of e)try{const n=indexedDB.deleteDatabase(t);await new Promise((r,i)=>{n.onsuccess=()=>{console.log(`IndexedDB ${t} supprim√©e`),r()},n.onerror=()=>{console.error(`Erreur suppression ${t}:`,n.error),i(n.error)},n.onblocked=()=>{console.warn(`${t} est bloqu√©e, r√©essayez`),r()}})}catch(n){console.error(`Erreur lors de la suppression de ${t}:`,n)}}function Yt(){try{localStorage.clear(),console.log("localStorage nettoy√©")}catch(e){console.error("Erreur lors du nettoyage localStorage:",e)}}async function Qt(){console.log("üßπ Nettoyage du cache en cours...");try{await Xt(),Yt(),console.log("‚úÖ Cache nettoy√©, rechargement de la page..."),await new Promise(e=>setTimeout(e,500)),window.location.reload()}catch(e){console.error("‚ùå Erreur lors du nettoyage:",e),window.location.reload()}}function Kt(){const[e,t]=f.useState(!1),{resetGame:n,phase:r,day:i,gold:a,debt:o}=y(),l=async()=>{confirm(`üêõ Vider tout le cache et recharger ?

‚ö†Ô∏è Action irr√©versible !`)&&await Qt()},c=()=>{confirm("üîÑ Reset du jeu (sans nettoyer le cache) ?")&&(n(),t(!1))},d=()=>{const m=y.getState();console.log("üìä √âTAT DU JEU:",{phase:r,day:i,gold:a,debt:o,reputation:m.reputation,inventory:m.inventory.length,equipment:Object.keys(m.equipment).length,combatsWon:m.combatsWon,combatsLost:m.combatsLost,fullState:m}),alert("√âtat du jeu affich√© dans la console (F12)"),t(!1)};return s.jsxs("div",{style:{position:"fixed",top:"10px",left:"10px",zIndex:9999,fontFamily:"monospace"},children:[s.jsx("button",{onClick:()=>t(!e),style:{padding:"0.5rem",background:"transparent",border:"2px solid #e66",color:"#fff",fontSize:"0.7rem",fontWeight:"bold",cursor:"pointer",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},title:"Debug Panel",children:"üêõ"}),e&&s.jsxs("div",{style:{marginTop:"0.5rem",background:"#2a1a1a",border:"2px solid #c44",borderRadius:"4px",padding:"0.75rem",minWidth:"200px",boxShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:[s.jsxs("div",{style:{fontSize:"0.75rem",fontWeight:"bold",color:"#f88",marginBottom:"0.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{children:"DEBUG"}),s.jsx("button",{onClick:()=>t(!1),style:{background:"transparent",border:"none",color:"#f88",cursor:"pointer",fontSize:"1rem",padding:"0"},children:"√ó"})]}),s.jsxs("div",{style:{fontSize:"0.65rem",color:"#aaa",marginBottom:"0.75rem",padding:"0.5rem",background:"#1a0a0a",borderRadius:"2px"},children:["J",i," | ",a,"üí∞ | ",o,"üí∞ | ",r]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsx("button",{onClick:d,style:{padding:"0.5rem",background:"#555",border:"1px solid #777",color:"#fff",fontSize:"0.7rem",cursor:"pointer",borderRadius:"2px",textAlign:"left"},onMouseEnter:m=>{m.currentTarget.style.background="#666"},onMouseLeave:m=>{m.currentTarget.style.background="#555"},children:"üìä √âtat console"}),s.jsx("button",{onClick:c,style:{padding:"0.5rem",background:"#555",border:"1px solid #777",color:"#fff",fontSize:"0.7rem",cursor:"pointer",borderRadius:"2px",textAlign:"left"},onMouseEnter:m=>{m.currentTarget.style.background="#666"},onMouseLeave:m=>{m.currentTarget.style.background="#555"},children:"üîÑ Reset jeu"}),s.jsx("button",{onClick:l,style:{padding:"0.5rem",background:"#c44",border:"1px solid #e66",color:"#fff",fontSize:"0.7rem",cursor:"pointer",borderRadius:"2px",textAlign:"left",fontWeight:"bold"},onMouseEnter:m=>{m.currentTarget.style.background="#d55"},onMouseLeave:m=>{m.currentTarget.style.background="#c44"},children:"üßπ Cache + Reload"})]})]})]})}const Zt=[{id:"aube_first",title:"Bienvenue √† l'Aube",text:"C'est le d√©but de ta journ√©e. Tu peux visiter le March√©, la Forge, l'Usurier ou la Taverne. Puis pars en exploration.",phase:"aube",condition:e=>e.day===1},{id:"exploration_first",title:"Exploration",text:"Choisis un lieu √† explorer. Les rumeurs (ic√¥nes) t'aident √† savoir o√π aller. Chaque exploration co√ªte 1 action.",phase:"exploration",condition:e=>e.day===1&&e.actionsRemaining===3},{id:"inventory_first",title:"Inventaire",text:"√âquipe tes meilleurs items pour augmenter tes stats (ATK, DEF, VIT). Les items compromis ont des malus cach√©s.",phase:"inventory",condition:e=>e.inventory.length>0&&!e.npcFlags.inventoryGuideSeen},{id:"taverne_rumors",title:"Rumeurs",text:`Les rumeurs apparaissent ici chaque jour. Elles t'aident √† planifier tes explorations. Clique sur "D√©tails" pour voir leur impact.`,phase:"taverne",condition:e=>e.rumors.length>0&&!e.npcFlags.taverneGuideSeen},{id:"marche_first",title:"March√©",text:"Ach√®te et vends des items ici. Les prix varient selon ta r√©putation et tes compteurs narratifs.",phase:"marche",condition:e=>e.day<=3&&!e.npcFlags.marcheGuideSeen},{id:"forge_first",title:"Forge",text:"R√©pare tes items ici. Plus l'item est rare, plus c'est cher. Le pragmatisme r√©duit les co√ªts.",phase:"forge",condition:e=>Object.values(e.equipment).some(n=>n&&n.durability&&n.durability<100)&&!e.npcFlags.forgeGuideSeen},{id:"morten_first",title:"Usurier",text:"Rembourse ta dette ici. Les int√©r√™ts augmentent chaque jour. Priorise le remboursement.",phase:"morten",condition:e=>e.debt>100&&!e.npcFlags.mortenGuideSeen},{id:"crepuscule_first",title:"Cr√©puscule",text:"C'est la fin de ta journ√©e. Tu peux avoir des √©v√©nements du soir et voir ta progression vers les fins.",phase:"crepuscule",condition:e=>e.day===1}];function en({phase:e}){const[t,n]=f.useState(null),[r,i]=f.useState(new Set),a=y();if(f.useEffect(()=>{const l=Zt.find(c=>!(r.has(c.id)||c.phase&&c.phase!==e||c.condition&&!c.condition(a)));n(l||null)},[e,a,r]),!t)return null;const o=()=>{i(c=>new Set([...c,t.id])),n(null);const l=`${t.id.replace("_first","")}GuideSeen`;l in a.npcFlags&&y.setState({npcFlags:{...a.npcFlags,[l]:!0}})};return s.jsxs("div",{style:{position:"fixed",bottom:"1rem",right:"1rem",background:"#2a2a2a",border:"2px solid #4a4",borderRadius:"8px",padding:"1rem",maxWidth:"300px",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.5)"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[s.jsxs("h3",{style:{margin:0,fontSize:"1rem",color:"#ddd",marginBottom:"0.5rem"},children:["üí° ",t.title]}),s.jsx("button",{onClick:o,style:{background:"transparent",border:"none",color:"#888",cursor:"pointer",fontSize:"1.2rem",padding:"0",marginLeft:"0.5rem"},title:"Fermer",children:"√ó"})]}),s.jsx("p",{style:{margin:0,fontSize:"0.85rem",color:"#aaa",lineHeight:"1.5"},children:t.text})]})}function tn({children:e}){const[t,n]=f.useState(()=>{if(typeof window>"u")return!1;const r=typeof window<"u"&&window.document!==void 0,i=window.innerWidth>500;return r&&i});return f.useEffect(()=>{const r=()=>{const i=typeof window<"u"&&window.document!==void 0,a=window.innerWidth>500;n(i&&a)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t?s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#0a0a0a",display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto",padding:"1rem"},children:s.jsx("div",{style:{maxWidth:"480px",width:"100%",height:"100%",maxHeight:"100vh",background:"#1a1a1a",borderRadius:"8px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1)",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"},children:e})}):s.jsx("div",{style:{width:"100%",height:"100vh",minHeight:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:e})}const Y=["La bataille est perdue.","Vos compagnons sont morts.","Vous fuyez dans la nuit...","Tu es un d√©serteur.","Tu dois 80 pi√®ces d'or √† Morten.","Tu as 20 jours.","PAYE... OU MEURS."];function nn({onComplete:e}){const[t,n]=f.useState(0),[r,i]=f.useState(!1),[a,o]=f.useState(!1),l=f.useRef([]);f.useEffect(()=>{const u=setTimeout(()=>{o(!0)},2e3);l.current.push(u),Y.forEach((v,p)=>{const g=setTimeout(()=>{n(p)},p*2e3);l.current.push(g)});const h=setTimeout(()=>{i(!0)},Y.length*2e3+2e3);return l.current.push(h),()=>{l.current.forEach(v=>clearTimeout(v)),l.current=[]}},[]);const c=()=>{l.current.forEach(u=>clearTimeout(u)),l.current=[],e()},d=t===Y.length-1,m=Y[t]||"";return s.jsxs("div",{onClick:c,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#000000",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,overflow:"hidden",cursor:"pointer"},children:[a&&s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},style:{position:"absolute",bottom:"2rem",fontSize:"0.85rem",color:"#666",fontStyle:"italic",textAlign:"center",pointerEvents:"none"},children:"Appuyez n'importe o√π pour passer"}),s.jsx(z,{mode:"wait",children:m&&s.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0,x:d?[0,-1,1,-1,1,0]:0},exit:{opacity:0,y:-20},transition:{opacity:{duration:1.5,ease:"easeOut"},y:{duration:1.5,ease:"easeOut"},x:d?{duration:.5,repeat:2,repeatType:"reverse",ease:"easeInOut"}:void 0},style:{fontSize:d?"2.5rem":"2rem",fontWeight:"bold",color:d?"#8B0000":"#ffffff",textAlign:"center",padding:"2rem",textShadow:d?"0 0 10px rgba(139, 0, 0, 0.8), 0 0 20px rgba(139, 0, 0, 0.5)":"0 0 10px rgba(255, 255, 255, 0.3)",letterSpacing:d?"0.2em":"0.1em",fontFamily:"serif"},children:m},t)}),s.jsx(z,{children:r&&s.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:1,delay:.5},style:{marginTop:"3rem",background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:"2px solid #555",maxWidth:"500px",width:"90%"},onClick:u=>u.stopPropagation(),children:[s.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"1rem",color:"#ca8"},children:"Morten"}),s.jsxs("div",{style:{fontSize:"1rem",lineHeight:"1.6",marginBottom:"1.5rem",color:"#ddd"},children:['"Ah, un autre rat qui fuit le navire..."',s.jsx("br",{}),s.jsx("br",{}),`"Je peux te cacher. Mais rien n'est gratuit."`,s.jsx("br",{}),s.jsx("br",{}),`"Tu me dois 80 pi√®ces d'or. Tu as 20 jours."`]}),s.jsx(S.div,{initial:{scale:0},animate:{scale:1},transition:{delay:1,type:"spring"},style:{fontSize:"1.5rem",fontWeight:"bold",color:"#c44",marginBottom:"1rem",textAlign:"center"},children:"Dette : 80üí∞"}),s.jsx("div",{style:{fontSize:"0.9rem",color:"#aaa",fontStyle:"italic",textAlign:"center",marginBottom:"2rem"},children:"Chaque jour, les int√©r√™ts augmentent..."}),s.jsx(S.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1.5},onClick:u=>{u.stopPropagation(),e()},style:{width:"100%",padding:"1.2rem 3rem",fontSize:"1.2rem",fontWeight:"bold",backgroundColor:"transparent",border:"2px solid #8B0000",color:"#8B0000",cursor:"pointer",textTransform:"uppercase",letterSpacing:"0.1em",fontFamily:"serif",transition:"all 0.3s ease",position:"relative",overflow:"hidden"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="#8B0000",u.currentTarget.style.color="#000000",u.currentTarget.style.boxShadow="0 0 20px rgba(139, 0, 0, 0.8)"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="transparent",u.currentTarget.style.color="#8B0000",u.currentTarget.style.boxShadow="none"},children:"COMMENCER MA DETTE"})]})})]})}function rn(){const e=y(p=>p.setPhase),[t,n]=f.useState(!0),[r,i]=f.useState(!1),[a,o]=f.useState(null),[l,c]=f.useState(!0),[d,m]=f.useState(!1);f.useEffect(()=>{localStorage.getItem("souda_intro_seen")==="true"&&(n(!1),i(!0))},[]),f.useEffect(()=>{(async()=>{try{const g=await At();o(g)}catch(g){console.warn("Erreur v√©rification save:",g)}finally{c(!1)}})()},[]);const u=async()=>{try{const p=await Ue();p&&(y.setState(p),e(p.phase||"aube"))}catch(p){console.error("Erreur chargement save:",p)}},h=()=>{localStorage.setItem("souda_intro_seen","true"),n(!1),i(!0)},v=p=>{p.preventDefault(),p.stopPropagation(),console.log("üîµ Bouton NOUVELLE PARTIE cliqu√©"),console.log("üîµ setPhase disponible:",typeof e),console.log("üîµ Phase actuelle:",y.getState().phase);try{console.log('üîµ Appel de setPhase("origin")...'),e("origin"),console.log("‚úÖ setPhase appel√©, nouvelle phase:",y.getState().phase),setTimeout(()=>{const g=y.getState().phase;console.log("üîµ Phase apr√®s 100ms:",g),g!=="origin"&&console.error("‚ùå La phase n'a pas chang√© ! Phase actuelle:",g)},100)}catch(g){console.error("‚ùå Erreur lors du changement de phase:",g)}};return t&&!r?s.jsx(nn,{onComplete:h}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,justifyContent:"center",alignItems:"center",textAlign:"center",position:"relative",zIndex:1},children:[s.jsx("div",{style:{fontSize:"3rem",fontWeight:"bold",marginBottom:"1rem",color:"#fff",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"SOUDA"}),s.jsxs("div",{style:{fontSize:"1.1rem",color:"#ccc",fontStyle:"italic",marginBottom:"2rem",maxWidth:"400px",lineHeight:"1.6"},children:[`"Tu es un d√©serteur qui pille les ruines d'une guerre oubli√©e.`,s.jsx("br",{}),'20 jours pour rembourser tes dettes ou mourir."']}),s.jsxs("div",{style:{background:"#2a2a2a",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555",marginBottom:"2rem",maxWidth:"400px"},children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#aaa",marginBottom:"0.5rem"},children:"R√®gles du jeu"}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#ccc",lineHeight:"1.6",textAlign:"left"},children:["‚Ä¢ Survie 20 jours",s.jsx("br",{}),"‚Ä¢ Rembourse 80üí∞ de dette (+5üí∞/jour int√©r√™ts)",s.jsx("br",{}),"‚Ä¢ Mort en combat = fin de partie",s.jsx("br",{}),"‚Ä¢ Chaque run compte"]})]}),!l&&a&&s.jsxs("button",{onClick:u,type:"button",style:{fontSize:"1.3rem",padding:"1.2rem 2.5rem",minWidth:"250px",background:"#3a5a3a",border:"2px solid #5a7a5a",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",cursor:"pointer",color:"#fff",fontWeight:"bold",transition:"all 0.2s ease",position:"relative",zIndex:10,marginBottom:"1rem"},onMouseEnter:p=>{p.currentTarget.style.background="#4a6a4a",p.currentTarget.style.transform="scale(1.05)"},onMouseLeave:p=>{p.currentTarget.style.background="#3a5a3a",p.currentTarget.style.transform="scale(1)"},children:["CONTINUER (Jour ",a.day,")"]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",width:"100%",maxWidth:"250px"},children:[s.jsx("button",{onClick:v,type:"button",style:{fontSize:"1.3rem",padding:"1.2rem 2.5rem",width:"100%",background:"#555",border:"2px solid #777",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",cursor:"pointer",color:"#fff",fontWeight:"bold",transition:"all 0.2s ease",position:"relative",zIndex:10},onMouseEnter:p=>{p.currentTarget.style.background="#666",p.currentTarget.style.transform="scale(1.05)"},onMouseLeave:p=>{p.currentTarget.style.background="#555",p.currentTarget.style.transform="scale(1)"},children:"NOUVELLE PARTIE"}),s.jsx("button",{onClick:()=>m(!0),type:"button",style:{fontSize:"1rem",padding:"0.8rem 1.5rem",width:"100%",background:"transparent",border:"1px solid #666",cursor:"pointer",color:"#aaa",fontWeight:"normal",transition:"all 0.2s ease"},onMouseEnter:p=>{p.currentTarget.style.borderColor="#888",p.currentTarget.style.color="#ccc"},onMouseLeave:p=>{p.currentTarget.style.borderColor="#666",p.currentTarget.style.color="#aaa"},children:"‚ùì Comment jouer"})]}),d&&s.jsx("div",{onClick:()=>m(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem"},children:s.jsxs("div",{onClick:p=>p.stopPropagation(),style:{background:"#2a2a2a",border:"2px solid #555",borderRadius:"8px",padding:"2rem",maxWidth:"500px",width:"100%",maxHeight:"80vh",overflowY:"auto"},children:[s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1.5rem",color:"#fff",textAlign:"center"},children:"COMMENT JOUER"}),s.jsxs("div",{style:{fontSize:"1rem",lineHeight:"1.8",color:"#ddd",marginBottom:"1.5rem"},children:[s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("strong",{style:{color:"#ca8"},children:"Objectif :"})," Survivez 20 jours et remboursez 80üí∞ de dette (+5üí∞/jour d'int√©r√™ts)."]}),s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("strong",{style:{color:"#ca8"},children:"Chaque jour :"}),s.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[s.jsx("li",{children:"Explorez les lieux pour trouver de l'or et des objets"}),s.jsx("li",{children:"Vendez au march√© pour gagner de l'or"}),s.jsx("li",{children:"Remboursez votre dette √† l'usurier"}),s.jsx("li",{children:"Mangez √† la taverne pour √©viter les p√©nalit√©s"})]})]}),s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("strong",{style:{color:"#ca8"},children:"Combat :"})," Si vous perdez un combat, c'est la fin de partie. √âquipez-vous bien avant d'explorer."]}),s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("strong",{style:{color:"#ca8"},children:"Progression :"})," M√™me en perdant, vous gagnez de l'XP m√©ta pour d√©bloquer de nouveaux contenus."]})]}),s.jsx("button",{onClick:()=>m(!1),style:{width:"100%",padding:"1rem",fontSize:"1.1rem",fontWeight:"bold",background:"#555",border:"2px solid #777",color:"#fff",cursor:"pointer",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:p=>{p.currentTarget.style.background="#666"},onMouseLeave:p=>{p.currentTarget.style.background="#555"},children:"Compris"})]})})]})}const ce=["legs","torso","head","hands","weapon","offhand","accessory"];function sn(e){return ce.filter(n=>e[n]).map(n=>`${n}:${e[n].id}`).join("_")}function we(e){return`/sprites/${e.slot}_${e.rarity}_${e.id}.png`}function Ee(e,t){return`/sprites/${e}_${t}_placeholder.svg`}function J(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=()=>n(new Error(`Failed to load image: ${e}`)),r.src=e})}class an{constructor(){R(this,"cache",new Map);R(this,"maxSize",100);R(this,"accessCounter",0)}get(t){const n=this.cache.get(t);return n?(n.lastUsed=++this.accessCounter,n.imageData):null}set(t,n){this.cache.size>=this.maxSize&&!this.cache.has(t)&&this.evictLRU(),this.cache.set(t,{imageData:n,lastUsed:++this.accessCounter})}evictLRU(){let t=null,n=1/0;for(const[r,i]of this.cache.entries())i.lastUsed<n&&(n=i.lastUsed,t=r);t&&this.cache.delete(t)}clear(){this.cache.clear(),this.accessCounter=0}size(){return this.cache.size}}const Me=new an,I=64;function on(){if(typeof window>"u")return!1;const e=window.innerWidth<400,t="ontouchstart"in window||navigator.maxTouchPoints>0,n=navigator.hardwareConcurrency<4,r=navigator.deviceMemory?navigator.deviceMemory<4:!1;return e&&t||n||r}async function ke(e,t){const n=performance.now(),r=sn(e),i=t?`${r}_preview:${t.slot}:${t.id}`:r,a=Me.get(i);if(a)return a;const o=document.createElement("canvas");o.width=I,o.height=I;const l=o.getContext("2d");if(!l)throw new Error("Failed to get canvas context");const c=on(),d=[];d.push(J("/sprites/body_base.svg").catch(()=>{const g=document.createElement("canvas");g.width=I,g.height=I;const b=g.getContext("2d");b.fillStyle="#444",b.fillRect(0,0,I,I);const x=new Image;return x.src=g.toDataURL(),x}).then(g=>({slot:"body",img:g})));for(const g of ce){const b=e[g];if(b)if(c)d.push(Q(g,b.rarity).then(x=>({slot:g,img:x})));else{const x=we(b);d.push(J(x).catch(()=>{const T=Ee(g,b.rarity);return J(T).catch(()=>Q(g,b.rarity))}).then(T=>({slot:g,img:T})))}}let m;if(c){m=[];for(const g of d)try{const b=await Promise.race([g,new Promise((x,T)=>{setTimeout(()=>T(new Error("Timeout")),500)})]);m.push(b)}catch{const b=await Q("unknown","common");m.push({slot:"unknown",img:b})}}else m=await Promise.all(d);const u=m.find(g=>g.slot==="body");u&&l.drawImage(u.img,0,0,I,I);for(const g of ce){const b=m.find(x=>x.slot===g);b&&l.drawImage(b.img,0,0,I,I)}if(t){const g=we(t);try{const b=await J(g).catch(()=>{const x=Ee(t.slot,t.rarity);return J(x.replace(".png",".svg")).catch(()=>Q(t.slot,t.rarity))});l.globalAlpha=.5,l.drawImage(b,0,0,I,I),l.globalAlpha=1}catch(b){console.warn("Failed to load preview image:",b)}}const h=l.getImageData(0,0,I,I);Me.set(i,h);const v=performance.now()-n,p=typeof window<"u"&&window.innerWidth<768?33:16;return v>p&&console.warn(`Render took ${v.toFixed(2)}ms (target: <${p}ms)`),h}function Q(e,t){return new Promise(n=>{const r=document.createElement("canvas");r.width=I,r.height=I;const i=r.getContext("2d"),a={common:"#808080",uncommon:"#2ecc71",rare:"#3498db",legendary:"#f39c12"};i.fillStyle=a[t]||"#808080",i.fillRect(0,0,I,I),i.strokeStyle="#000",i.lineWidth=2,i.strokeRect(1,1,I-2,I-2);const o=new Image;o.onload=()=>n(o),o.src=r.toDataURL()})}function ln({equipment:e,showPreview:t,size:n=128}){const r=f.useRef(null),[i,a]=f.useState(!0),[o,l]=f.useState(null),c=Ne(),{narrativeCounters:d}=y(),m=d.humanite||0,u=d.cynisme||0,h=d.pragmatisme||0,v={humanite:Math.min(1,m/10),cynisme:Math.min(1,u/10),pragmatisme:Math.min(1,h/10)},p={humanite:m>=3,cynisme:u>=3,pragmatisme:h>=3},g=f.useMemo(()=>JSON.stringify(e),[e]),b=f.useMemo(()=>t?`${t.slot}:${t.id}`:null,[t]);f.useEffect(()=>{const T=r.current;if(!T)return;const C=T.getContext("2d",{alpha:!c,desynchronized:c,willReadFrequently:!1});if(!C)return;a(!0),l(null),(c?new Promise(w=>{setTimeout(()=>{ke(e,t).then(w)},50)}):ke(e,t)).then(w=>{C.clearRect(0,0,T.width,T.height),C.putImageData(w,0,0),a(!1)}).catch(w=>{console.error("Failed to render character:",w),l("Erreur de rendu"),a(!1)})},[g,b,c]);const x=T=>{if(!p[T])return;const C={humanite:"#4a4",cynisme:"#c44",pragmatisme:"#88a"},E=v[T],w=.15+E*.25;return{position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",borderRadius:"6px",border:`2px solid ${C[T]}`,opacity:w,boxShadow:`0 0 ${8+E*12}px ${C[T]}`,pointerEvents:"none",transition:"opacity 0.3s, box-shadow 0.3s"}};return s.jsxs("div",{style:{position:"relative",width:n,height:n,display:"flex",alignItems:"center",justifyContent:"center",background:"#1a1a1a",borderRadius:"4px",border:"1px solid #555"},children:[p.humanite&&s.jsx("div",{style:x("humanite")}),p.cynisme&&s.jsx("div",{style:x("cynisme")}),p.pragmatisme&&s.jsx("div",{style:x("pragmatisme")}),s.jsx("canvas",{ref:r,width:64,height:64,style:{width:n,height:n,imageRendering:"pixelated",position:"relative",zIndex:1}}),i&&s.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#888",fontSize:"0.8rem",zIndex:2},children:"Chargement..."}),o&&s.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#c44",fontSize:"0.8rem",textAlign:"center",zIndex:2},children:o})]})}function cn(){return typeof window<"u"&&window.document!==void 0}function un(){return typeof navigator<"u"&&"vibrate"in navigator&&typeof navigator.vibrate=="function"}const $=class ${constructor(){R(this,"enabled",!0);R(this,"isWeb",!1);R(this,"vibrationAvailable",!1);R(this,"patterns",{loot_common:[10],loot_uncommon:[30],loot_rare:[50,30,50],loot_legendary:[100,50,100,50,200],combat_hit:[20],victory:[50,50,100],defeat:[200],button_press:[5]});this.isWeb=cn(),this.vibrationAvailable=un(),this.loadSettings()}static getInstance(){return $.instance||($.instance=new $),$.instance}triggerVisualFeedback(t){if(!this.isWeb||typeof document>"u")return;const n=document.createElement("div"),r=t==="light"?.05:t==="medium"?.1:.15;if(n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, ${r});
      pointer-events: none;
      z-index: 99999;
      animation: haptic-flash 0.1s ease-out;
    `,!document.getElementById("haptic-flash-style")){const i=document.createElement("style");i.id="haptic-flash-style",i.textContent=`
        @keyframes haptic-flash {
          0% { opacity: 0; }
          50% { opacity: 1; }
          100% { opacity: 0; }
        }
      `,document.head.appendChild(i)}document.body.appendChild(n),setTimeout(()=>n.remove(),100)}vibrate(t){if(this.enabled){if(this.vibrationAvailable)try{navigator.vibrate(t);return}catch(n){console.warn("Vibration failed:",n)}if(this.isWeb){const n=t.reduce((i,a)=>i+a,0),r=n<20?"light":n<100?"medium":"strong";this.triggerVisualFeedback(r)}}}play(t){if(!this.enabled)return;const n=this.patterns[t];n&&this.vibrate(n)}setEnabled(t){this.enabled=t,this.saveSettings()}isEnabled(){return this.enabled}loadSettings(){try{const t=localStorage.getItem("hapticEnabled");t!==null&&(this.enabled=JSON.parse(t))}catch(t){console.warn("Failed to load haptic settings:",t)}}saveSettings(){try{localStorage.setItem("hapticEnabled",JSON.stringify(this.enabled))}catch(t){console.warn("Failed to save haptic settings:",t)}}};R($,"instance",null);let ue=$;const me=ue.getInstance();function dn(){const e=f.useCallback((a,o)=>{j.playSound(a,o)},[]),t=f.useCallback((a,o)=>{j.playMusic(a,o)},[]),n=f.useCallback(a=>{j.stopMusic(a)},[]),r=f.useCallback((a,o)=>{j.crossfadeMusic(a,o)},[]),i=f.useCallback(a=>{me.play(a)},[]);return{playSound:e,playMusic:t,stopMusic:n,crossfadeMusic:r,playHaptic:i,setVolume:j.setVolume.bind(j),mute:j.mute.bind(j),unmute:j.unmute.bind(j),setMusicEnabled:j.setMusicEnabled.bind(j),setSfxEnabled:j.setSfxEnabled.bind(j),getSettings:j.getSettings.bind(j)}}function mn({compact:e=!1,isMobile:t=!1}){const{narrativeCounters:n}=y(),r=n.humanite||0,i=n.cynisme||0,a=n.pragmatisme||0;return e||t?s.jsxs("div",{style:{background:"#1a1a1a",padding:t?"0.5rem":"0.75rem",borderRadius:"4px",fontSize:t?"0.8rem":"0.85rem"},children:[s.jsx("div",{style:{marginBottom:"0.5rem",fontWeight:"bold",color:"#ddd"},children:"√âtat d'esprit"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#4a4"},children:"Humanit√©"}),s.jsxs("span",{style:{color:"#aaa"},children:[r,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"4px",background:"#2a2a2a",borderRadius:"2px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,r/10*100)}%`,height:"100%",background:"#4a4",transition:"width 0.3s"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#c44"},children:"Cynisme"}),s.jsxs("span",{style:{color:"#aaa"},children:[i,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"4px",background:"#2a2a2a",borderRadius:"2px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,i/10*100)}%`,height:"100%",background:"#c44",transition:"width 0.3s"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#88a"},children:"Pragmatisme"}),s.jsxs("span",{style:{color:"#aaa"},children:[a,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"4px",background:"#2a2a2a",borderRadius:"2px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,a/10*100)}%`,height:"100%",background:"#88a",transition:"width 0.3s"}})})]})]})]}):s.jsxs("div",{style:{background:"#2a2a2a",padding:t?"0.75rem":"1rem",borderRadius:"8px",border:"2px solid #555",marginTop:"1rem"},children:[s.jsx("div",{style:{fontSize:t?"1rem":"1.1rem",marginBottom:t?"0.75rem":"1rem",fontWeight:"bold"},children:"√âtat d'esprit"}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem",color:"#aaa"},children:"Compteurs narratifs"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#4a4"},children:"Humanit√©"}),s.jsxs("span",{style:{color:"#aaa"},children:[r,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"8px",background:"#1a1a1a",borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,r/10*100)}%`,height:"100%",background:"#4a4",transition:"width 0.3s"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#c44"},children:"Cynisme"}),s.jsxs("span",{style:{color:"#aaa"},children:[i,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"8px",background:"#1a1a1a",borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,i/10*100)}%`,height:"100%",background:"#c44",transition:"width 0.3s"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[s.jsx("span",{style:{color:"#88a"},children:"Pragmatisme"}),s.jsxs("span",{style:{color:"#aaa"},children:[a,"/10"]})]}),s.jsx("div",{style:{width:"100%",height:"8px",background:"#1a1a1a",borderRadius:"4px",overflow:"hidden"},children:s.jsx("div",{style:{width:`${Math.min(100,a/10*100)}%`,height:"100%",background:"#88a",transition:"width 0.3s"}})})]})]})]})})]})}function pe(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function pn(e,t){let n=0;const r=`${e}-${t}`;for(let i=0;i<r.length;i++){const a=r.charCodeAt(i);n=(n<<5)-n+a,n=n&n}return Math.abs(n%1e4)/1e4}const Ie=[{title:"Gagner de l'or",description:"Gagner {target}üí∞",type:"gold",target:50,xpReward:25},{title:"Gagner de l'or",description:"Gagner {target}üí∞",type:"gold",target:100,xpReward:50},{title:"Gagner de l'or",description:"Gagner {target}üí∞",type:"gold",target:150,xpReward:75},{title:"Survivre sans manger",description:"Survivre 1 jour sans manger",type:"survival",target:1,xpReward:30},{title:"Survivre plusieurs jours",description:"Survivre {target} jours cons√©cutifs",type:"survival",target:2,xpReward:40},{title:"Parler √† Morten",description:"Visiter l'usurier Morten",type:"npc",target:1,xpReward:20},{title:"Explorer les lieux",description:"Explorer {target} lieux diff√©rents",type:"exploration",target:3,xpReward:35},{title:"Explorer les lieux",description:"Explorer {target} lieux diff√©rents",type:"exploration",target:5,xpReward:50},{title:"Gagner un combat",description:"Gagner {target} combat(s)",type:"combat",target:1,xpReward:30},{title:"Gagner des combats",description:"Gagner {target} combat(s)",type:"combat",target:2,xpReward:50}];function Re(){const e=pe(),t=[],n=new Set;for(let r=0;r<3;r++){let i=0,a;do a=Math.floor(pn(e,r)*Ie.length),i++;while(n.has(a)&&i<10);n.add(a);const o=Ie[a],l=o.description.replace("{target}",String(o.target));t.push({id:`daily-${e}-${r}`,title:o.title,description:l,type:o.type,target:o.target,current:0,completed:!1,xpReward:o.xpReward})}return t}function fn(){try{const e=localStorage.getItem("souda_daily_objectives"),t=localStorage.getItem("souda_daily_objectives_date"),n=pe();if(!e||t!==n){const r=Re();return fe(r),r}return JSON.parse(e)}catch(e){return console.error("Erreur chargement objectifs quotidiens:",e),Re()}}function fe(e){try{localStorage.setItem("souda_daily_objectives",JSON.stringify(e)),localStorage.setItem("souda_daily_objectives_date",pe())}catch(t){console.error("Erreur sauvegarde objectifs quotidiens:",t)}}function hn(e,t,n=1){const r=e.map(a=>{if(a.completed||a.type!==t)return a;const o=a.current+n,l=o>=a.target;return{...a,current:Math.min(o,a.target),completed:l}}),i=r.filter(a=>{var o;return a.completed&&!((o=e.find(l=>l.id===a.id))!=null&&o.completed)});return fe(r),{objectives:r,completed:i}}function gn(e){return e<=1?0:e===2?100:e<=5?100+(e-2)*150:e<=10?550+(e-5)*200:e<=20?1550+(e-10)*300:4550+(e-20)*500}function de(e){let t=0;for(let n=2;n<=e;n++)t+=gn(n);return t}const Le={globalXP:0,playerLevel:1,unlockedOrigins:["deserteur"],unlockedItems:[]},yn=Ae()(tt((e,t)=>({...Le,addXP:n=>{const i=t().globalXP+n;return e({globalXP:i}),t().levelUp()},calculateRunXP:(n,r,i)=>{const a=n*50,o=Math.floor(r*.5),l=i*20;return a+o+l},levelUp:()=>{const n=t();let r=n.playerLevel,i=n.globalXP;const a=[];for(;r<30;){const o=de(r+1);if(i>=o){r++;const l=xn(r);a.push(...l),l.forEach(c=>{if(c.startsWith("origin:")){const d=c.replace("origin:","");n.unlockedOrigins.includes(d)||t().unlockOrigin(d)}else if(c.startsWith("item:")){const d=c.replace("item:","");n.unlockedItems.includes(d)||t().unlockItem(d)}})}else break}return r>n.playerLevel?(e({playerLevel:r}),{leveledUp:!0,newLevel:r,unlockedContent:a}):{leveledUp:!1}},unlockOrigin:n=>{const r=t();r.unlockedOrigins.includes(n)||e({unlockedOrigins:[...r.unlockedOrigins,n]})},unlockItem:n=>{const r=t();r.unlockedItems.includes(n)||e({unlockedItems:[...r.unlockedItems,n]})},reset:()=>{e(Le)}}),{name:"souda-meta-progression",storage:nt(()=>({getItem:async e=>{try{const r=(await ae()).transaction(["metaProgression"],"readonly").objectStore("metaProgression");return new Promise((i,a)=>{const o=r.get(e);o.onsuccess=()=>{const l=o.result;i(l?JSON.stringify(l.value):null)},o.onerror=()=>a(o.error)})}catch(t){return console.error("Erreur chargement m√©ta-progression:",t),null}},setItem:async(e,t)=>{try{const i=(await ae()).transaction(["metaProgression"],"readwrite").objectStore("metaProgression");return new Promise((a,o)=>{const l=i.put({key:e,value:JSON.parse(t)});l.onsuccess=()=>a(),l.onerror=()=>o(l.error)})}catch(n){console.error("Erreur sauvegarde m√©ta-progression:",n)}},removeItem:async e=>{try{const r=(await ae()).transaction(["metaProgression"],"readwrite").objectStore("metaProgression");return new Promise((i,a)=>{const o=r.delete(e);o.onsuccess=()=>i(),o.onerror=()=>a(o.error)})}catch(t){console.error("Erreur suppression m√©ta-progression:",t)}}}))}));function ae(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(new Error("IndexedDB not available"));return}const n=indexedDB.open("souda_meta",4);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains("metaProgression")||i.createObjectStore("metaProgression"),i.objectStoreNames.contains("tutorial")||i.createObjectStore("tutorial"),i.objectStoreNames.contains("unlocks")||i.createObjectStore("unlocks"),i.objectStoreNames.contains("hallOfFame")||i.createObjectStore("hallOfFame",{keyPath:"id"})}})}function xn(e){const t=[];return e===2&&t.push("origin:veteran"),e===5&&t.push("origin:pillard"),e===8&&t.push("origin:moine"),e===12&&t.push("origin:noble"),e===15&&t.push("origin:survivant"),e===10&&t.push("item:heavy_weapons"),e===15&&t.push("item:plate_armor"),e===20&&t.push("item:legendary_items"),e===25&&t.push("item:noble_set"),e===30&&t.push("item:master_set"),t}function dr(e,t){const n=de(t),r=de(t+1),i=e-n,a=r-n,o=t>=30?1:i/a;return{currentLevelXP:i,nextLevelXP:a,progress:Math.max(0,Math.min(1,o))}}function vn(){const[e,t]=f.useState([]),{addXP:n}=yn(),{gold:r,combatsWon:i,day:a,phase:o,persistentLocations:l,dailyLocations:c,hasEatenToday:d}=y(),m=f.useRef(0),u=f.useRef(0),h=f.useRef(!1),v=f.useRef(new Set);return f.useEffect(()=>{const p=fn();t(p),m.current=r,u.current=i,v.current=new Set(p.filter(g=>g.completed).map(g=>g.id))},[]),f.useEffect(()=>{if(o==="morten"&&!h.current&&(h.current=!0,e.find(g=>g.type==="npc"&&!g.completed))){const{objectives:g,completed:b}=hn(e,"npc",1);b.forEach(x=>{n(x.xpReward)}),t(g)}o!=="morten"&&(h.current=!1)},[o,e,n]),f.useEffect(()=>{if(e.length===0)return;const p=e.map(x=>{if(x.completed)return x;let T=x.current;switch(x.type){case"gold":r>=x.target&&(T=x.target);break;case"combat":i>=x.target&&(T=Math.min(i,x.target));break;case"exploration":const C=[...l,...c].filter(E=>E.explored).length;C>=x.target&&(T=Math.min(C,x.target));break;case"survival":!d&&a>=2&&x.current<x.target&&(T=x.target);break}return{...x,current:T,completed:T>=x.target}}),g=p.filter((x,T)=>{var C;return x.completed&&!((C=e[T])!=null&&C.completed)});p.some((x,T)=>{var C,E;return x.current!==((C=e[T])==null?void 0:C.current)||x.completed!==((E=e[T])==null?void 0:E.completed)})&&(fe(p),g.forEach(x=>{x.completed&&x.xpReward>0&&!v.current.has(x.id)&&(v.current.add(x.id),n(x.xpReward))}),t(p))},[r,i,l,c,d,a,e,n]),e.length===0?null:s.jsxs("div",{style:{background:"#2a2a2a",padding:"1rem",borderRadius:"8px",border:"2px solid #555",marginBottom:"1rem"},children:[s.jsx("div",{style:{fontSize:"1rem",fontWeight:"bold",marginBottom:"0.75rem",color:"#fff",textAlign:"center"},children:"üìã OBJECTIFS QUOTIDIENS"}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.map((p,g)=>s.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:g*.1},style:{background:p.completed?"#1a3a1a":"#1a1a1a",border:`1px solid ${p.completed?"#2ecc71":"#444"}`,borderRadius:"4px",padding:"0.75rem",fontSize:"0.85rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.25rem"},children:[s.jsxs("div",{style:{color:p.completed?"#2ecc71":"#ccc",fontWeight:p.completed?"bold":"normal"},children:[p.completed?"‚úÖ":"‚≠ï"," ",p.title]}),p.completed&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#2ecc71"},children:["+",p.xpReward," XP"]})]}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#aaa",marginBottom:"0.25rem"},children:p.description}),s.jsx("div",{style:{width:"100%",height:"4px",background:"#1a1a1a",borderRadius:"2px",overflow:"hidden",marginTop:"0.25rem"},children:s.jsx(S.div,{initial:{width:0},animate:{width:`${Math.min(100,p.current/p.target*100)}%`},transition:{duration:.5},style:{height:"100%",background:p.completed?"#2ecc71":"#4a9eff",borderRadius:"2px"}})}),s.jsxs("div",{style:{fontSize:"0.75rem",color:"#888",marginTop:"0.25rem",textAlign:"right"},children:[p.current," / ",p.target]})]},p.id))})]})}function bn(e,t=500){const[n,r]=f.useState(!1),i=f.useRef(null),a=()=>{n||(r(!0),e(),i.current=setTimeout(()=>{r(!1)},t))};return f.useEffect(()=>()=>{i.current&&clearTimeout(i.current)},[]),[a,n]}function $e({showActions:e=!1,showHunger:t=!1}){const{day:n,debt:r,gold:i,reputation:a,actionsRemaining:o,hasEatenToday:l}=y(),c=H(),[d,m]=f.useState(!1),[u,h]=f.useState(!1),v=20-n,p=80+5*19,b=r/p*100>80,x=!l;return f.useEffect(()=>{if(b){m(!0);const T=setTimeout(()=>m(!1),2e3);return()=>clearTimeout(T)}},[b,r]),f.useEffect(()=>{if(x&&t){h(!0);const T=setTimeout(()=>h(!1),2e3);return()=>clearTimeout(T)}},[x,t]),s.jsxs("div",{style:{position:"sticky",top:0,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",padding:c?"0.5rem":"0.6rem",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"0.5rem",fontSize:c?"0.75rem":"0.85rem",minHeight:c?"40px":"44px",maxHeight:c?"60px":"64px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontWeight:"bold",color:"#fff"},children:[s.jsx("span",{style:{fontSize:c?"0.7rem":"0.8rem",opacity:.7},children:"J"}),s.jsx("span",{style:{fontSize:c?"0.9rem":"1rem",color:v<=5?"#c44":v<=10?"#ca8":"#fff"},children:v}),s.jsx("span",{style:{fontSize:c?"0.7rem":"0.8rem",opacity:.5},children:"/20"})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c?"0.75rem":"1rem"},children:[s.jsxs(S.div,{animate:d?{scale:[1,1.1,1],color:["#c44","#f44","#c44"]}:{},transition:{duration:.5,repeat:d?1/0:0,repeatDelay:1},style:{display:"flex",alignItems:"center",gap:"0.25rem",color:b?"#c44":"#ca8",fontWeight:b?"bold":"normal"},children:[s.jsx("span",{style:{fontSize:c?"0.7rem":"0.8rem"},children:"üíÄ"}),s.jsx("span",{children:r})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"#ca8",fontWeight:"bold"},children:[s.jsx("span",{style:{fontSize:c?"0.7rem":"0.8rem"},children:"üí∞"}),s.jsx("span",{children:i})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:c?"0.5rem":"0.75rem"},children:[t&&s.jsxs(S.div,{animate:u?{scale:[1,1.15,1],color:["#c44","#f44","#c44"]}:{},transition:{duration:.5,repeat:u?1/0:0,repeatDelay:1},style:{display:"flex",alignItems:"center",gap:"0.25rem",color:x?"#c44":"#666",fontSize:c?"0.7rem":"0.75rem",fontWeight:x?"bold":"normal"},title:x?"Tu as faim !":"Rassasi√©",children:[s.jsx("span",{children:"üçñ"}),s.jsx("span",{children:l?"‚úì":"‚úó"})]}),e&&s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:o===0?"#c44":"#888",fontSize:c?"0.7rem":"0.75rem"},children:[s.jsx("span",{children:"‚ö°"}),s.jsx("span",{children:o})]}),s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.15rem",color:"#666",fontSize:c?"0.65rem":"0.7rem"},children:s.jsx("span",{children:"‚≠ê".repeat(a)})})]})]})}function Tn(){const{playerStats:e,equipment:t,goToExploration:n,openInventory:r}=y(),{playSound:i,playHaptic:a}=dn(),o=H(),[l,c]=f.useState(!1),[d,m]=f.useState(!1),u=()=>{i("ui_open"),a("button_press"),y.setState({phase:"marche"})},h=()=>{i("ui_open"),a("button_press"),y.setState({phase:"morten"})},v=()=>{i("ui_open"),a("button_press"),y.setState({phase:"settings"})},p=()=>{i("ui_open"),a("button_press"),r()},g=()=>{if(!l){if(e.atk<8){m(!0);return}c(!0),i("ui_open"),a("button_press"),n(),setTimeout(()=>c(!1),500)}},b=()=>{m(!1),c(!0),i("ui_open"),a("button_press"),n(),setTimeout(()=>c(!1),500)},[x,T]=bn(g,500),C=$t(e);return s.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[s.jsx($e,{showHunger:!0}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,padding:"1rem",overflowY:"auto",justifyContent:"center"},children:[s.jsx("div",{style:{textAlign:"center",fontSize:o?"1rem":"1.1rem",fontWeight:"bold",color:"#888",opacity:.7,marginBottom:"0.5rem"},children:"AUBE"}),s.jsx("div",{style:{fontSize:o?"1.1rem":"1.2rem",lineHeight:"1.8",color:"#ddd",marginBottom:"1.5rem",padding:"1rem",background:"rgba(26, 26, 26, 0.6)",borderRadius:"4px",fontStyle:"italic"},children:`"Bourg-Creux. Des murs. Un toit. √áa fera l'affaire. Pour l'instant."`}),s.jsxs("div",{style:{background:"#2a2a2a",padding:o?"1rem":"1.5rem",borderRadius:"8px",border:"2px solid #555"},children:[s.jsxs("div",{style:{display:"flex",gap:o?"0.75rem":"1rem",alignItems:"center",flexWrap:o?"wrap":"nowrap",marginBottom:"1rem"},children:[s.jsx(ln,{equipment:t,size:o?80:96}),s.jsxs("div",{style:{padding:o?"0.75rem":"1rem",background:"#1a1a1a",borderRadius:"4px",fontSize:o?"0.85rem":"0.9rem",color:"#ccc",lineHeight:"1.6",flex:1,minWidth:o?"100%":"auto"},children:[s.jsx("div",{style:{marginBottom:"0.3rem"},children:C.attack}),s.jsx("div",{style:{marginBottom:"0.3rem"},children:C.defense}),s.jsx("div",{children:C.speed})]})]}),s.jsxs("details",{style:{marginBottom:"1rem"},children:[s.jsx("summary",{style:{cursor:"pointer",color:"#aaa",fontSize:"0.9rem",padding:"0.5rem",userSelect:"none"},children:"üìä Progression et objectifs"}),s.jsxs("div",{style:{marginTop:"0.75rem"},children:[s.jsx(mn,{compact:o}),s.jsx(vn,{})]})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:o?"0.75rem":"1rem"},children:[s.jsxs("div",{style:{display:"flex",gap:o?"0.5rem":"1rem",flexWrap:o?"wrap":"nowrap"},children:[s.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:1,minWidth:o?"calc(50% - 0.25rem)":"auto"},children:"INVENTAIRE"}),s.jsx("button",{onClick:u,style:{fontSize:"1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:1,minWidth:o?"calc(50% - 0.25rem)":"auto"},children:"MARCH√â"})]}),s.jsxs("div",{style:{display:"flex",gap:o?"0.5rem":"1rem",flexWrap:o?"wrap":"nowrap"},children:[s.jsx("button",{onClick:h,style:{fontSize:"1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:1,minWidth:o?"calc(50% - 0.25rem)":"auto"},children:"USURIER"}),s.jsx("button",{onClick:()=>{i("ui_open"),a("button_press"),y.setState({phase:"forge"})},style:{fontSize:"1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:1,minWidth:o?"calc(50% - 0.25rem)":"auto"},children:"FORGE"})]}),s.jsxs("div",{style:{display:"flex",gap:o?"0.5rem":"1rem",flexWrap:o?"wrap":"nowrap"},children:[s.jsx("button",{onClick:()=>{i("ui_open"),a("button_press"),y.setState({phase:"taverne"})},style:{fontSize:"1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:o?"1 1 100%":1,minWidth:o?"100%":"auto"},children:"TAVERNE"}),s.jsx("button",{onClick:v,style:{fontSize:o?"0.9rem":"1.1rem",padding:o?"0.875rem 1rem":"0.75rem 1.5rem",minHeight:o?"48px":"44px",background:"#2a2a2a",border:"2px solid #444",flex:o?"1 1 calc(50% - 0.25rem)":"none"},children:"PARAM√àTRES"}),s.jsx("button",{onClick:x,disabled:T||l,style:{fontSize:o?"1rem":"1.1rem",padding:"1rem",minHeight:o?"48px":"44px",flex:o?"1 1 100%":2,opacity:T||l?.6:1,cursor:T||l?"not-allowed":"pointer"},children:l?"CHARGEMENT...":"PARTIR EN MISSION ‚Üí"})]})]})]}),s.jsx(z,{children:d&&s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem"},onClick:()=>m(!1),children:s.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:E=>E.stopPropagation(),style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:"2px solid #c44",maxWidth:"400px",width:"100%"},children:[s.jsx("div",{style:{fontSize:"1.3rem",fontWeight:"bold",marginBottom:"1rem",color:"#c44",textAlign:"center"},children:"‚ö†Ô∏è ATTENTION"}),s.jsxs("div",{style:{fontSize:"1rem",color:"#ccc",lineHeight:"1.6",marginBottom:"1.5rem",textAlign:"center"},children:["Tes stats sont faibles (ATK: ",e.atk,").",s.jsx("br",{}),s.jsx("br",{}),"Explorer sans √©quipement ad√©quat est tr√®s dangereux. Tu risques de perdre au combat.",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{style:{color:"#ca8"},children:"√âquipe-toi d'abord dans l'inventaire."})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[s.jsx("button",{onClick:b,style:{fontSize:"1rem",padding:"0.75rem 1.5rem",background:"#c44",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer",fontWeight:"bold"},children:"CONTINUER QUAND M√äME"}),s.jsx("button",{onClick:()=>m(!1),style:{fontSize:"1rem",padding:"0.75rem 1.5rem",background:"#555",border:"none",borderRadius:"4px",color:"#fff",cursor:"pointer"},children:"ANNULER"})]})]})})})]})}function Sn({enemy:e,showStats:t=!1}){return s.jsxs(S.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeOut"},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[s.jsx(S.div,{initial:{scale:.5},animate:{scale:1},transition:{duration:.5,delay:.2},style:{width:"64px",height:"64px",background:"#444",border:"2px solid #666",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem"},children:"‚öîÔ∏è"}),s.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},style:{fontSize:"1.3rem",fontWeight:"bold",color:"#fff"},children:e.name}),s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:.6},style:{fontSize:"0.9rem",color:"#999",fontStyle:"italic",textAlign:"center",maxWidth:"300px"},children:e.description}),t&&s.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:.8},style:{fontSize:"0.85rem",color:"#aaa",display:"flex",gap:"1rem"},children:[s.jsxs("span",{children:["ATK: ",e.atk]}),s.jsxs("span",{children:["DEF: ",e.def]}),s.jsxs("span",{children:["VIT: ",e.vit]})]})]})}function jn({onComplete:e}){const[t,n]=f.useState(0);return f.useEffect(()=>{const a=[];for(let l=0;l<4;l++){const c=window.setTimeout(()=>{n(u=>u+1);const d=["hit_01","hit_02","hit_03"],m=d[Math.floor(Math.random()*d.length)];j.playSound(m,.8),me.play("combat_hit")},l*500);a.push(c)}const o=window.setTimeout(()=>{e()},2e3);return()=>{a.forEach(l=>clearTimeout(l)),clearTimeout(o)}},[e]),s.jsxs("div",{style:{position:"relative",width:"100%",height:"200px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[Array.from({length:t}).map((r,i)=>s.jsx(S.div,{initial:{opacity:0,scale:.5},animate:{opacity:[0,1,0],scale:[.5,1.5,.5]},transition:{duration:.3,times:[0,.5,1]},style:{position:"absolute",width:"100px",height:"100px",background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none"}},i)),s.jsx(S.div,{animate:{x:[0,-5,5,-5,5,0],y:[0,-3,3,-3,3,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},style:{fontSize:"3rem",color:"#fff"},children:"‚öîÔ∏è"}),Array.from({length:10}).map((r,i)=>s.jsx(S.div,{initial:{x:0,y:0,opacity:0},animate:{x:(Math.random()-.5)*200,y:(Math.random()-.5)*200,opacity:[0,1,0]},transition:{duration:1,delay:Math.random()*1,repeat:1/0},style:{position:"absolute",width:"4px",height:"4px",background:"#fff",borderRadius:"50%",pointerEvents:"none"}},i))]})}function Cn({result:e,onComplete:t}){const r=(()=>{switch(e.outcome){case"crushing":return{text:"‚úì VICTOIRE √âCRASANTE",color:"#ffd700",bgColor:"rgba(255, 215, 0, 0.1)"};case"victory":return{text:"‚úì VICTOIRE",color:"#4a8",bgColor:"rgba(68, 170, 136, 0.1)"};case"costly":return{text:"‚úì VICTOIRE CO√õTEUSE",color:"#ca8",bgColor:"rgba(204, 170, 136, 0.1)"};case"flee":return{text:"‚ö† FUITE",color:"#888",bgColor:"rgba(136, 136, 136, 0.1)"};case"defeat":return{text:"‚úó MORT",color:"#c44",bgColor:"rgba(204, 68, 68, 0.1)"}}})(),i=e.ratio>=.4&&e.ratio<=.5&&e.outcome!=="defeat";return f.useEffect(()=>{const a=setTimeout(()=>{t()},1500);return()=>clearTimeout(a)},[t]),s.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:`2px solid ${r.color}`,textAlign:"center",backgroundImage:`linear-gradient(${r.bgColor}, ${r.bgColor})`},children:[s.jsx(S.div,{initial:{scale:.8},animate:{scale:1},transition:{duration:.3,type:"spring"},style:{fontSize:"1.5rem",fontWeight:"bold",color:r.color,marginBottom:"1rem"},children:r.text}),s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},style:{fontSize:"1rem",color:"#ccc",marginBottom:"1rem",lineHeight:"1.6"},children:e.message}),i&&s.jsx(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4},style:{marginTop:"1rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#c44",fontStyle:"italic",border:"1px solid #c44"},children:"üí¨ Vous avez fr√¥l√© la mort. Un coup de plus et c'en √©tait fini."}),e.nearMissMessage&&!i&&s.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},style:{marginTop:"1rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#ddd",fontStyle:"italic"},children:["üí¨ ",e.nearMissMessage]}),e.gold&&s.jsxs(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},style:{marginTop:"1rem",fontSize:"1.3rem",color:"#ddd",fontWeight:"bold"},children:["+",e.gold,"üí∞"]}),e.durabilityLoss.length>0&&s.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},style:{marginTop:"1rem",fontSize:"0.9rem",color:e.outcome==="costly"?"#ca8":"#c84",fontStyle:"italic"},children:["‚Üí ",e.outcome==="costly"?"√âquipement endommag√©":"Mat√©riel perdu"," (",e.durabilityLoss.map(a=>`-${a.amount}%`).join(", "),")"]})]})}function wn(){const[e,t]=f.useState(!1),n=Z(0),r=Z(0);return{isShaking:e,triggerShake:(a=3,o=500)=>{if(e)return;t(!0);const l=Array.from({length:10},()=>({x:(Math.random()-.5)*a*10,y:(Math.random()-.5)*a*10})),c=Date.now(),d=()=>{const u=(Date.now()-c)/o;if(u>=1){n.set(0),r.set(0),t(!1);return}const h=1-Math.pow(1-u,3),v=Math.floor(h*(l.length-1)),p=l[v];n.set(p.x*(1-h)),r.set(p.y*(1-h)),requestAnimationFrame(d)};requestAnimationFrame(d)},shakeStyle:{x:n,y:r}}}function En({children:e,intensity:t=3,duration:n=500,trigger:r=!1}){const i=Z(0),a=Z(0);return f.useEffect(()=>{if(r){const o=Array.from({length:10},()=>({x:(Math.random()-.5)*t*10,y:(Math.random()-.5)*t*10})),l=Date.now(),c=()=>{const m=(Date.now()-l)/n;if(m>=1){i.set(0),a.set(0);return}const u=1-Math.pow(1-m,3),h=Math.floor(u*(o.length-1)),v=o[h];i.set(v.x*(1-u)),a.set(v.y*(1-u)),requestAnimationFrame(c)};requestAnimationFrame(c)}},[r,t,n,i,a]),s.jsx(S.div,{style:{x:i,y:a,width:"100%",height:"100%"},children:e})}function Mn({enemy:e,playerStats:t,onCombatEnd:n}){const[r,i]=f.useState("anticipation"),[a,o]=f.useState(null),[l,c]=f.useState(!1);f.useEffect(()=>{const h=Be(t,e);o(h),(h.outcome==="costly"||h.outcome==="flee"||h.outcome==="defeat")&&(c(!0),setTimeout(()=>c(!1),500));const v=y.getState();_({...v,currentEnemy:e,combatResult:h,currentEvent:"combat"}).catch(()=>{})},[e,t]),f.useEffect(()=>{if(r==="anticipation"){j.crossfadeMusic("ambient_combat",1e3),j.playSound("combat_start");const h=y.getState();_({...h,currentEnemy:e,combatResult:a,currentEvent:"combat",phase:"exploration"}).catch(()=>{});const v=setTimeout(()=>{i("resolution")},500);return()=>clearTimeout(v)}},[r,e,a]),f.useEffect(()=>{if(r==="resolution"&&a){const h=y.getState();_({...h,currentEnemy:e,combatResult:a,currentEvent:"combat",phase:"exploration"}).catch(()=>{})}},[r,e,a]),f.useEffect(()=>{if(r==="result"&&a){const h=y.getState();_({...h,currentEnemy:e,combatResult:a,currentEvent:"combat",phase:"exploration"}).catch(()=>{})}},[r,e,a]),f.useEffect(()=>(r==="complete"&&j.crossfadeMusic("ambient_explore",1e3),()=>{r==="complete"&&j.crossfadeMusic("ambient_explore",1e3)}),[r]);const d=()=>{i("result")},m=()=>{i("complete"),a&&(a.outcome==="defeat"?j.playSound("defeat"):a.outcome==="flee"?j.playSound("flee"):j.playSound("victory"),n(a))},u={hidden:{opacity:0},visible:{opacity:.7},exit:{opacity:0}};return s.jsx(En,{intensity:4,duration:500,trigger:l,children:s.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"1rem"},children:[s.jsx(z,{children:r==="anticipation"&&s.jsx(S.div,{variants:u,initial:"hidden",animate:"visible",exit:"exit",style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"#000",zIndex:1}})}),s.jsx(z,{children:r==="anticipation"&&s.jsxs(S.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.5},style:{position:"relative",zIndex:2,width:"100%",maxWidth:"500px",textAlign:"center"},children:[s.jsx(S.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},style:{fontSize:"2rem",fontWeight:"bold",marginBottom:"2rem",color:"#fff"},children:"‚öîÔ∏è COMBAT !"}),s.jsx(Sn,{enemy:e})]})}),s.jsx(z,{children:r==="resolution"&&s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{width:"100%",maxWidth:"500px",textAlign:"center"},children:s.jsx(jn,{onComplete:d})})}),s.jsx(z,{children:r==="result"&&a&&s.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},style:{width:"100%",maxWidth:"500px"},children:s.jsx(Cn,{result:a,onComplete:m})})}),r==="complete"&&s.jsx("div",{style:{opacity:0}})]})})}const kn={head:"‚õëÔ∏è",torso:"üõ°Ô∏è",legs:"üë¢",hands:"üß§",weapon:"‚öîÔ∏è",offhand:"üõ°Ô∏è",accessory:"üß£"},In={light:"L√©ger",heavy:"Lourd",rusty:"Rouill√©",bloody:"Ensanglant√©",blessed:"B√©ni",stolen:"Vol√©",solid:"Solide"};function qe({item:e,showBack:t=!1}){const n=ot(e.rarity);return t?s.jsxs("div",{style:{width:"200px",height:"280px",background:"#333",border:"3px solid #555",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:[s.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",background:"repeating-linear-gradient(45deg, #2a2a2a, #2a2a2a 10px, #333 10px, #333 20px)",opacity:.3}}),s.jsx("div",{style:{fontSize:"3rem",color:"#555",zIndex:1},children:"?"})]}):s.jsxs("div",{style:{width:"200px",height:"280px",background:"#2a2a2a",border:`3px solid ${n}`,borderRadius:"12px",padding:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem",position:"relative",overflow:"hidden"},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"4px",background:n}}),s.jsx("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",fontSize:"1.2rem",color:n},children:e.rarity==="common"?"‚óè":e.rarity==="uncommon"?"‚ñ†":e.rarity==="rare"?"‚óÜ":"‚òÖ"}),s.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:"bold",color:e.cursed?"#c44":n,marginTop:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.name,e.cursed&&s.jsx("span",{style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem",background:"#c44",color:"#fff",borderRadius:"4px",fontWeight:"bold"},children:"COMPROMIS"})]}),s.jsx("div",{style:{fontSize:"0.75rem",color:"#999",textTransform:"uppercase"},children:at(e.rarity)}),e.cursed&&s.jsxs("div",{style:{fontSize:"0.7rem",color:"#c44",padding:"0.75rem",background:"#2a1a1a",borderRadius:"4px",border:"2px solid #c44",marginTop:"0.5rem"},children:[s.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:"‚ö†Ô∏è ITEM COMPROMIS"}),e.curseDescription&&s.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.7rem",color:"#a88",lineHeight:"1.4"},children:e.curseDescription}),e.curseEffect&&s.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.7rem",color:"#f44",fontWeight:"bold"},children:["Effet : ",e.curseEffect]}),(e.hiddenMalus||e.visibleMalus)&&s.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #c44"},children:[s.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.25rem",fontSize:"0.7rem"},children:"Malus appliqu√©s :"}),e.visibleMalus&&s.jsxs("div",{style:{fontSize:"0.65rem"},children:[e.visibleMalus.atk&&s.jsxs("div",{style:{color:"#f44"},children:["‚Ä¢ ATK: -",e.visibleMalus.atk]}),e.visibleMalus.def&&s.jsxs("div",{style:{color:"#f44"},children:["‚Ä¢ DEF: -",e.visibleMalus.def]}),e.visibleMalus.vit&&s.jsxs("div",{style:{color:"#f44"},children:["‚Ä¢ VIT: -",e.visibleMalus.vit]})]}),e.hiddenMalus&&s.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.25rem",color:"#a88",fontStyle:"italic"},children:[e.hiddenMalus.atk&&s.jsxs("div",{children:["‚Ä¢ ATK: -",e.hiddenMalus.atk," (malus cach√©, appliqu√© automatiquement)"]}),e.hiddenMalus.def&&s.jsxs("div",{children:["‚Ä¢ DEF: -",e.hiddenMalus.def," (malus cach√©, appliqu√© automatiquement)"]}),e.hiddenMalus.vit&&s.jsxs("div",{children:["‚Ä¢ VIT: -",e.hiddenMalus.vit," (malus cach√©, appliqu√© automatiquement)"]})]})]}),s.jsx("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #c44",fontSize:"0.65rem",color:"#888",fontStyle:"italic"},children:"üí° Les items compromis ont des d√©fauts (lourdeur, r√©putation, etc.). Les malus sont appliqu√©s m√™me si non visibles."})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",color:"#ccc"},children:[s.jsx("span",{children:kn[e.slot]||"üì¶"}),s.jsx("span",{style:{textTransform:"capitalize"},children:e.slot})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",fontSize:"0.85rem",color:"#aaa",marginTop:"0.5rem"},children:[e.stats.atk>0&&s.jsxs("div",{children:["Attaque : ",s.jsxs("span",{style:{color:"#fff"},children:["+",e.stats.atk]})]}),e.stats.def>0&&s.jsxs("div",{children:["D√©fense : ",s.jsxs("span",{style:{color:"#fff"},children:["+",e.stats.def]})]}),e.stats.vit>0&&s.jsxs("div",{children:["Vitesse : ",s.jsxs("span",{style:{color:"#fff"},children:["+",e.stats.vit]})]})]}),e.properties.length>0&&s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem",marginTop:"0.5rem"},children:e.properties.map((r,i)=>s.jsx("div",{style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem",background:"#1a1a1a",border:`1px solid ${n}`,borderRadius:"4px",color:n},children:In[r]||r},i))}),s.jsx("div",{style:{marginTop:"auto",paddingTop:"0.5rem"},children:s.jsx(bt,{item:e,size:"small"})}),s.jsx("div",{style:{fontSize:"0.7rem",color:"#777",fontStyle:"italic",marginTop:"0.5rem",lineHeight:"1.3",maxHeight:"2.6rem",overflow:"hidden"},children:e.description})]})}function Rn({rarity:e}){const n=(()=>{switch(e){case"common":return{count:8,color:"#888",size:3,speed:50,duration:.3};case"uncommon":return{count:15,color:"#4a8",size:4,speed:80,duration:.4};case"rare":return{count:25,color:"#4af",size:5,speed:120,duration:.5};case"legendary":return{count:40,color:"#ffd700",size:6,speed:150,duration:.6}}})();return s.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"200px",height:"280px",pointerEvents:"none",transform:"translate(-50%, -50%)"},children:[Array.from({length:n.count}).map((r,i)=>{const o=360/n.count*i*Math.PI/180;return s.jsx(S.div,{initial:{x:0,y:0,opacity:1,scale:1},animate:{x:Math.cos(o)*n.speed,y:Math.sin(o)*n.speed,opacity:[1,1,0],scale:[1,1.5,0]},transition:{duration:n.duration,times:[0,.5,1],ease:"easeOut"},style:{position:"absolute",top:"50%",left:"50%",width:`${n.size}px`,height:`${n.size}px`,background:n.color,borderRadius:"50%",boxShadow:`0 0 ${n.size*2}px ${n.color}`}},i)}),(e==="rare"||e==="legendary")&&s.jsx(S.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1.5,1.2],opacity:[0,.6,0]},transition:{duration:n.duration,times:[0,.5,1]},style:{position:"absolute",top:"50%",left:"50%",width:"300px",height:"300px",border:`2px solid ${n.color}`,borderRadius:"50%",transform:"translate(-50%, -50%)",opacity:.3}}),e==="legendary"&&s.jsx(s.Fragment,{children:Array.from({length:8}).map((r,i)=>{const a=45*i;return s.jsx(S.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1,0],opacity:[0,1,0],rotate:a},transition:{duration:n.duration,times:[0,.3,1]},style:{position:"absolute",top:"50%",left:"50%",width:"4px",height:"100px",background:`linear-gradient(to bottom, ${n.color}, transparent)`,transformOrigin:"top center",transform:`translate(-50%, -50%) rotate(${a}deg)`}},i)})})]})}function Ln({item:e,onRevealComplete:t,autoStart:n=!0}){const[r,i]=f.useState(n?"hidden":"revealed");return f.useEffect(()=>{if(!n)return;const a=setTimeout(()=>{i("shaking")},300);return()=>clearTimeout(a)},[n]),f.useEffect(()=>{if(r!=="shaking")return;const a=setTimeout(()=>{i("flipping");const o={common:"loot_common",uncommon:"loot_uncommon",rare:"loot_rare",legendary:"loot_legendary"},l={common:"loot_common",uncommon:"loot_uncommon",rare:"loot_rare",legendary:"loot_legendary"},c=o[e.rarity],d=l[e.rarity];c&&j.playSound(c),d&&me.play(d)},500);return()=>clearTimeout(a)},[r]),f.useEffect(()=>{if(r!=="flipping")return;const a=setTimeout(()=>{i("revealed")},400);return()=>clearTimeout(a)},[r]),f.useEffect(()=>{if(r!=="revealed")return;const a=setTimeout(()=>{i("complete"),t()},300);return()=>clearTimeout(a)},[r,t]),s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"2rem",flex:1,minHeight:"100vh",padding:"2rem",position:"relative"},children:[s.jsx("div",{style:{perspective:"1000px",perspectiveOrigin:"center center"},children:s.jsxs(S.div,{animate:{rotateY:r==="flipping"||r==="revealed"||r==="complete"?180:0,scale:r==="shaking"?[1,1.05,1]:1,x:r==="shaking"?[0,-5,5,-5,5,0]:0},transition:{rotateY:{duration:.4,ease:"easeOut"},scale:{duration:.5,repeat:1/0,repeatType:"reverse"},x:{duration:.1,repeat:5,ease:"easeInOut"}},style:{transformStyle:"preserve-3d",position:"relative",width:"200px",height:"280px"},children:[s.jsx(S.div,{animate:{opacity:r==="hidden"||r==="shaking"?1:0,scale:r==="shaking"?[1,1.02,1]:1},transition:{opacity:{duration:.1},scale:{duration:.5,repeat:r==="shaking"?1/0:0,repeatType:"reverse"}},style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(0deg)"},children:s.jsx(qe,{item:e,showBack:!0})}),s.jsx(S.div,{animate:{opacity:r==="flipping"||r==="revealed"||r==="complete"?1:0},transition:{duration:.1},style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:s.jsx(qe,{item:e,showBack:!1})})]})}),s.jsx(z,{children:(r==="revealed"||r==="complete")&&s.jsx(Rn,{rarity:e.rarity})}),r==="revealed"||r==="complete"?s.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},style:{textAlign:"center",fontSize:"1.1rem",color:"#ccc"},children:[e.name," trouv√© !"]}):s.jsx(S.div,{animate:{opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0},style:{textAlign:"center",fontSize:"0.9rem",color:"#666",fontStyle:"italic"},children:"..."})]})}function qn({item:e,gold:t,onContinue:n}){const{addItemToInventory:r,inventory:i}=y(),[a,o]=f.useState(!1),l=i.length>=10,c=()=>{o(!0)},d=()=>{l||r(e),n()},m=()=>{n()};return a?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,justifyContent:"center",alignItems:"center",padding:"2rem"},children:[s.jsxs("div",{style:{fontSize:"1.2rem",color:"#ccc",textAlign:"center",marginBottom:"1rem"},children:[e.name," trouv√© !"]}),t&&s.jsxs("div",{style:{fontSize:"1.3rem",color:"#ddd",fontWeight:"bold"},children:["+",t,"üí∞"]}),l&&s.jsx("div",{style:{padding:"1rem",background:"#3a2a2a",borderRadius:"4px",color:"#c44",fontSize:"0.9rem",textAlign:"center",maxWidth:"400px"},children:"Inventaire plein ! Tu dois laisser un item."}),s.jsxs("div",{style:{display:"flex",gap:"1rem",width:"100%",maxWidth:"400px"},children:[s.jsx("button",{onClick:d,disabled:l,style:{flex:1},children:"PRENDRE"}),s.jsx("button",{onClick:m,style:{flex:1},children:"LAISSER"})]})]}):s.jsx(Ln,{item:e,onRevealComplete:c,autoStart:!0})}function Dn({locations:e,onExplore:t,onEndDay:n}){const{actionsRemaining:r,day:i,rumors:a,playerStats:o}=y(),l=H(),[c,d]=f.useState(null),m=a.filter(u=>u.day>=i-2);return s.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1,overflowY:"auto"},children:[s.jsx($e,{showActions:!0,showHunger:!0}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem",flex:1,padding:"1rem"},children:[s.jsx("div",{style:{textAlign:"center",marginBottom:"0.5rem"},children:s.jsx("div",{style:{fontSize:l?"1.1rem":"1.2rem",fontWeight:"bold",color:"#aaa",opacity:.7},children:"EXPLORATION"})}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.map((u,h)=>{const v=ee[u.type],p=h===0&&i===1,g=r>0,b=m.filter(P=>P.targetLocationId===u.id||P.hintType==="location"&&!P.targetLocationId),x=b.length>0,T=x?b[0].hintType:null,C=T==="combat"?"‚öîÔ∏è":T==="loot"?"üí∞":T==="event"?"‚ö†Ô∏è":T==="location"?"üìç":null,E=jt(u.risk);let w=null,L=null,M=null,q=null;return E>.1&&(L=wt(u.risk),w=Ct(o,L),q=Mt(w.ratio),w.ratio<.5?M="danger":w.ratio<.7?M="risky":w.ratio>1&&(M="safe")),s.jsxs("div",{"data-tutorial-location":p?"true":void 0,style:{background:"#2a2a2a",border:"2px solid #555",borderRadius:"8px",padding:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsxs("div",{style:{fontSize:"2rem",position:"relative"},children:[v.icon,x&&C&&s.jsx("span",{style:{position:"absolute",top:"-0.25rem",right:"-0.25rem",fontSize:"1rem",background:"#ca8",borderRadius:"50%",width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid #2a2a2a"},title:"Rumeur active",children:C})]}),s.jsxs("div",{style:{flex:1},children:[s.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",marginBottom:"0.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u.name,u.explored&&s.jsxs("span",{style:{fontSize:"0.75rem",color:"#888",fontStyle:"italic"},children:["(Explor√© ",u.explorationCount||0,"x)"]})]}),s.jsx("div",{style:{fontSize:"0.85rem",color:"#aaa",fontStyle:"italic"},children:u.description})]})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.9rem",color:"#ccc",flexWrap:"wrap",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx("span",{children:"Risque:"}),s.jsx("span",{style:{color:"#c44"},children:"‚≠ê".repeat(u.risk)})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx("span",{children:"Richesse:"}),s.jsx("span",{style:{color:"#ca8"},children:"üí∞".repeat(u.richness)})]}),M&&w&&L&&q&&s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"0.25rem",padding:"0.75rem",background:M==="danger"?"#2a1a1a":M==="risky"?"#2a2a1a":"#1a2a1a",borderRadius:"4px",border:`1px solid ${M==="danger"?"#c44":M==="risky"?"#ca8":"#4a4"}`,position:"relative"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[M==="danger"&&s.jsx("span",{style:{background:"#c44",color:"#fff",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"bold"},children:"‚ö†Ô∏è DANGER"}),M==="risky"&&s.jsx("span",{style:{background:"#ca8",color:"#000",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"bold"},children:"‚ö†Ô∏è RISQU√â"}),M==="safe"&&s.jsx("span",{style:{background:"#4a4",color:"#fff",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"bold"},children:"‚úì S√õR"}),s.jsxs("span",{style:{fontSize:"0.8rem",color:"#aaa"},children:["Ratio: ",w.ratio.toFixed(2)]}),s.jsxs("span",{style:{fontSize:"0.8rem",color:"#aaa"},children:["Victoire: ",Et(w.ratio),"%"]}),s.jsxs("button",{onClick:()=>d(c===u.id?null:u.id),style:{background:"transparent",border:"1px solid #555",borderRadius:"4px",padding:"0.2rem 0.5rem",fontSize:"0.75rem",color:"#aaa",cursor:"pointer"},title:"Afficher d√©tails",children:[c===u.id?"‚ñº":"‚ñ∂"," D√©tails"]})]}),s.jsx("div",{style:{fontSize:"0.75rem",color:"#888",display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:s.jsxs("span",{children:["Ennemi estim√©: ATK ",L.atk," | DEF ",L.def," | VIT ",L.vit]})}),c===u.id&&s.jsxs("div",{style:{marginTop:"0.5rem",padding:"0.5rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.75rem",display:"flex",flexDirection:"column",gap:"0.25rem"},children:[s.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.25rem",color:"#ddd"},children:"Probabilit√©s de r√©sultats :"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.15rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{style:{color:"#4a8"},children:"Victoire √©crasante :"}),s.jsxs("span",{style:{color:"#4a8"},children:[q.crushing,"%"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{style:{color:"#4a4"},children:"Victoire :"}),s.jsxs("span",{style:{color:"#4a4"},children:[q.victory,"%"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{style:{color:"#ca8"},children:"Victoire co√ªteuse :"}),s.jsxs("span",{style:{color:"#ca8"},children:[q.costly,"%"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{style:{color:"#c84"},children:"Fuite :"}),s.jsxs("span",{style:{color:"#c84"},children:[q.flee,"%"]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[s.jsx("span",{style:{color:"#c44"},children:"D√©faite :"}),s.jsxs("span",{style:{color:"#c44"},children:[q.defeat,"%"]})]})]}),s.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #333",fontSize:"0.7rem",color:"#666",fontStyle:"italic"},children:[M==="danger"&&"‚ö†Ô∏è Tu risques de perdre ce combat. √âvite ou am√©liore ton √©quipement.",M==="risky"&&"‚ö†Ô∏è Combat difficile. Tu risques de fuir ou de subir des d√©g√¢ts.",M==="safe"&&"‚úì Tu devrais gagner ce combat sans trop de difficult√©."]})]}),c!==u.id&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#888",fontStyle:"italic"},children:[M==="danger"&&"Tu risques de perdre ce combat. √âvite ou am√©liore ton √©quipement.",M==="risky"&&"Combat difficile. Tu risques de fuir ou de subir des d√©g√¢ts.",M==="safe"&&"Tu devrais gagner ce combat sans trop de difficult√©."]})]})]}),s.jsx("button",{"data-tutorial-explore-button":p?"true":void 0,onClick:()=>t(u),disabled:!g,style:{width:"100%",padding:l?"0.875rem":"0.75rem",fontSize:l?"0.95rem":"1rem",minHeight:"44px",opacity:g?1:.5,cursor:g?"pointer":"not-allowed"},children:"EXPLORER"})]},u.id)}),s.jsx("button",{onClick:n,style:{marginTop:"1rem",padding:l?"0.875rem":"1rem",fontSize:l?"1rem":"1.1rem",minHeight:"44px",background:"#3a2a2a",border:"2px solid #666"},children:"TERMINER LA JOURN√âE"})]})]})]})}function _n(){const{currentEvent:e,eventResult:t,combatResult:n,lootedItem:r,currentEnemy:i,playerStats:a,dailyLocations:o,exploreLocation:l,finishEvent:c,endDay:d}=y();return e==="combat"&&i&&n?s.jsx(Mn,{enemy:i,playerStats:a,onCombatEnd:()=>{c()}}):e==="loot"&&t?r?s.jsx(qn,{item:r,gold:t.gold,onContinue:c}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,justifyContent:"center"},children:[s.jsxs("div",{style:{background:"#2a2a2a",padding:"2rem",borderRadius:"8px",border:"2px solid #555",textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"1.3rem",marginBottom:"1rem"},children:"üí∞"}),s.jsx("div",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"#ccc"},children:t.message}),t.gold&&s.jsxs("div",{style:{color:"#ddd",fontSize:"1.2rem",marginTop:"1rem"},children:["+",t.gold,"üí∞"]})]}),s.jsx("button",{onClick:c,children:"CONTINUER"})]}):o.length===0?s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2rem",flex:1,justifyContent:"center",alignItems:"center"},children:[s.jsx("div",{children:"Chargement des lieux..."}),s.jsx("button",{onClick:()=>y.getState().goToExploration(),children:"G√âN√âRER LES LIEUX"})]}):s.jsx(Dn,{locations:o,onExplore:l,onEndDay:d})}const De={5:["La nuit tombe. Tu te demandes si tout √ßa en vaut la peine. Peut-√™tre que la mort serait plus simple.","Chaque jour, tu perds un peu plus de toi-m√™me. Les choix faciles deviennent les seuls possibles.","Tu regardes tes mains. Elles sont sales. De sang ? D'or ? Peut-√™tre les deux.","Les autres te regardent avec m√©fiance. Tu comprends pourquoi. Tu ne te reconnais plus.","La dette grandit. Tes choix aussi. O√π est la diff√©rence ?","Tu as vol√©. Tu as menti. Tu as tu√©. Mais tu es vivant. C'est tout ce qui compte.","Les remords ? Tu les as enterr√©s. Avec les autres morts.","Chaque pi√®ce d'or te co√ªte un peu plus. Mais tu continues. Tu n'as pas le choix.","Tu te souviens de qui tu √©tais. Avant. Mais c'est trop tard maintenant.","La compassion est un luxe. Tu ne peux pas te le permettre."],10:["La nuit est sombre. Comme ton √¢me. Tu ne ressens plus rien.","Chaque pi√®ce d'or te co√ªte un peu plus d'humanit√©. Bient√¥t, il n'en restera plus.","Tu as fait des choses. Des choses que tu ne peux pas oublier. Peut-√™tre que tu ne devrais pas.","Les morts te suivent. Dans tes r√™ves. Dans tes pens√©es. Ils ne te l√¢chent pas.","Tu es devenu ce que tu d√©testais. Un monstre. Mais au moins, tu es vivant.","Tu as appris. Appris que la bont√© est une faiblesse. Appris que la survie est tout.","Les autres sont des outils. Des moyens. Rien de plus. Tu l'as accept√©.","Tu ne pleures plus. Il n'y a plus rien √† pleurer. Tu es vide.","Chaque choix te rapproche de la damnation. Mais tu continues. Par habitude.","Tu as vendu ton √¢me. Pi√®ce par pi√®ce. Il ne reste presque plus rien."],15:["La nuit ne te fait plus peur. Tu es la nuit.","Tu as vendu ton √¢me pi√®ce par pi√®ce. Il ne reste plus grand-chose.","Les autres sont des obstacles. Des ressources. Des moyens. Rien de plus.","Tu ris. Tu ris de ta propre damnation. C'est tout ce qui te reste.","La mort te guette. Tu l'attends. Tu l'esp√®res presque.","Tu as perdu. Perdu ce qui faisait de toi un homme. Mais tu as gagn√©. Gagn√© la survie.","Les remords sont morts. Comme tout le reste. Tu es libre. Libre de tout.","Tu calcules. Tu calcules chaque geste. Chaque choix. Chaque trahison.","La compassion est morte. Tu l'as tu√©e. Pour survivre.","Tu es devenu efficace. Efficace dans ta propre destruction."],20:["Tu es vide. Vide de tout. Vide de rien. Vide.","La nuit est ton royaume. Les t√©n√®bres, ta couronne. Tu es roi de rien.","Tu as perdu. Perdu ce qui faisait de toi un homme. Mais tu as gagn√©. Gagn√© quoi ?","Les larmes ne coulent plus. Il n'y a plus rien √† pleurer.","Tu es libre. Libre de toute morale. Libre de toute humanit√©. Libre de tout.","Tu es la mort. La mort qui marche. La mort qui tue. La mort qui survit.","Il ne reste rien. Rien de toi. Rien en toi. Rien.","Tu as gagn√©. Gagn√© en perdant tout. C'est ta victoire.","Les autres te craignent. Tu les comprends. Tu te crains toi-m√™me.","Tu es devenu parfait. Parfaitement vide. Parfaitement mort."]},_e={5:["Malgr√© tout, tu gardes espoir. Peut-√™tre qu'un jour, tu pourras racheter tes erreurs.","Chaque geste de bont√© te rappelle que tu es encore humain. C'est important.","La nuit est sombre, mais tu vois encore des lueurs. Des lueurs d'humanit√©.","Tu as fait des erreurs. Mais tu peux encore faire mieux. Tu le dois.","Les autres comptent. Leurs vies comptent. La tienne aussi.","Tu as aid√©. Tu as donn√©. √áa compte. √áa compte vraiment.","Chaque jour, tu choisis de rester humain. C'est un choix difficile, mais tu le fais.","La compassion n'est pas morte. Elle vit en toi. Tu la gardes pr√©cieusement.","Tu refuses de perdre espoir. M√™me dans les t√©n√®bres, il y a de la lumi√®re.","Les autres te voient. Ils voient ta bont√©. √áa leur donne espoir."],10:["Tu refuses de perdre espoir. M√™me dans les t√©n√®bres, il y a de la lumi√®re.","Chaque jour, tu choisis de rester humain. C'est un choix. Un choix difficile.","Tu as aid√©. Tu as donn√©. Tu as partag√©. √áa compte. √áa compte vraiment.","La bont√© n'est pas morte. Elle vit en toi. Tu la gardes pr√©cieusement.","Tu n'es pas seul. D'autres souffrent. D'autres esp√®rent. Comme toi.","Chaque geste de compassion te rapproche de la r√©demption. Tu y crois.","Tu as choisi l'humanit√©. Encore et encore. C'est ta force.","Les autres te remercient. Leurs sourires te r√©chauffent le c≈ìur.","Tu as partag√©. Tu as donn√©. Tu as aid√©. C'est ta fa√ßon de survivre.","La nuit est sombre, mais tu portes une lumi√®re. Une petite lumi√®re, mais une lumi√®re."],15:["Tu es une lumi√®re dans les t√©n√®bres. Une petite lumi√®re, mais une lumi√®re quand m√™me.","Chaque geste de compassion te rapproche de la r√©demption. Tu y crois.","Tu as choisi l'humanit√©. Encore et encore. C'est ta force.","Les autres te voient. Ils voient ta bont√©. √áa leur donne espoir.","Tu n'es pas parfait. Mais tu essaies. C'est ce qui compte.","Tu as rachet√© tes erreurs. Pi√®ce par pi√®ce. Gestes par gestes.","La bont√© n'est pas une faiblesse. C'est ta force. Tu l'as prouv√©.","Tu as prot√©g√©. Tu as aid√©. Tu as sauv√©. C'est ta victoire.","Les autres te suivent. Ils croient en toi. Tu crois en eux.","Tu es redevenu humain. Pleinement humain. C'est ta r√©demption."],20:["Tu es un phare. Un phare dans la temp√™te. Tu guides. Tu prot√®ges.","L'humanit√© n'est pas morte. Elle vit en toi. Elle grandit en toi.","Tu as choisi la lumi√®re. Encore et encore. Tu es devenu la lumi√®re.","Les autres te suivent. Ils croient en toi. Tu crois en eux.","Tu es redevenu humain. Pleinement humain. C'est ta victoire.","Tu as rachet√©. Rachet√© tes erreurs. Rachet√© ton √¢me. Tu es libre.","La compassion est ta force. Ta lumi√®re. Ta victoire.","Tu as choisi. Choisi l'humanit√©. Choisi la bont√©. Choisi la r√©demption.","Les autres te respectent. Ils t'admirent. Tu es un exemple.","Tu es la lumi√®re. La lumi√®re dans les t√©n√®bres. La lumi√®re qui guide."]},Pe={5:["Tu calcules. Tu p√®ses. Tu d√©cides. C'est ta fa√ßon de survivre.","Les √©motions sont un luxe. Tu ne peux pas te le permettre. Pas maintenant.","Tu fais ce qu'il faut. Rien de plus. Rien de moins. C'est tout.","La logique guide tes pas. La raison, tes choix. C'est ainsi.","Tu es efficace. Pratique. Utile. C'est ta force.","Tu analyses. Tu √©values. Tu optimises. C'est ta m√©thode.","Les sentiments sont des obstacles. Tu les √©vites. Tu gagnes.","Tu calcules chaque mouvement. Chaque choix. Chaque cons√©quence.","La raison prime. Toujours. C'est ta r√®gle.","Tu es m√©thodique. Pr√©cis. Efficace. C'est ta fa√ßon de vivre."],10:["Tu as appris. Appris √† survivre. Appris √† calculer. Appris √† gagner.","Les sentiments sont des faiblesses. Tu les as √©limin√©s. Ou presque.","Tu es une machine. Une machine de survie. Parfaitement huil√©e.","Tu fais les bons choix. Les choix logiques. Les choix qui marchent.","Tu es pragmatique. C'est ta nature. C'est ta force.","Tu optimises. Chaque action. Chaque d√©cision. Chaque mouvement.","La logique est ton guide. La raison, ton ma√Ætre. Tu ob√©is.","Tu calcules. Tu p√®ses. Tu d√©cides. Toujours. Sans exception.","Les √©motions sont des distractions. Tu les ignores. Tu gagnes.","Tu es efficace. Parfaitement efficace. C'est ta victoire."],15:["Tu calcules tout. Chaque mouvement. Chaque choix. Chaque cons√©quence.","Tu es devenu efficace. Parfaitement efficace. Rien ne te ralentit.","Les √©motions sont des obstacles. Tu les as surmont√©s. Tu as gagn√©.","Tu es la logique incarn√©e. La raison pure. C'est ta puissance.","Tu fais ce qui fonctionne. Toujours. Sans exception. C'est ta r√®gle.","Tu as √©limin√©. √âlimin√© tout ce qui √©tait inutile. Tu es pur.","La logique est ta religion. La raison, ton dieu. Tu adores.","Tu optimises. Optimises tout. Optimises toujours. Tu es parfait.","Les sentiments sont morts. Tu les as tu√©s. Pour gagner.","Tu es la machine. La machine parfaite. La machine qui gagne."],20:["Tu es la machine parfaite. Calculatrice. Efficace. Imparable.","Tu as √©limin√© tout ce qui te ralentissait. Tu es libre. Libre de gagner.","Tu es la logique. La raison. L'efficacit√©. C'est toi.","Rien ne t'arr√™te. Rien ne te ralentit. Tu es parfait.","Tu as gagn√©. Gagn√© en √©liminant tout ce qui √©tait inutile. Tu es pur.","Tu es la perfection. La perfection de la logique. La perfection de l'efficacit√©.","Les √©motions sont mortes. Tu les as tu√©es. Tu es libre.","Tu calcules. Tu optimises. Tu gagnes. Toujours. Sans exception.","Tu es devenu. Devenu la logique. Devenu la raison. Devenu l'efficacit√©.","Tu as gagn√©. Gagn√© en devenant parfait. Parfaitement logique. Parfaitement efficace."]},K={cynisme_humanite:["Tu es d√©chir√©. Entre le cynisme et l'humanit√©. Entre le d√©sespoir et l'espoir.","Tu te bats. Tu te bats contre toi-m√™me. Contre tes propres d√©mons.","Tu es en guerre. Une guerre int√©rieure. Tu ne sais pas qui va gagner.","Tu oscilles. Entre la lumi√®re et les t√©n√®bres. Entre l'humanit√© et le d√©sespoir.","Tu es un paradoxe. Un √™tre d√©chir√©. Mais tu vis. Tu vis encore.","Tu balances. Entre la bont√© et la survie. Entre l'espoir et le d√©sespoir.","Tu es d√©chir√©. D√©chir√© entre ce que tu veux √™tre et ce que tu dois √™tre.","Les deux voix se battent. La voix de la bont√©. La voix de la survie.","Tu oscilles. Entre la lumi√®re et les t√©n√®bres. Tu ne sais pas o√π tu es.","Tu es un conflit. Un conflit vivant. Un conflit qui survit."],cynisme_pragmatisme:["Tu calcules ta propre damnation. Tu la mesures. Tu l'acceptes.","Tu es efficace dans ta destruction. M√©thodique. Implacable.","Tu as choisi la logique. La logique de la survie. Peu importe le prix.","Tu es froid. Calculant. Efficace. C'est ta force. C'est ta faiblesse.","Tu as √©limin√© tout ce qui √©tait inutile. Y compris ton humanit√©.","Tu optimises. Optimises ta survie. Optimises ta destruction.","Tu calcules. Calcules chaque trahison. Calcules chaque choix.","Tu es efficace. Efficace dans ta damnation. Efficace dans ta survie.","La logique guide ta chute. La raison, ta destruction.","Tu es devenu. Devenu efficace. Devenu froid. Devenu vide."],humanite_pragmatisme:["Tu balances. Entre la bont√© et l'efficacit√©. Entre le c≈ìur et la raison.","Tu essaies. Tu essaies de rester humain tout en √©tant efficace.","Tu calcules ta bont√©. Tu mesures ta compassion. C'est √©trange.","Tu es pragmatique dans ta bont√©. Efficace dans ta compassion.","Tu combines. La logique et l'humanit√©. C'est ta fa√ßon de survivre.","Tu optimises. Optimises ta bont√©. Optimises ta compassion.","Tu calcules. Calcules comment √™tre bon. Calcules comment √™tre efficace.","Tu es pragmatique. Pragmatique dans ta bont√©. Pragmatique dans ta survie.","La logique guide ta bont√©. La raison, ta compassion.","Tu combines. Combines l'humanit√© et l'efficacit√©. C'est ta force."],balanced:["Tu es √©quilibr√©. Entre tout. Entre rien. Tu es toi.","Tu n'es ni bon ni mauvais. Tu es. C'est tout.","Tu balances. Entre les extr√™mes. Tu restes au centre.","Tu es complexe. Comme tout le monde. Comme personne.","Tu es humain. Dans toute ta complexit√©. C'est ta force.","Tu oscilles. Entre la lumi√®re et les t√©n√®bres. Tu restes au milieu.","Tu es √©quilibr√©. √âquilibr√© entre tout. √âquilibr√© entre rien.","Tu combines. Combines tout. Combines rien. Tu es toi.","Tu es complexe. Complexe comme la vie. Complexe comme la mort.","Tu es humain. Humain dans ta complexit√©. Humain dans ton √©quilibre."]};function Pn(e,t=[]){const n=e.cynisme||0,r=e.humanite||0,i=e.pragmatisme||0;if(n<5&&r<5&&i<5)return null;const a=Math.max(n,r,i);if([n>=10,r>=10,i>=10].filter(Boolean).length>=2){if(n>=10&&r>=10){const u=K.cynisme_humanite;return X(u,t)}if(n>=10&&i>=10){const u=K.cynisme_pragmatisme;return X(u,t)}if(r>=10&&i>=10){const u=K.humanite_pragmatisme;return X(u,t)}}if([Math.abs(n-r),Math.abs(n-i),Math.abs(r-i)].every(u=>u<5)&&a>=5){const u=K.balanced;return X(u,t)}let d=null,m=5;return n>=r&&n>=i&&n>=5?(n>=20?m=20:n>=15?m=15:n>=10?m=10:m=5,d=De[m]||De[5]):r>=i&&r>=5?(r>=20?m=20:r>=15?m=15:r>=10?m=10:m=5,d=_e[m]||_e[5]):i>=5&&(i>=20?m=20:i>=15?m=15:i>=10?m=10:m=5,d=Pe[m]||Pe[5]),d?X(d,t):null}function X(e,t){const n=e.filter(o=>!t.includes(o)),r=Math.max(1,Math.floor(e.length*.3)),i=n.length>=r?n:e;return i[Math.floor(Math.random()*i.length)]}function An(e){return y.getState(),[{id:"marchand_passe",text:"Un marchand passe par le camp. Il propose des √©quipements.",type:"text"},{id:"rumeurs_tresor",text:"Tu entends des rumeurs sur un tr√©sor cach√© dans les ruines.",type:"text"},{id:"voyageurs",text:"Un groupe de voyageurs partage des nouvelles du royaume.",type:"text"},{id:"nuit_calme",text:"La nuit est calme. Trop calme.",type:"text"},{id:"lumi√®res_foret",text:"Des lumi√®res dans la for√™t. Quelqu'un d'autre explore.",type:"text"},{id:"message_arbre",text:"Un message est accroch√© √† un arbre. Une offre de travail.",type:"text"},{id:"odeur_guerre",text:"Le vent apporte l'odeur de la guerre. Pas loin.",type:"text"},{id:"traces_pas",text:"Des traces de pas. R√©centes. Tu n'es pas seul ici.",type:"text"},{id:"marchand_interactif",text:"Un marchand passe par le camp. Il propose des √©quipements √† prix r√©duit.",type:"interactive",choices:[{text:"Acheter un √©quipement (12üí∞)",description:"Tu ach√®tes un √©quipement de qualit√©.",consequence:()=>{const t=y.getState();if(t.gold>=12&&t.inventory.length<10){const n=W(3);y.setState({gold:t.gold-12,inventory:[...t.inventory,n]})}}},{text:"N√©gocier (10üí∞, r√©putation ‚≠ê‚≠ê‚≠ê requise)",description:"Tu n√©gocies un meilleur prix gr√¢ce √† ta r√©putation.",consequence:()=>{const t=y.getState();if(t.gold>=10&&t.reputation>=3&&t.inventory.length<10){const n=W(3);y.setState({gold:t.gold-10,inventory:[...t.inventory,n]})}}},{text:"Refuser poliment",description:"Tu d√©clines. Le marchand part.",consequence:()=>{}}]},{id:"lumi√®res_foret_interactif",text:"Des lumi√®res dans la for√™t. Quelqu'un d'autre explore. Que fais-tu ?",type:"interactive",choices:[{text:"Aller voir",description:"Tu d√©couvres un campement. Ils te proposent de partager leur feu.",consequence:()=>{const t=y.getState();y.setState({narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}},{text:"Rester cach√©",description:"Tu observes de loin. Tu apprends des informations utiles.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+5})}},{text:"Pr√©parer une embuscade",description:"Tu pr√©pares une embuscade. Tu gagnes de l'or, mais tu perds de l'humanit√©.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*11)+10,narrativeCounters:{...t.narrativeCounters,cynisme:(t.narrativeCounters.cynisme||0)+1},reputation:Math.max(1,t.reputation-1)})}}]},{id:"message_arbre_interactif",text:"Un message est accroch√© √† un arbre. Une offre de travail.",type:"interactive",choices:[{text:"Accepter l'offre",description:"Tu acceptes. C'est un travail dangereux, mais bien pay√©.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+20,narrativeCounters:{...t.narrativeCounters,pragmatisme:(t.narrativeCounters.pragmatisme||0)+1}})}},{text:"Ignorer",description:"Tu ignores le message. Mieux vaut ne pas s'embarrasser.",consequence:()=>{}},{text:"D√©truire le message",description:"Tu d√©truis le message. Personne d'autre ne tombera dans le pi√®ge.",consequence:()=>{const t=y.getState();y.setState({narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}}]},{id:"voyageurs_interactif",text:"Un groupe de voyageurs partage des nouvelles du royaume. Ils te proposent de te joindre √† eux.",type:"interactive",choices:[{text:"Partager un repas avec eux",description:"Tu partages un repas. Tu te sens moins seul.",consequence:()=>{const t=y.getState();y.setState({narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}},{text:"√âchanger des informations",description:"Tu √©changes des informations. Tu apprends des choses utiles.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+10})}},{text:"Les voler",description:"Tu profites de leur confiance pour les voler.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*11)+12,narrativeCounters:{...t.narrativeCounters,cynisme:(t.narrativeCounters.cynisme||0)+3},reputation:Math.max(1,t.reputation-1)})}}]},{id:"ancien_soldat",text:"Tu croises un ancien soldat. Il te reconna√Æt.",type:"interactive",choices:[{text:"Partager une exp√©rience",description:"Vous partagez vos histoires. Tu te sens moins seul.",consequence:()=>{const t=y.getState();y.setState({narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}},{text:"√âviter",description:"Tu passes ton chemin.",consequence:()=>{}},{text:"Voler ses affaires",description:"Tu profites de sa distraction.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*11)+8,narrativeCounters:{...t.narrativeCounters,cynisme:(t.narrativeCounters.cynisme||0)+1},reputation:Math.max(1,t.reputation-1)})}}]},{id:"campement_abandonne",text:"Tu d√©couvres un campement abandonn√©. Des traces r√©centes, mais personne.",type:"interactive",choices:[{text:"Explorer prudemment",description:"Tu trouves quelques objets utiles.",consequence:()=>{const t=y.getState();if(t.inventory.length<10){const n=W(2);y.setState({inventory:[...t.inventory,n]})}else y.setState({gold:t.gold+15})}},{text:"Laisser tel quel",description:"Tu respectes les morts. Peut-√™tre que quelqu'un reviendra.",consequence:()=>{const t=y.getState();y.setState({narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}},{text:"Piller le campement",description:"Tu prends tout ce qui a de la valeur.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*16)+15,narrativeCounters:{...t.narrativeCounters,cynisme:(t.narrativeCounters.cynisme||0)+3},reputation:Math.max(1,t.reputation-1)})}}]},{id:"message_contact",text:"Un message discret te parvient. Un contact te propose une mission.",type:"interactive",choices:[{text:"Suivre le contact",description:"Tu acceptes la mission. C'est risqu√© mais payant.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*21)+20,narrativeCounters:{...t.narrativeCounters,pragmatisme:(t.narrativeCounters.pragmatisme||0)+1}})}},{text:"Ignorer",description:"Tu ignores le message. Mieux vaut ne pas s'embarrasser.",consequence:()=>{}},{text:"D√©noncer le contact",description:"Tu d√©nonces le contact aux autorit√©s. Tu gagnes en r√©putation.",consequence:()=>{const t=y.getState();y.setState({reputation:Math.min(5,t.reputation+1),narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+1}})}}]},{id:"refugies_camp",text:"Un groupe de r√©fugi√©s s'est install√© pr√®s de ton campement. Ils ont faim.",type:"interactive",choices:[{text:"Partager ta nourriture",description:"Tu partages ce que tu as. Ils te remercient.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold-5,narrativeCounters:{...t.narrativeCounters,humanite:(t.narrativeCounters.humanite||0)+2},reputation:Math.min(5,t.reputation+1)})}},{text:"Les chasser",description:"Tu les chasses. Ils partent, mais tu gagnes de l'or qu'ils avaient cach√©.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+Math.floor(Math.random()*11)+10,narrativeCounters:{...t.narrativeCounters,cynisme:(t.narrativeCounters.cynisme||0)+3},reputation:Math.max(1,t.reputation-2)})}},{text:"N√©gocier avec eux",description:"Tu leur proposes un march√©. Information contre protection.",consequence:()=>{const t=y.getState();y.setState({gold:t.gold+8,narrativeCounters:{...t.narrativeCounters,pragmatisme:(t.narrativeCounters.pragmatisme||0)+1}})}}]}]}function zn(e){const t=An();return Math.random()<.45?t[Math.floor(Math.random()*t.length)]:null}const On=["La nuit efface les traces. Le jour les r√©v√®le.","Chaque aube est une nouvelle chance. Ou une nouvelle dette.","Les murs √©coutent. Les ombres jugent.","Dans l'obscurit√©, les choix deviennent plus clairs.","Le sommeil n'efface pas les dettes. Seul l'or le fait.","Les ruines gardent leurs secrets. Et leurs tr√©sors.","Morten attend. Le temps passe.","La survie n'est pas une victoire. C'est juste un autre jour.","Les combats d'hier forgent les choix de demain.","L'or brille dans l'obscurit√©. Mais la dette aussi."],Bn=["Explorer t√¥t permet de trouver plus de lieux.","Manger √† la taverne restaure l'humanit√©.","Rembourser r√©guli√®rement am√©liore ta relation avec Morten.","Les items l√©gendaires valent cher au march√©.","La forge peut r√©parer tes √©quipements endommag√©s.","Les rumeurs √† la taverne r√©v√®lent des tr√©sors cach√©s.","Survivre sans manger r√©duit tes actions le lendemain.","Les choix narratifs influencent tes fins possibles."];function Wn({nextDay:e,onComplete:t}){const[n,r]=f.useState("fadeOut"),[i,a]=f.useState("");return f.useEffect(()=>{const o=setTimeout(()=>{r("black");const d=[...On,...Bn],m=d[Math.floor(Math.random()*d.length)];a(m)},2e3),l=setTimeout(()=>{r("fadeIn")},4e3),c=setTimeout(()=>{t()},5e3);return()=>{clearTimeout(o),clearTimeout(l),clearTimeout(c)}},[t]),s.jsx(S.div,{initial:{opacity:0},animate:{opacity:n==="fadeOut"||n==="black"?1:0},transition:{duration:2,ease:"easeInOut"},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:n==="black"?"#000000":"rgba(0, 0, 0, 0)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e4,pointerEvents:"none"},children:s.jsx(z,{children:n==="black"&&i&&s.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.8},style:{maxWidth:"500px",padding:"2rem",textAlign:"center"},children:[s.jsxs("div",{style:{fontSize:"1.1rem",color:"#888",fontStyle:"italic",lineHeight:"1.8",marginBottom:"2rem"},children:['"',i,'"']}),s.jsxs("div",{style:{fontSize:"0.9rem",color:"#555",marginTop:"2rem"},children:["JOUR ",e]})]})})})}function Un(){const{day:e,debt:t,endDay:n,narrativeCounters:r,recentMonologues:i,gold:a,reputation:o,inventory:l}=y(),c=H(),[d,m]=f.useState(null),[u,h]=f.useState(null),[v,p]=f.useState(null),[g,b]=f.useState(!1),[x,T]=f.useState(null),[C,E]=f.useState(!1),{triggerShake:w}=wn();f.useEffect(()=>{const A=zn();m(A),h(null),p(null),b(!0),w(2,400),setTimeout(()=>b(!1),1e3);const B=Pn(r,i||[]);T(B),B&&y.setState({recentMonologues:[...(i||[]).slice(-4),B]})},[e,r,i,w]);const L=A=>{if(!d||!d.choices)return;const B=d.choices[A];h(A),B.consequence(),p(B.description||"Tu as fait ton choix.")},M=te.economy.dailyInterest,q=2,P=a>=q,Ve=t+M+(P?0:q);return s.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:1,position:"relative",padding:"1rem",width:"100%"},children:[s.jsxs("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",paddingBottom:"100px",WebkitOverflowScrolling:"touch"},children:[s.jsxs("div",{style:{textAlign:"center",fontSize:"1.5rem",fontWeight:"bold",marginBottom:"1rem",color:"#fff"},children:["CR√âPUSCULE ‚Äî JOUR ",e,"/20"]}),s.jsxs("div",{style:{background:"#2a2a2a",padding:"1.5rem",borderRadius:"8px",border:"2px solid #555"},children:[s.jsx("div",{style:{fontSize:"1.1rem",marginBottom:"1rem",fontWeight:"bold"},children:"R√âSUM√â DU JOUR"}),s.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#aaa"},children:[s.jsx("div",{style:{marginBottom:"0.5rem"},children:"‚Ä¢ 3 lieux explor√©s"}),s.jsxs("div",{style:{marginBottom:"0.5rem"},children:["‚Ä¢ ",Math.floor(Math.random()*3)," items trouv√©s"]}),s.jsxs("div",{children:["‚Ä¢ ",Math.floor(Math.random()*2)," combats"]})]}),s.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#1a1a1a",borderRadius:"4px"},children:[s.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"1rem"},children:["Dette actuelle : ",s.jsxs("span",{style:{color:"#c44"},children:[t,"üí∞"]})]}),s.jsx("div",{style:{marginBottom:"0.75rem",padding:"0.5rem",background:P?"#1a2a1a":"#2a1a1a",borderRadius:"4px",fontSize:"0.85rem",color:P?"#4a8":"#c84",border:`1px solid ${P?"#4a8":"#c84"}`},children:P?s.jsxs(s.Fragment,{children:["‚úì Logement pay√© : -",q,"üí∞"]}):s.jsxs(s.Fragment,{children:["‚ö† Logement ajout√© √† la dette : +",q,"üí∞"]})}),s.jsxs(S.div,{animate:g?{scale:[1,1.1,1],color:["#c44","#f44","#c44"]}:{},transition:{duration:.5},style:{fontSize:"1.1rem",fontWeight:"bold"},children:["Nouvelle dette : ",s.jsxs("span",{style:{color:"#c44"},children:[Ve,"üí∞"]}),s.jsxs("span",{style:{color:"#888",fontSize:"0.9rem",marginLeft:"0.5rem",fontWeight:"normal"},children:["(+",M," int√©r√™ts",P?"":` + ${q} logement`,")"]})]})]}),d&&s.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#2a1a1a",borderRadius:"4px",border:"1px solid #555"},children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#ca8",fontStyle:"italic",lineHeight:"1.6",marginBottom:d.type==="interactive"?"1rem":"0"},children:d.text}),v&&s.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.85rem",color:"#ca8",fontStyle:"italic"},children:v})]}),x&&s.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#1a1a2a",borderRadius:"4px",border:"1px solid #444",fontSize:"0.9rem",color:"#888",fontStyle:"italic",lineHeight:"1.6"},children:x}),s.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"#1a1a1a",borderRadius:"4px",fontSize:"0.9rem",color:"#aaa",fontStyle:"italic"},children:'"La nuit tombe. Demain, tu recommences."'})]})]}),s.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,zIndex:10,padding:"1rem",background:"linear-gradient(to top, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.85) 70%, transparent 100%)",borderTop:"1px solid #333"},children:[d&&d.type==="interactive"&&d.choices&&!v&&s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1rem"},children:d.choices.map((A,B)=>{const He=!A.text.includes("15üí∞")||a>=15,Je=!A.text.includes("10üí∞")||a>=10,Xe=!A.text.includes("‚≠ê‚≠ê‚≠ê")||o>=3,Ye=!A.text.includes("√©quipement")||l.length<10,G=He&&Je&&Xe&&Ye;return s.jsx("button",{onClick:()=>L(B),disabled:!G,style:{padding:c?"1rem":"0.875rem",fontSize:c?"1rem":"0.95rem",minHeight:c?"48px":"44px",textAlign:"left",background:G?"#1a1a1a":"#0a0a0a",border:`1px solid ${G?"#555":"#333"}`,borderRadius:"4px",color:G?"#ccc":"#666",cursor:G?"pointer":"not-allowed",opacity:G?1:.5,boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.3)"},children:A.text},B)})}),s.jsx("button",{onClick:()=>{e>=20?n():E(!0)},style:{fontSize:"1.1rem",padding:"1rem",width:"100%",background:"#2a2a2a",border:"1px solid #555",borderRadius:"4px",color:"#fff",cursor:"pointer",boxShadow:"0 -2px 8px rgba(0, 0, 0, 0.3)"},children:e>=20?"TERMINER":`DORMIR ‚Üí JOUR ${e+1}`})]}),C&&s.jsx(Wn,{currentDay:e,nextDay:e+1,onComplete:()=>{E(!1),n()}})]})}const Fn=f.lazy(()=>D(()=>import("./DefeatScreen-2aG-3zwD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Nn=f.lazy(()=>D(()=>import("./VictoryScreen-BRDlr9Ic.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),$n=f.lazy(()=>D(()=>import("./InventoryScreen-C6RI0Ws8.js"),__vite__mapDeps([9,1,2,7,5]))),Gn=f.lazy(()=>D(()=>import("./MarcheScreen-CdETMzYa.js"),__vite__mapDeps([10,1,2,5,7]))),Vn=f.lazy(()=>D(()=>import("./MortenScreen-rAkYaTx8.js"),__vite__mapDeps([11,1,2,5,7]))),Hn=f.lazy(()=>D(()=>import("./ForgeScreen-Dhuhzlg3.js"),__vite__mapDeps([12,1,2,7,5]))),Jn=f.lazy(()=>D(()=>import("./TaverneScreen-DWZTCWj-.js"),__vite__mapDeps([13,1,2,5,7]))),Xn=f.lazy(()=>D(()=>import("./EventScreen-CdVhPq9h.js"),__vite__mapDeps([14,1,2,7,5]))),Yn=f.lazy(()=>D(()=>import("./OriginSelectScreen-C3D4pZX5.js"),__vite__mapDeps([15,1,2,6,3,7,5]))),Qn=f.lazy(()=>D(()=>import("./HallOfFameScreen-ChANGEBc.js"),__vite__mapDeps([16,1,2,3,7,5]))),Kn=f.lazy(()=>D(()=>import("./TutorialScreen-CqYH3S9x.js"),__vite__mapDeps([17,1,2,5,9,7]))),Zn=f.lazy(()=>D(()=>import("./SettingsScreen-C6j_FQKe.js"),__vite__mapDeps([18,1,2,7,5]))),er=()=>s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:"0.9rem",color:"#999"},children:"Chargement..."});function tr(){const e=y(n=>n.phase),t=H();return Ht(),s.jsx(tn,{children:s.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",padding:t?"0.5rem":"1rem",fontSize:t?"0.9rem":"1rem",overflow:"auto"},children:[s.jsx(Kt,{}),s.jsx(en,{phase:e}),s.jsx(Jt,{phase:e,children:s.jsxs(f.Suspense,{fallback:s.jsx(er,{}),children:[e==="start"&&s.jsx(rn,{}),e==="tutorial"&&s.jsx(Kn,{}),e==="aube"&&s.jsx(Tn,{}),e==="exploration"&&s.jsx(_n,{}),e==="crepuscule"&&s.jsx(Un,{}),e==="defeat"&&s.jsx(Fn,{}),e==="victory"&&s.jsx(Nn,{}),e==="inventory"&&s.jsx($n,{}),e==="marche"&&s.jsx(Gn,{}),e==="morten"&&s.jsx(Vn,{}),e==="forge"&&s.jsx(Hn,{}),e==="taverne"&&s.jsx(Jn,{}),e==="narrative"&&s.jsx(Xn,{}),e==="origin"&&s.jsx(Yn,{}),e==="hallOfFame"&&s.jsx(Qn,{}),e==="settings"&&s.jsx(Zn,{})]})})]})})}const Ge=typeof window<"u"&&window.document!==void 0;if(Ge){typeof indexedDB<"u"?console.log("‚úÖ Running on Web - Storage Check OK (IndexedDB available)"):console.warn("‚ö†Ô∏è Running on Web - IndexedDB not available, using localStorage fallback");try{localStorage.setItem("_storage_test","ok"),localStorage.removeItem("_storage_test"),console.log("‚úÖ Running on Web - localStorage Check OK")}catch(e){console.error("‚ùå Running on Web - localStorage not available:",e)}}Ge&&"serviceWorker"in navigator&&window.addEventListener("load",()=>{const t="/souda/"+"sw.js";navigator.serviceWorker.getRegistrations().then(n=>Promise.all(n.map(r=>r.unregister()))).then(()=>new Promise(n=>setTimeout(n,100))).then(()=>navigator.serviceWorker.register(t,{updateViaCache:"none"})).then(n=>{n.update(),navigator.serviceWorker.addEventListener("message",r=>{r.data&&r.data.type==="SW_ACTIVATED"&&window.location.reload()})}).catch(n=>{})});Ue().then(e=>{e&&y.setState(e)});Ze.createRoot(document.getElementById("root")).render(s.jsx(et.StrictMode,{children:s.jsx(tr,{})}));export{ln as C,bt as D,V as E,Dn as M,Gt as O,En as S,yn as a,dn as b,Bt as c,ot as d,at as e,Wt as f,dr as g,wn as h,lr as i,or as j,cr as k,Ut as l,H as m,ur as n,Rt as o,$t as p,F as q,me as r,y as u};
